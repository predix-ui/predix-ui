<!--
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
--><html><head><script>window.Vaadin=window.Vaadin||{};Vaadin.Grid=Vaadin.Grid||{};Vaadin.Grid.CombinedMixin=function(superClass){return function(_superClass){babelHelpers.inherits(CombinedMixin,_superClass);function CombinedMixin(){babelHelpers.classCallCheck(this,CombinedMixin);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(CombinedMixin).apply(this,arguments))}babelHelpers.createClass(CombinedMixin,[{key:"ready",value:function ready(){var _this=this;babelHelpers.get(babelHelpers.getPrototypeOf(CombinedMixin.prototype),"ready",this).call(this);this.addEventListener("cell-activate",this._activateItem.bind(this));this.$.scroller.addEventListener("click",this._onClick.bind(this));this._addNodeObserver();this.addEventListener("filter-changed",this._filterChanged.bind(this));this._rowDetailsTemplate=this.querySelector("template.row-details");if(this._rowDetailsTemplate){var templatizer=new Vaadin.Grid.Templatizer;templatizer._grid=this;templatizer.dataHost=this.dataHost;templatizer.template=this._rowDetailsTemplate;this._rowDetailsTemplate.templatizer=templatizer}this.addEventListener("sorter-changed",this._onSorterChanged);if(!Polymer.Settings.useNativeShadow){Polymer.Async.microTask.run(function(){var sorters=_this.querySelectorAll("vaadin-grid-sorter");Array.from(sorters).forEach(function(sorter){if(babelHelpers.instanceof(sorter,Polymer.Element)){sorter.dispatchEvent(new CustomEvent("sorter-changed",{bubbles:!0,composed:!0}))}})})}}},{key:"_a11yGetHeaderRowCount",value:function _a11yGetHeaderRowCount(_columnTree){return _columnTree.filter(function(level){return level.some(function(col){return col.headerTemplate})}).length}},{key:"_a11yGetFooterRowCount",value:function _a11yGetFooterRowCount(_columnTree){return _columnTree.filter(function(level){return level.some(function(col){return col.headerTemplate})}).length}},{key:"_a11yUpdateGridSize",value:function _a11yUpdateGridSize(size,_columnTree){if(size===void 0||_columnTree===void 0){return}var bodyColumns=_columnTree[_columnTree.length-1];this.$.table.setAttribute("aria-rowcount",size+this._a11yGetHeaderRowCount(_columnTree)+this._a11yGetFooterRowCount(_columnTree));this.$.table.setAttribute("aria-colcount",bodyColumns&&bodyColumns.length||0);this._a11yUpdateHeaderRows();this._a11yUpdateFooterRows()}},{key:"_a11yUpdateHeaderRows",value:function _a11yUpdateHeaderRows(){Array.from(this.$.header.children).forEach(function(headerRow,index){return headerRow.setAttribute("aria-rowindex",index+1)})}},{key:"_a11yUpdateFooterRows",value:function _a11yUpdateFooterRows(){var _this2=this;Array.from(this.$.footer.children).forEach(function(footerRow,index){return footerRow.setAttribute("aria-rowindex",_this2._a11yGetHeaderRowCount(_this2._columnTree)+_this2.size+index+1)})}},{key:"_a11yUpdateRowRowindex",value:function _a11yUpdateRowRowindex(row,index){row.setAttribute("aria-rowindex",index+this._a11yGetHeaderRowCount(this._columnTree)+1)}},{key:"_a11yUpdateRowSelected",value:function _a11yUpdateRowSelected(row,selected){row.setAttribute("aria-selected",!!selected);Array.from(row.children).forEach(function(cell){return cell.setAttribute("aria-selected",!!selected)})}},{key:"_a11yUpdateRowLevel",value:function _a11yUpdateRowLevel(row,level){Array.from(row.children).forEach(function(cell){return cell.setAttribute("aria-level",level+1)});row.setAttribute("aria-level",level+1)}},{key:"_a11yUpdateRowDetailsOpened",value:function _a11yUpdateRowDetailsOpened(row,detailsOpened){Array.from(row.children).forEach(function(cell){if("boolean"===typeof detailsOpened){cell.setAttribute("aria-expanded",detailsOpened)}else{if(cell.hasAttribute("aria-expanded")){cell.removeAttribute("aria-expanded")}}})}},{key:"_a11ySetRowDetailsCell",value:function _a11ySetRowDetailsCell(row,detailsCell){Array.from(row.children).forEach(function(cell){if(cell!==detailsCell){cell.setAttribute("aria-controls",detailsCell.id)}})}},{key:"_a11yUpdateCellColspan",value:function _a11yUpdateCellColspan(cell,colspan){cell.setAttribute("aria-colspan",+colspan)}},{key:"_a11yUpdateSorters",value:function _a11yUpdateSorters(){Array.from(this.querySelectorAll("vaadin-grid-sorter")).forEach(function(sorter){var cellContent=sorter.parentNode;while(cellContent&&"vaadin-grid-cell-content"!==cellContent.localName){cellContent=cellContent.parentNode}if(cellContent){var cell=cellContent.assignedSlot.parentNode;cell.setAttribute("aria-sort",{asc:"ascending",desc:"descending"}[sorter.direction+""]||"none")}})}},{key:"_activateItem",value:function _activateItem(e){var model=e.detail.model,clickedItem=model?model.item:null;if(clickedItem){this.activeItem=!this._itemsEqual(this.activeItem,clickedItem)?clickedItem:null}}},{key:"_itemsChanged",value:function _itemsChanged(items,splices,isAttached){if(!isAttached){return}if(!Array.isArray(items)){if(items===void 0||null===items){this.size=0}if(this.dataProvider===this._arrayDataProvider){this.dataProvider=void 0}return}this.size=items.length;this.dataProvider=this.dataProvider||this._arrayDataProvider;this.clearCache();this._ensureFirstPageLoaded()}},{key:"_arrayDataProvider",value:function _arrayDataProvider(opts,cb){var items=(Array.isArray(this.items)?this.items:[]).slice(0);if(this._filters&&this._checkPaths(this._filters,"filtering",items)){items=this._filter(items)}this.size=items.length;if(opts.sortOrders.length&&this._checkPaths(this._sorters,"sorting",items)){items=items.sort(this._multiSort.bind(this))}var start=opts.page*opts.pageSize,end=start+opts.pageSize,slice=items.slice(start,end);cb(slice,items.length)}},{key:"_checkPaths",value:function _checkPaths(arrayToCheck,action,items){if(!items.length){return!1}var result=!0;for(var i in arrayToCheck){var path=arrayToCheck[i].path;if(!path||-1===path.indexOf(".")){continue}var parentProperty=path.replace(/\.[^\.]*$/,"");if(Polymer.Base.get(parentProperty,items[0])===void 0){console.warn("Path \"".concat(path,"\" used for ").concat(action," does not exist in all of the items, ").concat(action," is disabled."));result=!1}}return result}},{key:"_multiSort",value:function _multiSort(a,b){var _this3=this;return this._sorters.map(function(sort){if("asc"===sort.direction){return _this3._compare(Polymer.Base.get(sort.path,a),Polymer.Base.get(sort.path,b))}else if("desc"===sort.direction){return _this3._compare(Polymer.Base.get(sort.path,b),Polymer.Base.get(sort.path,a))}return 0}).reduce(function(p,n){return p?p:n},0)}},{key:"_normalizeEmptyValue",value:function _normalizeEmptyValue(value){if(0<=[void 0,null].indexOf(value)){return""}else if(isNaN(value)){return value.toString()}else{return value}}},{key:"_compare",value:function _compare(a,b){a=this._normalizeEmptyValue(a);b=this._normalizeEmptyValue(b);if(a<b){return-1}if(a>b){return 1}return 0}},{key:"_filter",value:function _filter(items){var _this4=this;return items.filter(function(item,index){return 0===_this4._filters.filter(function(filter){var value=_this4._normalizeEmptyValue(Polymer.Base.get(filter.path,item));return-1===value.toString().toLowerCase().indexOf(filter.value.toString().toLowerCase())}).length})}},{key:"_onClick",value:function _onClick(e){if(e.defaultPrevented){return}var path=e.composedPath(),cell=path[path.indexOf(this.$.table)-3];if(!cell||-1<cell.getAttribute("part").indexOf("details-cell")){return}var cellContent=cell._content,activeElement=this.getRootNode().activeElement,cellContentHasFocus=cellContent.contains(activeElement)&&(!this._ie||this._isFocusable(activeElement));if(!cellContentHasFocus&&!this._isFocusable(e.target)){this.dispatchEvent(new CustomEvent("cell-activate",{detail:{model:cell._instance}}))}}},{key:"_isFocusable",value:function _isFocusable(target){if(!target.parentNode){return!1}var focusables=Array.from(target.parentNode.querySelectorAll("[tabindex], button, input, select, textarea, object, iframe, label, a[href], area[href]")).filter(function(element){return"cell body-cell"!==element.getAttribute("part")}),isFocusableElement=-1!==focusables.indexOf(target);return!target.disabled&&isFocusableElement}},{key:"_hasColumnGroups",value:function _hasColumnGroups(columns){for(var i=0;i<columns.length;i++){if("vaadin-grid-column-group"===columns[i].localName){return!0}}return!1}},{key:"_getChildColumns",value:function _getChildColumns(el){return Polymer.dom(el).queryDistributedElements("*").filter(this._isColumnElement)}},{key:"_flattenColumnGroups",value:function _flattenColumnGroups(columns){var _this5=this;return columns.map(function(col){if("vaadin-grid-column-group"===col.localName){return _this5._getChildColumns(col)}else{return[col]}}).reduce(function(prev,curr){return prev.concat(curr)},[])}},{key:"_getColumnTree",value:function _getColumnTree(){for(var rootColumns=this.queryAllEffectiveChildren("*").filter(this._isColumnElement),_columnTree=[],c=rootColumns;;){_columnTree.push(c);if(!this._hasColumnGroups(c)){break}c=this._flattenColumnGroups(c)}return _columnTree}},{key:"_updateColumnTree",value:function _updateColumnTree(){var columnTree=this._getColumnTree();if(!this._arrayEquals(columnTree,this._columnTree)){this._columnTree=columnTree}}},{key:"_addNodeObserver",value:function _addNodeObserver(){var _this6=this;this._observer=new Polymer.FlattenedNodesObserver(this,function(info){if(0<info.addedNodes.filter(_this6._isColumnElement).length||0<info.removedNodes.filter(_this6._isColumnElement).length){_this6._updateColumnTree()}if(Polymer.Settings.useNativeShadow||Polymer.Settings.useShadow){}_this6._debouncerCheckImports=Polymer.Debouncer.debounce(_this6._debouncerCheckImports,Polymer.Async.timeOut.after(2e3),_this6._checkImports.bind(_this6))})}},{key:"_arrayEquals",value:function _arrayEquals(arr1,arr2){if(!arr1||!arr2||arr1.length!=arr2.length){return!1}for(var i=0,l=arr1.length;i<l;i++){if(babelHelpers.instanceof(arr1[i],Array)&&babelHelpers.instanceof(arr2[i],Array)){if(!this._arrayEquals(arr1[i],arr2[i])){return!1}}else if(arr1[i]!=arr2[i]){return!1}}return!0}},{key:"_checkImports",value:function _checkImports(){var _this7=this;["vaadin-grid-column-group","vaadin-grid-filter","vaadin-grid-tree-toggle","vaadin-grid-selection-column","vaadin-grid-sorter"].forEach(function(elementName){var element=_this7.querySelector(elementName);if(element&&!babelHelpers.instanceof(element,Polymer.Element)){console.warn("Make sure you have imported the required module for <".concat(elementName,"> element."))}})}},{key:"_updateLastColumn",value:function _updateLastColumn(){var _this8=this;Array.from(this.shadowRoot.querySelectorAll("tr")).forEach(function(row){Array.from(row.querySelectorAll("[part~=\"cell\"]:not([part~=\"details-cell\"])")).sort(function(a,b){return a._column._order-b._column._order}).forEach(function(cell,cellIndex,children){_this8._toggleAttribute("last-column",cellIndex===children.length-1,cell)})})}},{key:"_isColumnElement",value:function _isColumnElement(node){return node.nodeType===Node.ELEMENT_NODE&&/\bcolumn\b/.test(node.localName)}},{key:"_filterChanged",value:function _filterChanged(e){if(-1===this._filters.indexOf(e.target)){this._filters.push(e.target)}e.stopPropagation();if(this.dataProvider){this.clearCache()}}},{key:"_mapFilters",value:function _mapFilters(){return this._filters.map(function(filter){return{path:filter.path,value:filter.value}})}},{key:"_detailsOpenedItemsChanged",value:function _detailsOpenedItemsChanged(changeRecord,dataProvider,rowDetailsTemplate,physicalCount){if(dataProvider===void 0||!rowDetailsTemplate){return}if("detailsOpenedItems.length"===changeRecord.path){return}this._flushItemsDebouncer();if(this._lastDetailsOpenedItems&&physicalCount){this._physicalItems.forEach(this._toggleDetailsCell,this);this._render()}this._lastDetailsOpenedItems=this.detailsOpenedItems}},{key:"_configureDetailsCell",value:function _configureDetailsCell(cell){cell.setAttribute("part","cell details-cell");cell.setAttribute("frozen","")}},{key:"_toggleDetailsCell",value:function _toggleDetailsCell(row,item){var cell=row.querySelector("[part~=\"details-cell\"]"),detailsHidden=!this._isDetailsOpened(item);if(cell&&(!cell._instance||cell.hidden!==detailsHidden)){cell.hidden=detailsHidden;if(detailsHidden){row.style.removeProperty("padding-bottom")}else{if(!cell._instance){cell._instance=this._rowDetailsTemplate.templatizer.createInstance();cell._content.innerHTML="";cell._content.appendChild(cell._instance.root);this._updateItem(row,item)}Polymer.flush();row.style.setProperty("padding-bottom","".concat(cell.offsetHeight,"px"))}}}},{key:"_updateDetailsCellHeights",value:function _updateDetailsCellHeights(){Array.from(this.$.items.querySelectorAll("[part~=\"details-cell\"]:not([hidden])")).forEach(function(cell){cell.parentElement.style.setProperty("padding-bottom","".concat(cell.offsetHeight,"px"))})}},{key:"_isDetailsOpened",value:function _isDetailsOpened(item){return this.detailsOpenedItems&&-1!==this._getItemIndexInArray(item,this.detailsOpenedItems)}},{key:"openItemDetails",value:function openItemDetails(item){if(!this._isDetailsOpened(item)){this.push("detailsOpenedItems",item)}}},{key:"closeItemDetails",value:function closeItemDetails(item){if(this._isDetailsOpened(item)){this.splice("detailsOpenedItems",this._getItemIndexInArray(item,this.detailsOpenedItems),1)}}},{key:"_detailsOpenedInstanceChangedCallback",value:function _detailsOpenedInstanceChangedCallback(instance,value){if(babelHelpers.get(babelHelpers.getPrototypeOf(CombinedMixin.prototype),"_detailsOpenedInstanceChangedCallback",this)){babelHelpers.get(babelHelpers.getPrototypeOf(CombinedMixin.prototype),"_detailsOpenedInstanceChangedCallback",this).call(this,instance,value)}if(value){this.openItemDetails(instance.item)}else{this.closeItemDetails(instance.item)}}},{key:"_isSelected",value:function _isSelected(item){return this.selectedItems&&-1<this._getItemIndexInArray(item,this.selectedItems)}},{key:"selectItem",value:function selectItem(item){if(!this._isSelected(item)){this.push("selectedItems",item)}}},{key:"deselectItem",value:function deselectItem(item){var index=this._getItemIndexInArray(item,this.selectedItems);if(-1<index){this.splice("selectedItems",index,1)}}},{key:"_toggleItem",value:function _toggleItem(item){var index=this._getItemIndexInArray(item,this.selectedItems);if(-1===index){this.selectItem(item)}else{this.deselectItem(item)}}},{key:"_selectedItemsChanged",value:function _selectedItemsChanged(e){var _this9=this;if(this.$.items.children.length&&("selectedItems"===e.path||"selectedItems.splices"===e.path)){Array.from(this.$.items.children).forEach(function(row){_this9._toggleRowSelected(row,_this9._isSelected(row._item))})}}},{key:"_selectedInstanceChangedCallback",value:function _selectedInstanceChangedCallback(instance,value){if(babelHelpers.get(babelHelpers.getPrototypeOf(CombinedMixin.prototype),"_selectedInstanceChangedCallback",this)){babelHelpers.get(babelHelpers.getPrototypeOf(CombinedMixin.prototype),"_selectedInstanceChangedCallback",this).call(this,instance,value)}if(value){this.selectItem(instance.item)}else{this.deselectItem(instance.item)}}},{key:"_onSorterChanged",value:function _onSorterChanged(e){var _this10=this,sorter=e.target;this._removeArrayItem(this._sorters,sorter);sorter._order=null;if(this.multiSort){if(sorter.direction){this._sorters.unshift(sorter)}this._sorters.forEach(function(sorter,index){return sorter._order=1<_this10._sorters.length?index:null},this)}else{this._sorters.forEach(function(sorter){sorter._order=null;sorter.direction=null});if(sorter.direction){this._sorters=[sorter]}}e.stopPropagation();if(this.dataProvider&&JSON.stringify(this._previousSorters)!==JSON.stringify(this._mapSorters())){this.clearCache()}this._a11yUpdateSorters();this._previousSorters=this._mapSorters()}},{key:"_mapSorters",value:function _mapSorters(){return this._sorters.map(function(sorter){return{path:sorter.path,direction:sorter.direction}})}},{key:"_removeArrayItem",value:function _removeArrayItem(array,item){var index=array.indexOf(item);if(-1<index){array.splice(index,1)}}}],[{key:"properties",get:function get(){return{items:Array,activeItem:{type:Object,notify:!0,value:null},_filters:{type:Array,value:function value(){return[]}},detailsOpenedItems:{type:Array,value:function value(){return[]}},_rowDetailsTemplate:Object,_detailsCells:{type:Array},selectedItems:{type:Object,notify:!0,value:function value(){return[]}},multiSort:{type:Boolean,value:!1},_sorters:{type:Array,value:function value(){return[]}},_previousSorters:{type:Array,value:function value(){return[]}}}}},{key:"observers",get:function get(){return["_a11yUpdateGridSize(size, _columnTree, _columnTree.*)","_itemsChanged(items, items.*, isAttached)","_detailsOpenedItemsChanged(detailsOpenedItems.*, dataProvider, _rowDetailsTemplate, _physicalCountVal)","_selectedItemsChanged(selectedItems.*)"]}}]);return CombinedMixin}(superClass)};</script>
</head><body></body></html>