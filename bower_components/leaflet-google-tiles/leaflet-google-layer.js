(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++){s(r[o])}return s})({1:[function(require,module,exports){(function(global){var L="undefined"!==typeof window?window.L:"undefined"!==typeof global?global.L:null,VALID_MAP_TYPES=["roadmap","satellite"];L.TileLayer.Google=L.TileLayer.extend({options:{GoogleTileAPIKey:null,mapType:"roadmap",language:"en-GB",region:"gb",mapStyle:[]},statics:{TILE_REQUEST:"https://www.googleapis.com/tile/v1/tiles/{z}/{x}/{y}?session={sessionToken}&orientation=0&key={GoogleTileAPIKey}",ATTRIBUTION_URL:"https://www.googleapis.com/tile/v1/viewport?session={sessionToken}&zoom={zoom}&north={north}&south={south}&east={east}&west={west}&key={GoogleTileAPIKey}",SESSION_TOKEN_URL:"https://www.googleapis.com/tile/v1/createSession?key={GoogleTileAPIKey}"},_getSessionToken:function _getSessionToken(){var _this=this;if(!this._exponentialBackoff){this._exponentialBackoff=1e3}if(!this._promise){this._promise=new Promise(function(resolve,reject){var sessionTokenUrl=L.Util.template(L.TileLayer.Google.SESSION_TOKEN_URL,{GoogleTileAPIKey:_this.options.GoogleTileAPIKey}),body=JSON.stringify({mapType:_this.options.mapType,language:_this.options.language,region:_this.options.region,overlay:!0,scale:"scaleFactor1x",styles:_this.options.mapStyle}),xhttp=new XMLHttpRequest;xhttp.open("POST",sessionTokenUrl,!0);xhttp.setRequestHeader("Content-type","application/json");xhttp.onreadystatechange=function(){if(4===this.readyState){if(200===this.status){_this._exponentialBackoff=null;var token=JSON.parse(xhttp.responseText);_this._sessionToken=token.session;resolve(token)}else{setTimeout(function(){_this._promise=null;_this._exponentialBackoff*=2;_this._getSessionToken()},_this._exponentialBackoff);reject("Session request failed, trying again in "+_this._exponentialBackoff/1e3+"seconds")}}};xhttp.send(body)})}return this._promise},_refreshToken:function _refreshToken(){var _this=this;this._getSessionToken().then(function(token){setTimeout(function(){if(_this._needToRefreshToken){_this._promise=null;_this._refreshToken()}},1e3*token.expiry-new Date().getTime()-36e5)}).catch(function(e){console.error("refreshToken",e)})},initialize:function initialize(options){if(!options||!options.GoogleTileAPIKey){throw new Error("Must supply options.GoogleTileAPIKey")}options=L.setOptions(this,options);if(0>VALID_MAP_TYPES.indexOf(options.mapType)){throw new Error("'"+options.mapType+"' is an invalid mapType")}this._sessionToken=null;this._needToRefreshToken=!1;this._promise=null;if(!L.Browser.android){this.on("tileunload",this._onTileRemove)}},createTile:function createTile(coords,done){var tile=document.createElement("img");L.DomEvent.on(tile,"load",L.bind(this._tileOnLoad,this,done,tile));L.DomEvent.on(tile,"error",L.bind(this._tileOnError,this,done,tile));if(this.options.crossOrigin){tile.crossOrigin=""}tile.alt="";this._getSessionToken().then(function(token){tile.src=this.getTileUrl(coords);done(null,tile)}.bind(this)).catch(function(e){console.error(e);done(e)});return tile},getAttribution:function getAttribution(){return this.attribution},getTileUrl:function getTileUrl(coords){return L.Util.template(L.TileLayer.Google.TILE_REQUEST,{z:coords.z,x:coords.x,y:coords.y,sessionToken:this._sessionToken,GoogleTileAPIKey:this.options.GoogleTileAPIKey})},onAdd:function onAdd(map){map.on("moveend",this._updateAttribution,this);L.TileLayer.prototype.onAdd.call(this,map);this._needToRefreshToken=!0;this._refreshToken();this._updateAttribution()},onRemove:function onRemove(map){map.off("moveend",this._updateAttribution,this);this._needToRefreshToken=!1;this._promise=null;map.attributionControl.removeAttribution(this.attribution);this.attribution=null;L.TileLayer.prototype.onRemove.call(this,map)},setKey:function setKey(newKey){if(newKey&&this.options.GoogleTileAPIKey!==newKey){this.options.GoogleTileAPIKey=newKey;this._getSessionToken().then(function(){this.redraw()}.bind(this))}},setLanguage:function setLanguage(newLanguage){if(newLanguage&&this.options.language!==newLanguage){this.options.language=newLanguage;this._promise=null;this._getSessionToken().then(function(){this.redraw();this._updateAttribution()}.bind(this))}},setMapType:function setMapType(newSet){if(!newSet||-1===VALID_MAP_TYPES.indexOf(newSet)){throw new Error("'"+newSet+"' is an invalid mapType")}if(this.options.mapType!==newSet){this.options.mapType=newSet;this._promise=null;this._getSessionToken().then(function(){this.redraw();this._updateAttribution()}.bind(this))}},setMapStyle:function setMapStyle(newStyle){if(newStyle&&this.options.mapStyle!==newStyle){this.options.mapStyle=newStyle;this._promise=null;this._getSessionToken().then(function(){this.redraw();this._updateAttribution()}.bind(this))}},setRegion:function setRegion(newRegion){if(newRegion&&this.options.region!==newRegion){this.options.region=newRegion;this._promise=null;this._getSessionToken().then(function(){this.redraw();this._updateAttribution()}.bind(this))}},_getAttributionUrl:function _getAttributionUrl(){var map=this._map,zoom=map.getZoom(),bbox=map.getBounds().toBBoxString().split(",");return L.Util.template(L.TileLayer.Google.ATTRIBUTION_URL,{GoogleTileAPIKey:this.options.GoogleTileAPIKey,sessionToken:this._sessionToken,zoom:zoom,south:bbox[0],east:bbox[1],north:bbox[2],west:bbox[3]})},_makeGetRequest:function _makeGetRequest(xhttp,url){xhttp.open("GET",url,!0);xhttp.send()},_updateAttribution:function _updateAttribution(done){var map=this._map,_this=this;if(!map||!map.attributionControl)return;this._getSessionToken().then(function(){var attributionUrl=_this._getAttributionUrl();_this._exponentialTimeout=1e3;var xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){if(4===this.readyState&&200===this.status){map.attributionControl.removeAttribution(_this.attribution);_this.attribution=JSON.parse(this.responseText).copyright;map.attributionControl.addAttribution(_this.attribution);if(done&&!done.target){done(null,_this.attribution)}}else if(4===this.readyState){console.error("Attribution request unsuccessful, retrying in "+_this._exponentialTimeout/1e3+" seconds");setTimeout(function(){_this._exponentialTimeout*=2;_this._makeGetRequest(xhttp,attributionUrl)},_this._exponentialTimeout)}};_this._makeGetRequest(xhttp,attributionUrl)}.bind(this)).catch(function(e){if(done&&!done.target){done(e)}console.error("updateAttribution",e)})}});L.tileLayer.google=function(options){return new L.TileLayer.Google(options)};module.exports=L.TileLayer.Google}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}]},{},[1]);