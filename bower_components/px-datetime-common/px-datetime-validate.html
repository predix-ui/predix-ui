<!--
Copyright (c) 2018, General Electric

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
--><html><head><link rel="import" href="../app-localize-behavior/app-localize-behavior.html">

<script>(function(){var PxDatetimeBehavior=window.PxDatetimeBehavior=window.PxDatetimeBehavior||{};PxDatetimeBehavior.Validate=[Polymer.AppLocalizeBehavior,{properties:{isValid:{type:Boolean,value:!0,notify:!0},validationErrorMessage:{type:String,value:"invalid"},language:{type:String,value:"en"},useKeyIfMissing:{type:Boolean,value:!0},resources:{type:Object,value:function value(){return{en:{"Future dates are not allowed":"Future dates are not allowed","Past dates are not allowed":"Past dates are not allowed",Year:"Year",Month:"Month",Day:"Day",Hour:"Hour",Minute:"Minute",Second:"Second",Millisecond:"Millisecond","is not valid":"is not valid","This hour is not within a 12 hour clock":"This hour is not within a 12 hour clock"}}}}},observers:["_updateValidationEvent(validationErrorMessage)"],_validateInput:function _validateInput(format,tz){var inputArr=Polymer.dom(this.root).querySelectorAll(".cell"),inputStr=this._entryInputString(inputArr);if(inputStr){var inputMoment=Px.moment.tz(inputStr,format,tz);if(inputMoment.isValid()){this.set("isValid",!0);this.toggleClass("validation-error",!1,this.$.wrapper);this.fire("px-moment-valid",{element:this})}else{this.set("validationErrorMessage",this._determineValidationMessage(inputMoment,{}));this.set("isValid",!1);this.toggleClass("validation-error",!0,this.$.wrapper);this.fire("px-moment-invalid",{element:this})}}},_validateField:function _validateField(funcOrigin){var fieldNodes={},dateEntry=Polymer.dom(this.root).querySelector("#date"),timeEntry=Polymer.dom(this.root).querySelector("#time");if(null!==dateEntry){fieldNodes.dateCells=Polymer.dom(dateEntry.root).querySelectorAll(".cell")};if(null!==timeEntry){fieldNodes.timeCells=Polymer.dom(timeEntry.root).querySelectorAll(".cell")};var dateString=null!==dateEntry?this._entryInputString(fieldNodes.dateCells):"",timeString=null!==timeEntry?this._entryInputString(fieldNodes.timeCells):"";if(this.hideDate&&!timeString||this.hideTime&&!dateString||!this.hideDate&&!this.hideTime&&(!dateString||!timeString)){var entry=this.hideDate?timeEntry:dateEntry;return this._handleIncompleteEntries(funcOrigin,entry,fieldNodes)}var dateTimeString=dateString.trim()+" "+timeString.trim();dateTimeString=dateTimeString.split("\xA0").join(" ");var dateFormat=this.hideDate?"":this.dateFormat,timeFormat=this.hideTime?"":this.timeFormat,dateTimeFormat=dateFormat+" "+timeFormat,dateTimeMoment=Px.moment.tz(dateTimeString,dateTimeFormat,this.timeZone);if(this.momentObj){if(!/Y/.test(dateTimeFormat)){dateTimeMoment.year(this.momentObj.year())}if(!/M/.test(dateTimeFormat)){dateTimeMoment.month(this.momentObj.month())}if(!/D/.test(dateTimeFormat)){dateTimeMoment.date(this.momentObj.date())}if(!/[Hhk]/.test(dateTimeFormat)){dateTimeMoment.hour(this.momentObj.hour())}if(!/m/.test(dateTimeFormat)){dateTimeMoment.minute(this.momentObj.minute())}if(!/s/.test(dateTimeFormat)){dateTimeMoment.second(this.momentObj.second())}if(!/S/.test(dateTimeFormat)){dateTimeMoment.millisecond(this.momentObj.millisecond())}}return this._validateMomentObj(dateTimeMoment)},_validateMomentObj:function _validateMomentObj(validatingMomentObj){if(null===validatingMomentObj){this._validField(validatingMomentObj);return}var invalidObj={};invalidObj.futureSelection=this.blockFutureDates&&validatingMomentObj.isAfter(Px.moment.tz(Px.moment(),this.timeZone));invalidObj.pastSelection=this.blockPastDates&&validatingMomentObj.isBefore(Px.moment.tz(Px.moment(),this.timeZone));invalidObj.pastMaxSelection=this.maxDate&&validatingMomentObj.isAfter(this.maxDate);invalidObj.beforeMinSelection=this.minDate&&validatingMomentObj.isBefore(this.minDate);if(validatingMomentObj.isValid()&&!invalidObj.futureSelection&&!invalidObj.pastSelection&&!invalidObj.pastMaxSelection&&!invalidObj.beforeMinSelection){this._validField(validatingMomentObj);if(!this.momentObj||!this.momentObj.isSame(validatingMomentObj)){return validatingMomentObj}else if(this.momentObj.isSame(validatingMomentObj)){return"FieldSame"}}else{this._invalidField(validatingMomentObj,invalidObj);return!1}},_validField:function _validField(submittedMoment){if(!this.hideDate){var dateEntry=Polymer.dom(this.root).querySelector("#date");if(null!==dateEntry){dateEntry.toggleClass("validation-error",!1,dateEntry.$.wrapper)}}if(!this.hideTime){var timeEntry=Polymer.dom(this.root).querySelector("#time");if(null!==timeEntry){timeEntry.toggleClass("validation-error",!1,timeEntry.$.wrapper)}}this.set("fieldIsValid",!0);this.fire("px-moment-valid",{element:this})},_invalidField:function _invalidField(submittedMoment,invalidObj){this.set("validationErrorMessage",this._determineValidationMessage(submittedMoment,invalidObj));this.set("fieldIsValid",!1);this.toggleClass("validation-error",!0,this.$.fieldWrapper);this.fire("px-moment-invalid",{element:this})},_entryInputString:function _entryInputString(cells){for(var outputStr="",i=0,value;i<cells.length;i++){value=Polymer.dom(cells[i].root).querySelector(".datetime-entry-input").value;if(""===value){return""}if("Z"!==cells[i].momentFormat){outputStr=outputStr+value+cells[i].symbol}}return outputStr},_determineValidationMessage:function _determineValidationMessage(submittedMoment,invalidObj){if(!submittedMoment){return this.localize("Incomplete")}if(invalidObj.futureSelection){return this.localize("Future dates are not allowed")}else if(invalidObj.pastSelection){return this.localize("Past dates are not allowed")}else if(invalidObj.pastMaxSelection){return this.localize("Date is past max date")}else if(invalidObj.beforeMinSelection){return this.localize("Date is before min date")}else{var invalidAt=submittedMoment.invalidAt();if(-1!==invalidAt){switch(invalidAt){case 0:return this.localize("Year")+" "+submittedMoment._a[invalidAt]+" "+this.localize("is not valid");break;case 1:return this.localize("Month")+" "+(submittedMoment._a[invalidAt]+1)+" "+this.localize("is not valid");break;case 2:return this.localize("Day")+" "+submittedMoment._a[invalidAt]+" "+this.localize("is not valid");break;case 3:return this.localize("Hour")+" "+submittedMoment._a[invalidAt]+" "+this.localize("is not valid");break;case 4:return this.localize("Minute")+" "+submittedMoment._a[invalidAt]+" "+this.localize("is not valid");break;case 5:return this.localize("Second")+" "+submittedMoment._a[invalidAt]+" "+this.localize("is not valid");break;case 6:return this.localize("Millisecond")+" "+submittedMoment._a[invalidAt]+" "+this.localize("is not valid");break;}}else if(!0===submittedMoment.parsingFlags().bigHour){return this.localize("This hour is not within a 12 hour clock")}}},_updateValidationEvent:function _updateValidationEvent(validationErrorMessage){if(validationErrorMessage!==void 0){this.fire("px-validation-message",{validationErrorMessage:this.validationErrorMessage})}},_submitButtonState:function _submitButtonState(state){this.set("isSubmitButtonValid",state)},_handleIncompleteEntries:function _handleIncompleteEntries(funcOrigin,entry,fieldNodes){if("_momentChanged"===funcOrigin){return!1};if(!this.required){var dateEntryBlank=this.hideDate?!0:this._loopOverCellValues(fieldNodes.dateCells),timeEntryBlank=this.hideTime?!0:this._loopOverCellValues(fieldNodes.timeCells);if(dateEntryBlank&&timeEntryBlank){entry.toggleClass("validation-error",!1,entry.$.fieldWrapper);entry.set("isValid",!0);return"FieldBlank"}this._invalidField("",{})}else{this._invalidField("",{});return!1}},_loopOverCellValues:function _loopOverCellValues(cells){var isBlank=!0;if(cells&&cells.length){for(i=0;i<cells.length;i++){var cellInput=Polymer.dom(cells[i].root).querySelectorAll(".datetime-entry-input");if(""!==cellInput[0].value){isBlank=!1;break}};}return isBlank}}]})();</script>
</head><body></body></html>