function MakePromise(asap){function Promise(fn){if("object"!==babelHelpers.typeof(this)||"function"!==typeof fn)throw new TypeError;this._state=null;this._value=null;this._deferreds=[];doResolve(fn,resolve.bind(this),reject.bind(this))}function handle(deferred){var me=this;if(null===this._state){this._deferreds.push(deferred);return}asap(function(){var cb=me._state?deferred.onFulfilled:deferred.onRejected;if("function"!==typeof cb){(me._state?deferred.resolve:deferred.reject)(me._value);return}var ret;try{ret=cb(me._value)}catch(e){deferred.reject(e);return}deferred.resolve(ret)})}function resolve(newValue){try{if(newValue===this)throw new TypeError;if(newValue&&("object"===babelHelpers.typeof(newValue)||"function"===typeof newValue)){var then=newValue.then;if("function"===typeof then){doResolve(then.bind(newValue),resolve.bind(this),reject.bind(this));return}}this._state=!0;this._value=newValue;finale.call(this)}catch(e){reject.call(this,e)}}function reject(newValue){this._state=!1;this._value=newValue;finale.call(this)}function finale(){for(var i=0,len=this._deferreds.length;i<len;i++){handle.call(this,this._deferreds[i])}this._deferreds=null}function doResolve(fn,onFulfilled,onRejected){var done=!1;try{fn(function(value){if(done)return;done=!0;onFulfilled(value)},function(reason){if(done)return;done=!0;onRejected(reason)})}catch(ex){if(done)return;done=!0;onRejected(ex)}}Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)};Promise.prototype.then=function(onFulfilled,onRejected){var me=this;return new Promise(function(resolve,reject){handle.call(me,{onFulfilled:onFulfilled,onRejected:onRejected,resolve:resolve,reject:reject})})};Promise.resolve=function(value){if(value&&"object"===babelHelpers.typeof(value)&&value.constructor===Promise){return value}return new Promise(function(resolve){resolve(value)})};Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})};return Promise}if("undefined"!==typeof module){module.exports=MakePromise}