<!--
    Relative paths assume component is being run from inside an app or another component, where dependencies are flat
    siblings. When this component is run from its own repo (e.g. tests, examples), we assume the server is started with
    'gulp serve' (or similar server setup) to enable correct finding of bower dependencies for local runs.
--><html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../px-icon-set/px-icon-set-utility.html">
<link rel="import" href="../px-icon-set/px-icon.html">
<link rel="import" href="../px-dropdown/px-dropdown.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../px-app-helpers/px-app-asset/px-app-asset-behavior-graph.html">
<link rel="import" href="../px-app-helpers/px-app-asset/px-app-asset-behavior-selectable.html">
<link rel="import" href="css/px-breadcrumbs-styles.html">

<!--
### Usage

Note: you **must** provide either `selected` or `selectedRoute` or the breadcrumb will not know
what path to display and therefore will not appear at all.

    <px-breadcrumbs items='[[items]]' selectedRoute='["id1"]'></px-breadcrumbs>


### Styling

The following custom properties and mixins are also available for styling:

Custom property | Description
:----------------|:-------------
`--px-breadcrumbs-chevron-color` | Color of the chevrons between breadcrumb items
`--px-breadcrumbs-text-color--disabled` | Text color for a non-selectable top-level item

@element px-breadcrumbs
@blurb Breadcrumb drop down displays the navigational path of the user through a context browser.
The breadcrumb links provide a way to see the path of navigation or contextual relationship between objects.
It also provides a quick way to navigate backwards within a path or within a specific context.
@homepage index.html
@demo index.html
-->
</head><body><dom-module id="px-breadcrumbs">
  <template>
    <style include="px-breadcrumbs-styles"></style>
    <div class="container flex">
      <ul class="topPath">
        <template is="dom-repeat" items="[[_mainPathItems]]">
          <template is="dom-if" if="[[_isNotFirstItemInData(index, _mainPathItems)]]">
            <li class="breadcrumbTopItem flex flex--middle">
              <span class$="rightAngle [[_getSeparatorSize(clickOnlyMode)]]"><px-icon icon="px-utl:chevron-right"></px-icon></span>
            </li>
          </template>
          <li data-text="[[_getItemProp(item, keys.label)]]" data-item="[[item]]" data-index="[[index]]" class$="breadcrumbTopItem u-ph- flex flex--row flex--middle [[_getDisabled(item)]]" on-tap="_onPathTap">
            <template is="dom-if" if="[[_isLabel(item, clickOnlyMode)]]">
              <span class="actionable actionable--action">[[_getItemProp(item, keys.label)]]</span>
            </template>
            <template is="dom-if" if="[[_isDropdown(item, clickOnlyMode)]]">
              <px-dropdown display-value="[[_getItemProp(item, keys.label)]]" items="[[_clickedItemChildren]]" search-mode="[[searchMode]]" button-style="bare" disable-clear=""></px-dropdown>
            </template>
            <template is="dom-if" if="[[_isOverflow(item)]]">
              <px-dropdown id="dropdown" items="[[_clickedItemChildren]]" button-style="icon" icon="px-nav:more"></px-dropdown>
            </template>
          </li>
        </template>
      </ul>
    </div>
  </template>
</dom-module>
<script>(function(){var Breadcrumbs=function(){function Breadcrumbs(breadcrumbEl,graph,clickOnlyMode){var breadcrumbs=3<arguments.length&&arguments[3]!==void 0?arguments[3]:[],keys=4<arguments.length?arguments[4]:void 0;babelHelpers.classCallCheck(this,Breadcrumbs);this.keys=keys;this.breadcrumbEl=breadcrumbEl;this.graph=graph;this.clickOnlyMode=clickOnlyMode;this.breadcrumbs=breadcrumbs;this.map=new WeakMap;this.ctx=this._createCanvas(breadcrumbEl);this._preShortenItems(this.breadcrumbs);return this}babelHelpers.createClass(Breadcrumbs,[{key:"_addToWeakMap",value:function _addToWeakMap(item){var cachedItem=this.map.get(item)||null;if(!cachedItem){this.map.set(item,item)}}},{key:"_preShortenItems",value:function _preShortenItems(items){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=items[Symbol.iterator](),_step,item;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){item=_step.value;this._getShortenedText(item)}}catch(err){_didIteratorError=!0;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&null!=_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"_getShortenedText",value:function _getShortenedText(item){var cachedItem=this.map.get(item)||{},label=this._getItemProp(item,this.keys.label);if(!cachedItem.shortText&&13<label.length){cachedItem.shortText="".concat(label.substr(0,6),"...").concat(label.substr(label.length-6))}else if(!cachedItem.shortText){cachedItem.shortText=label}this.map.set(item,cachedItem);return cachedItem.shortText}},{key:"_sizeOfIndividualFullItem",value:function _sizeOfIndividualFullItem(item){var cachedItem=this.map.get(item)||{},label=this._getItemProp(item,this.keys.label);cachedItem.fullSize=cachedItem.fullSize||parseInt(this.ctx.measureText(label).width,10);this.map.set(item,cachedItem);return cachedItem.fullSize}},{key:"_sizeOfIndividualShortItem",value:function _sizeOfIndividualShortItem(item){var cachedItem=this.map.get(item)||{};cachedItem.shortSize=cachedItem.shortSize||parseInt(this.ctx.measureText(cachedItem.shortText).width,10);this.map.set(item,cachedItem);return cachedItem.shortSize}},{key:"_calculateSizeOfBreadcrumbs",value:function _calculateSizeOfBreadcrumbs(strArray){var useFullSize=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0;if(strArray){var accum=0,i=0,len=strArray.length,sizeOfItem;for(i=0;i<len;i++,sizeOfItem=null){if(useFullSize){sizeOfItem=this._sizeOfIndividualFullItem(strArray[i])}else{sizeOfItem=this._sizeOfIndividualShortItem(strArray[i])}var source=strArray[i].source?strArray[i].source:strArray[i];accum+=sizeOfItem;if("..."!==this._getItemProp(strArray[i],this.keys.label)&&this.graph.hasSiblings(source)&&!this.clickOnlyMode){accum+=21}accum+=20;if(i!==len-1){accum+=this.clickOnlyMode?30:15}}return accum+10}}},{key:"_createCanvas",value:function _createCanvas(breadcrumbEl){var style=window.getComputedStyle(breadcrumbEl,null),fontSize=style.getPropertyValue("font-size"),fontFamily=style.getPropertyValue("font-family"),canvas=document.createElement("canvas");canvas.height=20;canvas.width=9999;var ctx=canvas.getContext("2d");ctx.font=fontSize+" "+fontFamily;return ctx}},{key:"_getItemProp",value:function _getItemProp(item,key){if(item&&"object"===babelHelpers.typeof(item)&&"string"===typeof key&&item.hasOwnProperty(key)){return item[key]}return null}},{key:"sizeOfFullBreadcrumbs",get:function get(){this.__sizeOfFullBreadcrumbs=this.__sizeOfFullBreadcrumbs||this._calculateSizeOfBreadcrumbs(this.breadcrumbs);return this.__sizeOfFullBreadcrumbs}},{key:"sizeOfAllShortenedItemsExcludingLastItem",get:function get(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs.slice(0,this.breadcrumbs.length-1),!1)}},{key:"sizeOfFullLastItem",get:function get(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs.slice(-1))}},{key:"sizeOfShortLastItem",get:function get(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs.slice(-1),!1)}},{key:"lastItemFull",get:function get(){return this.breadcrumbs.slice(-1)[0]}},{key:"lastItemShort",get:function get(){return this.shortenedItems.slice(-1)[0]}},{key:"shortenedItems",get:function get(){var _this=this;this.__shortenedItems=this.__shortenedItems||this.breadcrumbs.map(function(item){var wrapper={source:item,isTruncated:!0},labelKey=_this.keys.label,childrenKey=_this.keys.children;wrapper[labelKey]=_this._getShortenedText(item);wrapper[childrenKey]=_this._getItemProp(item,_this.keys.children);wrapper.selectedItem=item.selectedItem;wrapper.hasChildren=item.hasChildren;wrapper.isSelectable=item.isSelectable;return wrapper});return this.__shortenedItems}},{key:"sizeOfEllipsis",get:function get(){return 36}},{key:"sizeOfAllShortenedItems",get:function get(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs,!1)}},{key:"allShortenedItemsExcludingLast",get:function get(){return this.shortenedItems.slice(0,this.shortenedItems.length-1)}}]);return Breadcrumbs}();window.pxBreadcrumbs={};window.pxBreadcrumbs.Breadcrumbs=Breadcrumbs;Polymer({is:"px-breadcrumbs",behaviors:[PxAppBehavior.AssetGraph,PxAppBehavior.AssetSelectable,Polymer.IronResizableBehavior],properties:{_mainPathItems:{type:Array,value:function value(){return[]},readOnly:!0},_clickPathItem:{type:Object,value:function value(){return{}}},_clickedItemChildren:{type:Array,value:function value(){return[]}},_selectedItem:{type:Object},_ulWidth:{type:Number,value:0},_selectedItemPath:{type:Array,value:function value(){return[]},readOnly:!0},clickOnlyMode:{type:Boolean,value:!1,observer:"_getBreadcrumbsObj"},searchMode:{type:Boolean,value:!1},_hideNoResultLi:{type:Boolean,value:!0},_breadcrumbsObj:{type:Object}},listeners:{"iron-resize":"_onResize","px-app-asset-selected":"_onSelect","px-dropdown-selection-changed":"_dropdownTap","px-app-asset-graph-created":"_getBreadcrumbsObj"},observers:["_getDisplayMode(_ulWidth, _selectedItemPath, _breadcrumbsObj)"],detached:function detached(){if(this.isDebouncerActive("windowResize"))this.cancelDebouncer("windowResize")},_getItemProp:function _getItemProp(item,key){if(item&&"object"===babelHelpers.typeof(item)&&"string"===typeof key&&item.hasOwnProperty(key)){return item[key]}return null},_onResize:function _onResize(){var _this2=this;this.debounce("windowResize",function(){window.requestAnimationFrame(function(){var breadcrumbsContainer=Polymer.dom(_this2.root).querySelector(".container"),breadcrumbsUlContainer=Polymer.dom(breadcrumbsContainer).querySelector("ul"),bcUlContainerRect=breadcrumbsUlContainer.getBoundingClientRect();_this2.set("_ulWidth",bcUlContainerRect.width)})},50)},_getBreadcrumbsObj:function _getBreadcrumbsObj(){var itemPath=this._selectedItemPath||[],graph=this._assetGraph,clickOnlyMode=this.clickOnlyMode;if(!itemPath.length||!graph)return;this.set("_breadcrumbsObj",new window.pxBreadcrumbs.Breadcrumbs(this,graph,clickOnlyMode,itemPath,this.keys));this.updateStyles()},_getDisplayMode:function _getDisplayMode(_ulWidth,_selectedItemPath,_breadcrumbsObj){var ulWidth=this._ulWidth,itemPath=this._selectedItemPath||[],breadcrumbsObj=this._breadcrumbsObj;if(!ulWidth||!itemPath||!breadcrumbsObj)return;if(ulWidth>breadcrumbsObj.sizeOfFullBreadcrumbs){this._set_mainPathItems(itemPath);return}if(ulWidth>breadcrumbsObj.sizeOfAllShortenedItemsExcludingLastItem+breadcrumbsObj.sizeOfFullLastItem){var strArrayShortenedWithFullLastItem=breadcrumbsObj.allShortenedItemsExcludingLast.concat(breadcrumbsObj.lastItemFull);this._set_mainPathItems(strArrayShortenedWithFullLastItem);return}if(ulWidth>breadcrumbsObj.sizeOfAllShortenedItems){var strArrayShortened=breadcrumbsObj.shortenedItems;this._set_mainPathItems(strArrayShortened);return}this._set_mainPathItems(this._createArrayWithOverflow(itemPath,ulWidth,breadcrumbsObj))},_createArrayWithOverflow:function _createArrayWithOverflow(strArray,_ulWidth,breadcrumbsObj){var pointer=0,currentAccumSize=breadcrumbsObj.sizeOfAllShortenedItemsExcludingLastItem,sizeOfFullLastItem=breadcrumbsObj.sizeOfFullLastItem,sizeOfEllipsis=36,noRoomForFullLastItem=!1,lastItem={},slicedStrArray=[],labelKey=this.keys.label,overflowObj={};overflowObj.hasChildren=!0;overflowObj[labelKey]="...";while(_ulWidth<sizeOfEllipsis+currentAccumSize+sizeOfFullLastItem){if(pointer===strArray.length-1){noRoomForFullLastItem=!0;break}var removedSize=breadcrumbsObj._sizeOfIndividualShortItem(strArray[pointer]);currentAccumSize-=removedSize;pointer++}var childKey=this.keys.children;overflowObj[childKey]=strArray.slice(0,pointer);overflowObj[childKey].forEach(function(child){child.highlighted=!1});lastItem=noRoomForFullLastItem?breadcrumbsObj.lastItemShort:breadcrumbsObj.lastItemFull;slicedStrArray=[overflowObj].concat(breadcrumbsObj.shortenedItems.slice(pointer,strArray.length-1)).concat(lastItem);return slicedStrArray},_isNotFirstItemInData:function _isNotFirstItemInData(index){return 0!==index},_onSelect:function _onSelect(evt){this._set_selectedItemPath(evt.detail.path);this._getBreadcrumbsObj()},_doesItemHaveSiblings:function _doesItemHaveSiblings(itemInPath){var graph=this._assetGraph,source=itemInPath.source?itemInPath.source:itemInPath,isItemOverflow="..."===this._getItemProp(itemInPath,this.keys.label)?!0:!1;return isItemOverflow?!0:graph.hasSiblings(source)},_dropdownTap:function _dropdownTap(evt){var _this3=this;evt=Polymer.dom(evt);var target=evt.rootTarget,newSelectItem;if(target&&target.items){newSelectItem=target.items.find(function(item){var id=_this3._getItemProp(item,_this3.keys.id);if(id===evt.event.detail.key){return item}})}this._changePathFromClick(newSelectItem||{})},_changePathFromClick:function _changePathFromClick(item){this.select(item);this.fire("px-breadcrumbs-item-changed",item)},_onPathTap:function _onPathTap(evt){var _this4=this,dataItem=evt.model.item.source?evt.model.item.source:evt.model.item,isClickedItemOverflow="..."===this._getItemProp(dataItem,this.keys.label)?!0:!1;if(!1===dataItem.isSelectable)return;if(this.clickOnlyMode&&!isClickedItemOverflow){this._changePathFromClick(dataItem);return}if(this._doesItemHaveSiblings(dataItem)||isClickedItemOverflow){var graph=this._assetGraph,siblings=!isClickedItemOverflow?graph.getSiblings(dataItem):this._getItemProp(dataItem,this.keys.children),siblingsCopy=siblings.map(function(sibling){return Object.assign({},sibling,{key:_this4._getItemProp(sibling,_this4.keys.id),val:_this4._getItemProp(sibling,_this4.keys.label),disabled:!1===sibling.isSelectable})});this.set("_clickedItemChildren",siblingsCopy);this.set("_clickPathItem",dataItem)}else{this.set("_clickedItemChildren",[]);this._changePathFromClick(dataItem)}},_isLabel:function _isLabel(item,clickOnlyMode){return clickOnlyMode&&"..."!==this._getItemProp(item,this.keys.label)||!clickOnlyMode&&!this._doesItemHaveSiblings(item)},_isDropdown:function _isDropdown(item,clickOnlyMode){return!clickOnlyMode&&"..."!==this._getItemProp(item,this.keys.label)&&this._doesItemHaveSiblings(item)},_isOverflow:function _isOverflow(item){return"..."===this._getItemProp(item,this.keys.label)},_getSeparatorSize:function _getSeparatorSize(clickOnlyMode){return this.clickOnlyMode?"small":"large"},_getDisabled:function _getDisabled(item){return!1===item.isSelectable?"disabled":""}})})();</script>
</body></html>