<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="px-demo-theme-util.html">

<script>(function(){function inFrame(){try{return window.self!==window.top}catch(e){return!0}};Polymer({is:"px-demo-theme-switcher",properties:{isDarkTheme:{type:Boolean,value:!1,observer:"_themeChanged"}},_themeChanged:function _themeChanged(isDarkTheme,wasDarkTheme){if(!1===isDarkTheme&&"undefined"===typeof wasDarkTheme){return}if(isDarkTheme&&!wasDarkTheme){var darkTheme=PxDemo.ThemeUtil.getDarkThemeProperties();if(null===darkTheme){console.log("Dark theme not loaded. Try again later.");return}Polymer.updateStyles(darkTheme)}else if(!isDarkTheme&&wasDarkTheme){var defaultTheme=PxDemo.ThemeUtil.getDefaultThemeProperties();if(null===defaultTheme){console.log("Theme not loaded. Try again later.");return}Polymer.updateStyles(defaultTheme)}}});Polymer({is:"px-demo-theme-switcher-frame",properties:{origin:{type:String},isDarkTheme:{type:Boolean,notify:!0}},created:function created(){this._boundMessageHandler=this._handleParentMessage.bind(this);this._inFrame=inFrame()},attached:function attached(){if(this._inFrame){window.addEventListener("message",this._boundMessageHandler,!1);this._requestParentTheme()}},detached:function detached(){if(this._inFrame){window.removeEventListener("message",this._boundMessageHandler,!1)}},_handleParentMessage:function _handleParentMessage(evt){if(evt.origin!==this.origin||"THEME_STATUS"!==evt.data.type||"boolean"!==typeof evt.data.IS_DARK_THEME){return}this.isDarkTheme=evt.data.IS_DARK_THEME},_requestParentTheme:function _requestParentTheme(){if(!this.origin)return;parent.postMessage({type:"REQUEST_THEME_STATUS"},this.origin)}});Polymer({is:"px-demo-theme-switcher-parent",properties:{origin:{type:String},isDarkTheme:{type:Boolean,value:null,observer:"_themeChanged"},childFrame:{type:HTMLElement,value:null,observer:"_frameChanged"}},created:function created(){this._boundMessageHandler=this._handleChildMessage.bind(this)},detached:function detached(){if(this.childFrame){this.childFrame=null}},_themeChanged:function _themeChanged(){if(this.childFrame&&this.childFrame.contentWindow&&"boolean"===typeof this.isDarkTheme){this._sendThemeToChild(this.childFrame.contentWindow,this.isDarkTheme)}},_handleChildMessage:function _handleChildMessage(evt){if(evt.origin!==this.origin||"REQUEST_THEME_STATUS"!==evt.data.type){return}this._themeChanged()},_sendThemeToChild:function _sendThemeToChild(child,isDarkTheme){if(!this.origin)return;child.postMessage({type:"THEME_STATUS",IS_DARK_THEME:isDarkTheme},this.origin)},_frameChanged:function _frameChanged(newFrame,oldFrame){if(oldFrame&&oldFrame.contentWindow){oldFrame.contentWindow.removeEventListener("message",this._boundMessageHandler,!1)}if(newFrame&&newFrame.contentWindow){newFrame.contentWindow.addEventListener("message",this._boundMessageHandler,!1);this._themeChanged()}}})})();</script>
</head><body></body></html>