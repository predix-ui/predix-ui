<!--
Copyright (c) 2018, General Electric

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
--><html><head><link rel="import" href="px-vis-behavior-common.html">
<link rel="import" href="px-vis-behavior-d3.html">

<script>var PxVisBehaviorDrag=window.PxVisBehaviorDrag=window.PxVisBehaviorDrag||{};PxVisBehaviorDrag.basicProps=[{properties:{_dragging:{type:Object,value:function value(){return{}}},dragBehavior:{type:Object,notify:!0}},_position:function _position(d){var v=this._dragging[d];return null==v?this.x(d):v},transition:function transition(g){return g.transition().duration(500)}},PxVisBehavior.sizing,PxVisBehavior.dimensions,PxVisBehavior.dataset,PxVisBehavior.completeSeriesConfig,PxVisBehaviorD3.dynamicRedraw,PxVisBehavior.mutedSeries,PxVisBehaviorD3.axes,PxVisBehavior.radial];PxVisBehaviorDrag.parallelAxisDrag=[{createParallelAxisDrag:function createParallelAxisDrag(){this.dragBehavior=Px.d3.drag().container(this.dragContainerElem).on("start.drag",this._onDragStart.bind(this)).on("drag.drag",this._onDrag.bind(this)).on("end.drag",this._onDragEnd.bind(this));this.notifyPath("dragBehavior",this.dragBehavior)},_onDragStart:function _onDragStart(){var d=this.dimension;this._dragging={};this._dragging[d]=this.x(d)},_onDrag:function _onDrag(){this.debounce("drag",function(e){if(this.radial){this._radialDrag(e)}else{this._linearDrag(e)}if(this.redrawSeries&this.dynamicRedraw){_this.fire("px-vis-redraw-lines")}this.svg.attr("transform",this._radialOrLinear.bind(this));this.fire("px-vis-recalc-title-location")}.bind(this,Px.d3.event),10)},_onDragEnd:function _onDragEnd(){this._dragging={};this.transition(this.svg).attr("transform",function(){return this.radial?"rotate("+(180*this.x(this.dimension)/Math.PI+180)+")":"translate("+this.x(this.dimension)+",0)"}.bind(this));if(this.redrawSeries){this.set("completeSeriesConfig.*.x",this.dimensions);this.fire("px-vis-complete-series-config",{data:this.dimensions,dataVar:"completeSeriesConfig.*.x",method:"set"});this.fire("px-vis-redraw-lines")}this.fire("px-axis-done")},_linearDrag:function _linearDrag(e){var d=this.dimension;this._dragging[d]=Math.min(this.width,Math.max(0,e.x));var swappedDim=this._linearSort(this.dimensions,this.dimension,e);if(swappedDim){this.fire("px-vis-drag-dimension-swapped",{dimensions:this.dimensions,swappedDim:swappedDim,dimension:this.dimension})}},_radialDrag:function _radialDrag(e){var _MathPI=Math.PI,angle=Math.atan2(e.y,e.x)+_MathPI/2,angle_2PI=0>angle?angle+2*_MathPI:angle,d=this.dimension;this._dragging[d]=angle_2PI;var swappedDim=this._radialSort(this.dimensions,d,angle_2PI);if(swappedDim){this.fire("px-vis-drag-dimension-swapped",{dimensions:this.dimensions,swappedDim:swappedDim,dimension:this.dimension})}},_linearSort:function _linearSort(dims,d,e){var len=dims.length-1,index=dims.indexOf(d),left_index=0===index?-1:index-1,right_index=index===len?-1:index+1,myPos=Math.min(this.width,Math.max(0,e.x)),leftPos=-1===left_index?"edge":this.x(dims[left_index]),rightPos=-1===right_index?"edge":this.x(dims[right_index]),swapWithDim=null;if("edge"!==leftPos&&myPos<leftPos){swapWithDim=dims[left_index];dims[index]=swapWithDim;dims[left_index]=d}else if("edge"!==rightPos&&myPos>rightPos){swapWithDim=dims[right_index];dims[index]=swapWithDim;dims[right_index]=d}return swapWithDim},_radialSort:function _radialSort(dims,d,angle){var _MathPI2=Math.PI,len=dims.length-1,index=dims.indexOf(d),left_index=0===index?len:index-1,right_index=index===len?0:index+1,swapWithDim;if(0===index){var right_bound=2===len?_MathPI2:this.x(dims[right_index+1]),left_bound=2===len?_MathPI2:this.x(dims[left_index-1]);if(angle>this.x(dims[right_index])&&angle<right_bound){swapWithDim=dims[right_index];dims[index]=dims[right_index];dims[right_index]=d}else if(angle<this.x(dims[left_index])&&angle>left_bound){swapWithDim=dims[left_index];dims[index]=dims[left_index];dims[left_index]=d}}else if(0===left_index){var bounding_angle=2===len?3*_MathPI2/2:this.x(dims[len]);if(angle>bounding_angle){swapWithDim=dims[left_index];dims[index]=dims[left_index];dims[left_index]=d}else if(angle>this.x(dims[right_index])){swapWithDim=dims[right_index];dims[index]=dims[right_index];dims[right_index]=d}}else if(0===right_index){var bounding_angle=2===len?_MathPI2/2:this.x(dims[1]);if(angle<=bounding_angle){swapWithDim=dims[right_index];dims[index]=dims[right_index];dims[right_index]=d}else if(angle<this.x(dims[left_index])){swapWithDim=dims[left_index];dims[index]=dims[left_index];dims[left_index]=d}}else{if(angle<this.x(dims[left_index])){swapWithDim=dims[left_index];dims[index]=dims[left_index];dims[left_index]=d}else if(angle>this.x(dims[right_index])){swapWithDim=dims[right_index];dims[index]=dims[right_index];dims[right_index]=d}}return swapWithDim},_radialOrLinear:function _radialOrLinear(){var d=this.dimension;return this.radial?"rotate("+(180*this._position(d)/Math.PI+180)+")":"translate("+this._position(d)+",0)"}},PxVisBehaviorDrag.basicProps];PxVisBehaviorDrag.cartesianDrag=[{createCartesianDrag:function createCartesianDrag(){var dragBehavior=Px.d3.drag().container(this.dragContainerElem).on("start.drag",this._onCartesianDragStart.bind(this)).on("drag.drag",this._onCartesianDrag.bind(this)).on("end.drag",this._onCartesianDragEnd.bind(this));this.set("dragBehavior",dragBehavior)},_onCartesianDragStart:function _onCartesianDragStart(){this._dragging={};this._dragging[this.dimension]=this.x(this.dimension)},_onCartesianDrag:function _onCartesianDrag(){var _Mathmin=Math.min,_Mathmax=Math.max;this.debounce("drag",function(e){var rDims=this.x.rightDomain(),lDims=this.x.leftDomain(),d=this.dimension,side=-1!==rDims.indexOf(d)?"right":"left",num=-1!==rDims.indexOf(d)?rDims.indexOf(d):lDims.indexOf(d),orientationChanged=!1,swappedDim=null,dimToLeft=null,dimToRight=null,posDim,posDimToLeft,posDimToRight,leftOffset=0,rightOffset=0;if("left"===side){this._dragging[d]=_Mathmin(this.width,_Mathmax(-this.margin.left,e.x));dimToLeft=lDims[num+1]?lDims[num+1]:null;if(0===num){dimToRight=rDims[0]?rDims[0]:null;rightOffset=this.width-this.margin.left*lDims.length}else{dimToRight=lDims[num-1]}}else if("right"===side){this._dragging[d]=_Mathmin(this.width+this.margin.right,_Mathmax(-this.margin.left,e.x))-this.width+this.margin.left+this.margin.right;dimToRight=rDims[num+1]?rDims[num+1]:null;if(0===num){dimToLeft=lDims[0]?lDims[0]:null;leftOffset=this.margin.right*rDims.length-this.width}else{dimToLeft=rDims[num-1]}}posDim=this._position(d);posDimToLeft=dimToLeft?this.x(dimToLeft)+leftOffset:null;posDimToRight=dimToRight?this.x(dimToRight)+rightOffset:null;if((posDimToLeft||0===posDimToLeft)&&posDim<posDimToLeft){swappedDim=dimToLeft;if(0===num&&"right"===side){orientationChanged=!0}var n=this.dimensions.indexOf(d),nl=this.dimensions.indexOf(dimToLeft);this.dimensions[n]=dimToLeft;this.dimensions[nl]=d}else if((posDimToRight||0===posDimToRight)&&posDim>posDimToRight){swappedDim=dimToRight;if(0===num&&"left"===side){orientationChanged=!0}var n=this.dimensions.indexOf(d),nr=this.dimensions.indexOf(dimToRight);this.dimensions[n]=dimToRight;this.dimensions[nr]=d}if(swappedDim&&!orientationChanged){var l=lDims.length,r=rDims.length,newLDims=this.dimensions.slice(0,l),newRDims=this.dimensions.slice(l);this.x.leftDomain(newLDims);this.x.rightDomain(newRDims);this.fire("px-vis-drag-dimension-swapped",{dimensions:this.dimensions,lDims:newLDims,rDims:newRDims,swappedDim:swappedDim})}else if(orientationChanged){var l=lDims[0];lDims[0]=rDims[0];rDims[0]=l;this.x.leftDomain(lDims);this.x.rightDomain(rDims);this.dimensions=lDims.concat(rDims);this.fire("px-axis-orientation-changed")}else{var l=lDims.length,r=rDims.length;this.x.leftDomain(this.dimensions.slice(0,l));this.x.rightDomain(this.dimensions.slice(l))}this.svg.attr("transform",function(){return"translate("+this._position(this.dimension)+",0)"}.bind(this))}.bind(this,Px.d3.event),1)},_onCartesianDragEnd:function _onCartesianDragEnd(){this._dragging={};this.transition(this.svg).attr("transform",function(){return"translate("+this.x(this.dimension)+",0)"}.bind(this));this.fire("px-axis-drag-done")}},PxVisBehaviorDrag.basicProps];</script>
</head><body></body></html>