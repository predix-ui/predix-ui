<!--
Copyright (c) 2018, General Electric

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
--><html><head><link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../vaadin-grid/vaadin-grid.html">
<link rel="import" href="../vaadin-grid/vaadin-grid-selection-column.html">
<link rel="import" href="../vaadin-grid/vaadin-grid-sorter.html">
<link rel="import" href="../px-spinner/px-spinner.html">
<link rel="import" href="px-data-grid.html">
<link rel="import" href="px-data-grid-column.html">
<link rel="import" href="px-auto-filter-field.html">
<link rel="import" href="px-data-grid-navigation.html">
<link rel="import" href="px-data-grid-theme.html">
<link rel="import" href="px-data-grid-selection-column.html">
<link rel="import" href="../app-localize-behavior/app-localize-behavior.html">

<link rel="import" href="px-data-grid-string-renderer.html">
<link rel="import" href="px-data-grid-cell-content-wrapper.html">
<link rel="import" href="css/px-data-grid-paginated-styles.html">

</head><body><dom-module id="px-data-grid-paginated">
  <template>
    <style include="px-data-grid-paginated-styles"></style>

    <px-data-grid remote-data-provider="{{_currentDataProvider}}" selection-mode="{{selectionMode}}" selected-items="{{selectedItems}}" hide-selection-column="{{hideSelectionColumn}}" resizable="{{resizable}}" striped="{{striped}}" ellipsis="{{ellipsis}}" multi-sort="{{multiSort}}" columns="{{columns}}" column-reordering-allowed="{{columnReorderingAllowed}}" hide-action-menu="{{hideActionMenu}}" language="{{language}}" resources="{{resources}}" auto-filter="{{autoFilter}}" grid-height="{{gridHeight}}" item-id-path="{{itemIdPath}}" table-actions="{{tableActions}}" item-actions="{{itemActions}}" offer-filter-saving="{{offerFilterSaving}}" filterable="{{filterable}}" editable="{{editable}}" highlight="{{highlight}}" default-column-width="{{defaultColumnWidth}}" default-column-flex-grow="{{defaultColumnFlexGrow}}" string-comparators="{{stringComparators}}" number-comparators="{{numberComparators}}">
    </px-data-grid>

    <px-data-grid-navigation total-item-count="[[size]]" on-navigation-change="_onNavigationChange" selectable-page-sizes="[[selectablePageSizes]]" page-size="[[pageSize]]" current-page="[[page]]" number-of-pages="[[_calcNumPages(size, pageSize)]]" hide-page-list="[[_hidePageList(autoHidePageList, size, pageSize)]]" language="[[language]]" resources="[[resources]]">
    </px-data-grid-navigation>

  </template>
  <script>{var DataGridPaginatedElement=function(_Polymer$mixinBehavio){babelHelpers.inherits(DataGridPaginatedElement,_Polymer$mixinBehavio);function DataGridPaginatedElement(){babelHelpers.classCallCheck(this,DataGridPaginatedElement);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(DataGridPaginatedElement).apply(this,arguments))}babelHelpers.createClass(DataGridPaginatedElement,[{key:"ready",value:function ready(){babelHelpers.get(babelHelpers.getPrototypeOf(DataGridPaginatedElement.prototype),"ready",this).call(this);this._resolvePxDataGrid()}},{key:"_resolvePxDataGrid",value:function _resolvePxDataGrid(){if(this._pxDataGrid===void 0){this._pxDataGrid=this.shadowRoot.querySelector("px-data-grid")}return this._pxDataGrid}},{key:"_tableDataChanged",value:function _tableDataChanged(tableData,splices,isAttached){if(!isAttached){return}if(0<this.selectedItems.length){this.selectedItems=[]}if(tableData){this._hasLocalDataProvider=!0;this._currentDataProvider=this._wrapDataProvider(this._localDataProvider)}}},{key:"_remoteDataProviderChanged",value:function _remoteDataProviderChanged(provider){this._hasLocalDataProvider=!1;this._currentDataProvider=this._wrapDataProvider(provider)}},{key:"_wrapDataProvider",value:function _wrapDataProvider(provider){this._baseDataProvider=provider;var wrappedProvider=function(params,callback){params.page=this.page-1;params.pageSize=this.pageSize;this._baseDataProvider(params,function(items,size){this.size=size;var numDisplayedRows=items.length>params.pageSize?params.pageSize:items.length;callback(items,numDisplayedRows);this._resolvePxDataGrid()._populateTableColumns(items)}.bind(this))}.bind(this);return wrappedProvider}},{key:"_localDataProvider",value:function _localDataProvider(params,callback){this._resolvePxDataGrid();var items=Array.isArray(this.tableData)?this.tableData:[],response=this._localDataResolver(params,items);callback(response.items,response.total)}},{key:"_localDataResolver",value:function _localDataResolver(params,items){var _this=this;if(params.filters){var autoFilters=params.filters.filter(function(filter){return filter.value.isAutoFilter});if(autoFilters.length&&this._pxDataGrid._vaadinGrid._checkPaths(autoFilters,"filtering",items)){items=this._pxDataGrid._applyAutoFilter(items,params.filters)}var advancedFilters=params.filters.filter(function(filter){return filter.value.isAdvancedFilter}).map(function(filter){return filter.value.filter});if(advancedFilters&&0!=advancedFilters.length){items=this._pxDataGrid._applyCustomFilter(items,this._pxDataGrid.columns,advancedFilters)}}if(params.sortOrders&&params.sortOrders.length&&this._pxDataGrid._vaadinGrid._checkPaths(this._pxDataGrid._sorters,"sorting",items)){var multiSort=function multiSort(a,b){return params.sortOrders.map(function(sort){if("asc"===sort.direction){return _this._pxDataGrid._compare(Polymer.Base.get(sort.path,a),Polymer.Base.get(sort.path,b))}else if("desc"===sort.direction){return _this._pxDataGrid._compare(Polymer.Base.get(sort.path,b),Polymer.Base.get(sort.path,a))}return 0}).reduce(function(p,n){return p?p:n},0)};items=items.slice(0).sort(multiSort)}var total=items.length,start=params.page*params.pageSize,end=start+params.pageSize;return{items:items.slice(start,end),total:total}}},{key:"_getAllLocalItems",value:function _getAllLocalItems(){if(this._hasLocalDataProvider){var items=(Array.isArray(this.tableData)?this.tableData:[]).slice(0);return this._localDataResolver({page:0,pageSize:this.tableData.length},items)}else{return[]}}},{key:"_onNavigationChange",value:function _onNavigationChange(event){if(this.pageSize!==event.detail.pageSize){this.pageSize=event.detail.pageSize}if(this.page!==event.detail.currentPage){this.page=event.detail.currentPage}}},{key:"_onPageSizeChange",value:function _onPageSizeChange(pageSize){this._ensureValidPageSize();this._ensureValidPageNumber();this._updateGridData()}},{key:"_onPageChange",value:function _onPageChange(page){this._ensureValidPageNumber();this._updateGridData()}},{key:"_updateGridData",value:function _updateGridData(){if(this._pxDataGrid){this._pxDataGrid._vaadinGrid.clearCache()}}},{key:"_ensureValidPageNumber",value:function _ensureValidPageNumber(){var numPages=this._calcNumPages(this.size,this.pageSize);this.page=0<this.page?this.page:1;this.page=numPages<this.page?1:this.page}},{key:"_ensureValidPageSize",value:function _ensureValidPageSize(){this.pageSize=0<this.pageSize?this.pageSize:10}},{key:"_calcNumPages",value:function _calcNumPages(numItems,pageSize){var numPages=1;if(pageSize){numPages=Math.ceil(numItems/pageSize)}return numPages}},{key:"_hidePageList",value:function _hidePageList(autoHidePageList,size,pageSize){return autoHidePageList&&1===this._calcNumPages(size,pageSize)}},{key:"getData",value:function getData(visibleOnly){return this._pxDataGrid.getData(visibleOnly)}},{key:"getVisibleColumns",value:function getVisibleColumns(){return this._pxDataGrid.getVisibleColumns()}},{key:"resolveColumnHeader",value:function resolveColumnHeader(column){return this._pxDataGrid.resolveColumnHeader(column)}}],[{key:"is",get:function get(){return"px-data-grid-paginated"}},{key:"properties",get:function get(){return{selectablePageSizes:{type:Array,value:[10,20,30]},page:{type:Number,value:1,observer:"_onPageChange"},autoHidePageList:{type:Boolean,value:!1},tableData:{type:Array,notify:!0},hideSelectionColumn:{type:Boolean,value:!1},selectedItems:{type:Array,value:function value(){return[]},notify:!0},size:{type:Number,value:void 0,observer:"_ensureValidPageNumber"},pageSize:{type:Number,value:10,observer:"_onPageSizeChange"},multiSort:{type:Boolean,value:!1},selectionMode:{type:String,value:"none"},activeItem:{type:Object,notify:!0,value:null},resizable:{type:Boolean,value:!1},editable:{type:Boolean,value:!1},columnReorderingAllowed:{type:Boolean,value:!1},expandedItems:{type:Array,value:[]},hideActionMenu:{type:Boolean,value:!1},columns:{type:Array},language:{type:String,value:"en"},useKeyIfMissing:{type:Boolean,value:!0},resources:{type:Object,value:function value(){return{en:{"Rows per page":"Rows per page","of {total}":"of {total}"},fr:{"Rows per page":"Lignes par page","of {total}":"sur {total}"},fi:{"Rows per page":"Rivi\xE4 / sivu","of {total}":"/ {total}"}}}},tableActions:{type:Array},itemActions:{type:Array},remoteDataProvider:{type:Function,observer:"_remoteDataProviderChanged"},_currentDataProvider:{type:Function},striped:{type:Boolean,value:!1},ellipsis:{type:Boolean,value:!1},loadingSpinnerDebounce:{type:Number,value:500},autoFilter:{type:Boolean,value:!1},highlight:{type:Array},_hasLocalDataProvider:{type:Boolean},defaultColumnWidth:{type:String},defaultColumnFlexGrow:{type:Number},gridHeight:{type:String,value:"auto"},itemIdPath:{type:String},offerFilterSaving:{type:Boolean},filterable:{type:Boolean,value:!1},stringComparators:{type:Array},numberComparators:{type:Array}}}},{key:"observers",get:function get(){return["_tableDataChanged(tableData, tableData.*, isAttached)"]}}]);return DataGridPaginatedElement}(Polymer.mixinBehaviors([Polymer.AppLocalizeBehavior],Polymer.Element));customElements.define(DataGridPaginatedElement.is,DataGridPaginatedElement);window.Predix=window.Predix||{};Predix.DataGridPaginatedElement=DataGridPaginatedElement}</script>
</dom-module>
</body></html>