<!--
Copyright (c) 2018, General Electric

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
--><html><head><script>window.Predix=window.Predix||{};Predix.DataGridFilterableMixin=function(superClass){return function(_superClass){babelHelpers.inherits(DataGridFilterableMixin,_superClass);function DataGridFilterableMixin(){babelHelpers.classCallCheck(this,DataGridFilterableMixin);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(DataGridFilterableMixin).apply(this,arguments))}babelHelpers.createClass(DataGridFilterableMixin,[{key:"ready",value:function ready(){var _this=this;babelHelpers.get(babelHelpers.getPrototypeOf(DataGridFilterableMixin.prototype),"ready",this).call(this);this.set("_filters",this._initialFilterState);this.addEventListener("remove-filter",function(event){var entity=event.detail.entity,section=event.detail.section,sectionIndex=_this._filters.indexOf(section);_this.splice("_filters.".concat(sectionIndex,".entities"),section.entities.indexOf(entity),1)});this.addEventListener("clear-filters",function(event){_this.set("_filters",[{action:"show",operationType:"all",entities:[]}])})}},{key:"_escapeRegExp",value:function _escapeRegExp(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}},{key:"_isStringMatches",value:function _isStringMatches(filter,value){var regex;switch(filter.pattern){case"equals":regex=new RegExp("^".concat(this._escapeRegExp(filter.query),"$"),"i");break;case"contains":regex=new RegExp("".concat(this._escapeRegExp(filter.query)),"i");break;case"starts_with":regex=new RegExp("^".concat(this._escapeRegExp(filter.query)),"i");break;case"ends_with":regex=new RegExp("".concat(this._escapeRegExp(filter.query),"$"),"i");break;case"wildcard":if(!filter.query||"*"===filter.query){regex=/.*/i}else{regex=new RegExp("^".concat(filter.query.split("*").map(this._escapeRegExp).join(".*"),"$"),"i")}break;}return regex.test(value)}},{key:"_isDateMatches",value:function _isDateMatches(filter,value){var result=!0,comparingDate=window.Px.moment.utc(value);if(!comparingDate){result=!1}if(filter.dateFrom){var dateFrom=window.Px.moment.utc(filter.dateFrom);result=result&&dateFrom<comparingDate}if(filter.dateTo){var dateTo=window.Px.moment.utc(filter.dateTo);result=result&&dateTo>comparingDate}return result}},{key:"_isNumberMatches",value:function _isNumberMatches(filter,value){var result=!1,comparingNumber=+value;if(filter.leftBound!==void 0&&filter.rightBound!==void 0){var leftBound=+filter.leftBound,rightBound=+filter.rightBound;result=leftBound<comparingNumber&&comparingNumber<rightBound}else{var filterValue=+filter.value;switch(filter.condition){case"equals":result=comparingNumber===filterValue;break;case"not_equal":result=comparingNumber!==filterValue;break;case"equal_or_greater_than":result=comparingNumber>=filterValue;break;case"equal_or_less_than":result=comparingNumber<=filterValue;break;case"greater_than":result=comparingNumber>filterValue;break;case"less_than":result=comparingNumber<filterValue;break;}}return result}},{key:"_matchesFilter",value:function _matchesFilter(item,column,entity){var filteringValue=Polymer.Path.get(item,column.path);if("date"===column.type){return this._isDateMatches(entity,filteringValue)}else if("number"===column.type){return this._isNumberMatches(entity,filteringValue)}else{return this._isStringMatches(entity,filteringValue)}}},{key:"_applyCustomFilter",value:function _applyCustomFilter(items,columns,filters){var _this2=this,appliableFilters=filters.filter(function(section){return-1!==["show","hide"].indexOf(section.action)}).filter(function(section){return 0<section.entities.filter(function(entity){return entity.active}).length}),filteredItems=items.filter(function(item){if(0===appliableFilters.length){return!0}var isAnySectionApplied=appliableFilters.some(function(section){var activeEntities=section.entities.filter(function(entity){return entity.active}),operation;if("any"===section.operationType&&"show"===section.action||"all"===section.operationType&&"hide"===section.action){operation="some"}else{operation="every"}return activeEntities[operation](function(entity){var result;if("-any-"===entity.columnId){result=columns.some(function(column){var matches=_this2._matchesFilter(item,{type:"string",path:column.path},entity);return matches})}else{var column=_this2._getColumnById(entity.columnId);result=_this2._matchesFilter(item,column,entity)}return"show"===section.action&&result||"hide"===section.action&&!result})});return isAnySectionApplied});return filteredItems}},{key:"_constructHighilightCondition",value:function _constructHighilightCondition(appliableFilters,columns){var _this3=this;return function(cellContent,item){return appliableFilters.some(function(section){var activeEntities=section.entities.filter(function(entity){return entity.active});return activeEntities["any"===section.operationType?"some":"every"](function(entity){if("-any-"===entity.columnId){return columns.some(function(column){var matches=_this3._matchesFilter(item,{type:"string",path:column.path},entity);return matches})}else{var column=_this3._getColumnById(entity.columnId);return _this3._matchesFilter(item,column,entity)}})})}}},{key:"_filtersObserver",value:function _filtersObserver(filters){if(!this._vaadinGrid){return}var appliableFilterHighlights=filters.filter(function(section){return"highlight"===section.action&&0<section.entities.filter(function(entity){return entity.active}).length}),appliableFilters=filters.filter(function(section){return"highlight"!==section.action&&0<section.entities.filter(function(entity){return entity.active}).length});if(0<appliableFilterHighlights.length){this.set("_filterHighlights",[{type:"row",condition:this._constructHighilightCondition(appliableFilterHighlights,this.columns)}])}else{this.set("_filterHighlights",[])}var gridFilters=this._vaadinGrid._filters.filter(function(filter){return!filter.value.isAdvancedFilter});appliableFilters.map(function(filter){return{value:{isAdvancedFilter:!0,filter:filter}}}).forEach(function(filter){gridFilters.push(filter)});this._vaadinGrid._filters=gridFilters;this._vaadinGrid.clearCache()}},{key:"applyFilters",value:function applyFilters(filters){this.set("_initialFilterState",filters);this.set("_filters",filters)}}],[{key:"properties",get:function get(){return{filterable:{type:Boolean,value:!1},_filters:{type:Array},_initialFilterState:{type:Array,value:function value(){return[{entities:[],action:"show",operationType:"all"}]}},_filterHighlights:{type:Array,value:function value(){return[]}}}}},{key:"observers",get:function get(){return["_filtersObserver(_filters, _filters.*)"]}}]);return DataGridFilterableMixin}(superClass)};</script>
</head><body></body></html>