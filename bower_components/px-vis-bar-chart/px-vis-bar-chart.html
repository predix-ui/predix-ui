<!--
Copyright (c) 2018, General Electric

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
--><html><head><link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../polymer/lib/elements/dom-if.html">
<link rel="import" href="../polymer/lib/utils/async.html">

<link rel="import" href="../px-vis/px-vis-behavior-common.html">
<link rel="import" href="../px-vis/px-vis-behavior-d3.html">
<link rel="import" href="../px-vis/px-vis-behavior-chart.html">
<link rel="import" href="../px-vis/px-vis-behavior-scale.html">
<link rel="import" href="../px-vis/px-vis-svg.html">
<link rel="import" href="../px-vis/px-vis-axis.html">
<link rel="import" href="../px-vis/px-vis-gridlines.html">
<link rel="import" href="../px-vis/px-vis-interaction-space.html">
<link rel="import" href="../px-vis/px-vis-cursor.html">
<link rel="import" href="../px-vis/px-vis-tooltip.html">
<link rel="import" href="../px-vis/px-vis-register.html">
<link rel="import" href="../px-vis/px-vis-threshold.html">
<link rel="import" href="../px-vis/px-vis-clip-path.html">
<link rel="import" href="../px-vis/px-vis-toolbar.html">
<link rel="import" href="../px-vis/px-vis-annotations.html">
<link rel="import" href="../px-vis/px-vis-bar-svg.html">
<link rel="import" href="../px-vis/px-vis-bar-grouped-svg.html">
<link rel="import" href="../px-vis/px-vis-reference-curve.html">
<link rel="import" href="../px-vis/px-vis-line-svg.html">
<link rel="import" href="../px-vis/px-vis-central-tooltip-content.html">
<link rel="import" href="../px-tooltip/px-tooltip.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">

<link rel="import" href="css/px-vis-bar-chart-styles.html">

<!--
Creates an interactive bar chart, column chart, stacked bar, stacked column, grouped bar, grouped column, deviation bar, and deviation column

### Usage

    <px-vis-bar-chart
      width="1200"
      height="500"
      scale-padding="0.1"
      margin='{
        "left": 130,
        "right": 130,
        "top": 10,
        "bottom": 50
      }'
      chart-data="[[chartData]]"
      series-config="[[seriesConfig]]">
    </px-vis-bar-chart>

### Styling
The following custom properties are available for styling:

Custom property | Description
----------------|-------------
  `--px-vis-axis-color` | The color for the axis lines, axis ticks, and axis tick labels
  `--px-vis-axis-title-color` | The color for the axis title
  |
  |
  |
  `--px-vis-gridlines-color` | The color for the gridlines
  |
  |
  |
  `--px-vis-threshold-color` | The default color for a threshold
  |
  |
  |
  `--px-vis-reference-curve-default-color` | default color for the reference curve
  |
  |
  |
  `--px-vis-register-series-name` | The color of the data series name
  `--px-vis-register-data-value` | The color of the data series value
  `--px-vis-register-box` | The color of the box around the register when a scrollbar is present
  |
  |
  |
  `--px-vis-series-color-0` | These are the colors used to represent the data series on the charts. Used in numerical order by default. Colors MUST start at 0 and cannot contain gaps between numbers.
  `--px-vis-series-color-1` |
  `--px-vis-series-color-2` |
  `--px-vis-series-color-n` |
  |
  |
  |
  `--px-tooltip-background-color` | The color of the tooltip
  `--px-tooltip-text-color` | The color of the tooltip text
  `--px-tooltip-light-background-color` | The color of the light version tooltip
  `--px-tooltip-light-text-color` | The color of the light version tooltip text
  `--px-tooltip-light-border-color`| The color of the light version tooltip border
  |
  |
  |
  `--px-vis-font-family` | The font family for all labels and text

@element px-vis-bar-chart
@blurb Creates an interactive bar chart
@homepage index.html
@demo index.html
-->

</head><body><dom-module id="px-vis-bar-chart">
  <script>function _templateObject7_f7321ce0fc0611e8a9421f0e98e87389(){var data=babelHelpers.taggedTemplateLiteral(["\n          <template is=\"dom-if\" if=\"[[showTooltip]]\" restamp>\n            <px-vis-tooltip\n              id=\"tooltip\"\n              orientation=\"[[_getTooltipOrientation(xAxisType)]]\"\n              hover-target=[[mouseRect]]\n              mouse-position=\"[[mousePosition]]\"\n              width=\"250\"\n              margin=\"[[margin]]\"\n              chart-data=\"[[chartData]]\"\n              tooltip-data=\"[[tooltipData]]\"\n              complete-series-config=\"[[completeSeriesConfig]]\"\n              x-axis-type=\"[[xAxisType]]\"\n              y-axis-type=\"[[yAxisType]]\"\n              tooltip-style=\"light\"\n              muted-series=\"[[mutedSeries]]\"\n              hide=\"[[!_computedShowTooltip]]\"\n              series-keys=\"[[_seriesKeys]]\"\n              display-x-values-only=\"[[_getRegisterDisplay(yAxisType)]]\"\n              display-y-values-only=\"[[_getRegisterDisplay(xAxisType)]]\"\n              display-ordinal-value\n              icon-color=\"[[_registerIconColor]]\">\n            </px-vis-tooltip>\n          </template>\n        "]);_templateObject7_f7321ce0fc0611e8a9421f0e98e87389=function _templateObject7_f7321ce0fc0611e8a9421f0e98e87389(){return data};return data}function _templateObject6_f7321ce0fc0611e8a9421f0e98e87389(){var data=babelHelpers.taggedTemplateLiteral(["\n          <template is=\"dom-if\" if=\"[[_showRef(referenceData.*)]]\" restamp>\n            <px-vis-reference-curve\n              id=\"referenceCurve\"\n              chart-id=\"[[chartId]]\"\n              svg=\"[[_lineG]]\"\n              x=\"[[x]]\"\n              y=\"[[y]]\"\n              reverse-data=\"[[_isOrdinalType(yAxisType)]]\"\n              domain-changed=\"[[domainChanged]]\"\n              reference-config=\"[[referenceConfig]]\"\n              reference-data=\"[[referenceData]]\"\n              clip-path=\"[[seriesClipPath]]\"\n              on-_reference-config-changed=\"_checkReference\">\n            </px-vis-reference-curve>\n          </template>\n        "]);_templateObject6_f7321ce0fc0611e8a9421f0e98e87389=function _templateObject6_f7321ce0fc0611e8a9421f0e98e87389(){return data};return data}function _templateObject5_f7321ce0fc0611e8a9421f0e98e87389(){var data=babelHelpers.taggedTemplateLiteral(["\n          <template is=\"dom-if\" if=\"[[_showThresholds(thresholdData.*)]]\" restamp>\n            <px-vis-threshold\n              svg=\"[[layer.3]]\"\n              complete-series-config=\"[[completeSeriesConfig]]\"\n              threshold-data=\"[[thresholdData]]\"\n              threshold-config=\"[[thresholdConfig]]\"\n              width=\"[[width]]\"\n              height=\"[[height]]\"\n              margin=\"[[margin]]\"\n              x=\"[[x]]\"\n              y=\"[[y]]\"\n              domain-changed=\"[[domainChanged]]\"\n              clip-path=\"[[seriesClipPath]]\"\n              show-threshold-box=\"[[showThresholdBox]]\"\n              language=\"[[language]]\">\n            </px-vis-threshold>\n          </template>\n        "]);_templateObject5_f7321ce0fc0611e8a9421f0e98e87389=function _templateObject5_f7321ce0fc0611e8a9421f0e98e87389(){return data};return data}function _templateObject4_f7321ce0fc0611e8a9421f0e98e87389(){var data=babelHelpers.taggedTemplateLiteral(["\n          <template is=\"dom-if\" if=\"[[_hasLines]]\" restamp>\n            <!--\n            When the time comes to make this multi-y which will happen, we shouldnt make it multi-y using the methods for timeseries / xy. Instead, we should just create a second y axis, cloned from the first and then modified. This can then be applied to the line and only the line. We should never allow bars to be multi-axis.\n              -->\n            <template id=\"lineTemplate\" is=\"dom-repeat\" items=\"[[_returnLineSeriesKeys(_lineSeriesConfig.*)]]\">\n              <px-vis-line-svg\n                id=\"lineSVG\"\n                svg=\"[[_lineG]]\"\n                series-id=\"[[item]]\"\n                chart-data=\"[[chartData]]\"\n                complete-series-config=\"[[completeSeriesConfig]]\"\n                domain-changed=\"[[domainChanged]]\"\n                x=\"[[x]]\"\n                y=\"[[y]]\"\n                clip-path=\"[[seriesClipPath]]\"\n                stroke-width=\"[[_returnStrokeWidth(item, completeSeriesConfig)]]\"\n                interpolation-function=\"[[interpolationFunction]]\"\n                serie-to-redraw-on-top=\"[[serieToRedrawOnTop]]\">\n              </px-vis-line-svg>\n            </template>\n\n            <px-vis-cursor\n              id=\"cursor\"\n              svg=\"[[_lineG]]\"\n              width=\"[[width]]\"\n              height=\"[[height]]\"\n              margin=\"[[margin]]\"\n              complete-series-config=\"[[_lineSeriesConfig]]\"\n              chart-data=\"[[chartData]]\"\n              tooltip-data=\"[[tooltipData]]\"\n              clip-path=\"[[seriesClipPath]]\"\n              series-keys=\"[[_seriesKeys]]\"\n              horizontal-line=\"none\"\n              vertical-line=\"none\">\n            </px-vis-cursor>\n          </template>\n        "]);_templateObject4_f7321ce0fc0611e8a9421f0e98e87389=function _templateObject4_f7321ce0fc0611e8a9421f0e98e87389(){return data};return data}function _templateObject3_f7321ce0fc0611e8a9421f0e98e87389(){var data=babelHelpers.taggedTemplateLiteral(["\n          <template is=\"dom-if\" if=\"[[grouped]]\" restamp>\n            <px-vis-bar-grouped-svg\n              class=\"bars\"\n              svg=\"[[layer.2]]\"\n              height=\"[[height]]\"\n              margin=\"[[margin]]\"\n              complete-series-config=\"[[completeSeriesConfig]]\"\n              chart-data=\"[[chartData]]\"\n              x=\"[[x]]\"\n              y=\"[[y]]\"\n              ordinal-key=\"[[_ordinalKey]]\"\n              group-scale=\"[[_groupScale]]\"\n              series-keys=\"[[_groupKeys]]\"\n              type=\"[[chartType]]\"\n              domain-changed=\"[[domainChanged]]\"\n              clip-path=\"[[seriesClipPath]]\"\n              highlight-bar=\"[[_getOrdSet(tooltipData.*)]]\"\n              color-by-group=\"[[colorByGroup]]\"\n              group-colors=\"[[_groupColors]]\">\n            </px-vis-bar-grouped-svg>\n          </template>\n        "]);_templateObject3_f7321ce0fc0611e8a9421f0e98e87389=function _templateObject3_f7321ce0fc0611e8a9421f0e98e87389(){return data};return data}function _templateObject2_f7321ce0fc0611e8a9421f0e98e87389(){var data=babelHelpers.taggedTemplateLiteral(["\n          <template is=\"dom-if\" if=\"[[!grouped]]\" restamp>\n            <template is=\"dom-repeat\" items=\"[[_stackedChartData]]\">\n              <px-vis-bar-svg\n                class=\"bars\"\n                svg=\"[[layer.2]]\"\n                complete-series-config=\"[[completeSeriesConfig]]\"\n                chart-data=\"[[item]]\"\n                series-key=\"[[item.key]]\"\n                x=\"[[x]]\"\n                y=\"[[y]]\"\n                type=\"[[chartType]]\"\n                domain-changed=\"[[domainChanged]]\"\n                clip-path=\"[[seriesClipPath]]\"\n                highlight-bar=\"[[_getOrdSet(tooltipData.*)]]\">\n              </px-vis-bar-svg>\n            </template>\n          </template>\n        "]);_templateObject2_f7321ce0fc0611e8a9421f0e98e87389=function _templateObject2_f7321ce0fc0611e8a9421f0e98e87389(){return data};return data}function _templateObject_f7321ce0fc0611e8a9421f0e98e87389(){var data=babelHelpers.taggedTemplateLiteral(["\n          <style include=\"px-vis-bar-chart-styles\"></style>\n\n          <div id=\"wrapper\" class$=\"{{_chartWrapperClass}}\" >\n            <!--chart + register-->\n            <div class$=\"{{_registerWrapperClass}} safari-flex-fix\">\n              <template is=\"dom-if\" if=\"[[!hideRegister]]\">\n                <px-vis-register\n                  id=\"register\"\n                  dynamic-menu-config=\"[[dynamicMenuConfig]]\"\n                  chart-width=\"[[width]]\"\n                  height=\"[[_registerHeight]]\"\n                  margin=\"[[margin]]\"\n                  class$=\"{{_getHideClass(hideRegister)}}\"\n                  units=\"[[units]]\"\n                  tooltip-data=\"[[tooltipData]]\"\n                  chart-data=\"[[chartData]]\"\n                  complete-series-config=\"[[completeSeriesConfig]]\"\n                  type=\"{{_registerType}}\"\n                  x-axis-type=\"[[xAxisType]]\"\n                  y-axis-type=\"[[yAxisType]]\"\n                  inert-register=\"[[hideRegister]]\"\n                  current-page=\"[[_registerCurrentPage]]\"\n                  total-pages=\"[[_registerTotalPages]]\"\n                  display-page-arrows=\"[[_registerDisplayPageArrows]]\"\n                  display-x-values-only=\"[[_getRegisterDisplay(yAxisType)]]\"\n                  display-y-values-only=\"[[_getRegisterDisplay(xAxisType)]]\"\n                  display-ordinal-value\n                  disable-click\n                  icon-color=\"[[_registerIconColor]]\">\n                </px-vis-register>\n              </template>\n\n              <!-- chart -->\n              <div id=\"drawingWrapper\" class=\"flex--col flex__item--no-grow inline--flex\">\n                <px-vis-toolbar\n                  id=\"toolbar\"\n                  current-sub-config='[[toolbarSubConfig]]'\n                  action-config='{{actionConfig}}'\n                  within-chart\n                  chart-margin=\"[[margin]]\"\n                  config='{\"tooltip\": true}'>\n                </px-vis-toolbar>\n                <px-vis-svg\n                  id=\"svg\"\n                  class=\"flex__item--no-grow\"\n                  width=\"[[width]]\"\n                  height=\"[[height]]\"\n                  margin=\"[[margin]]\"\n                  svg=\"{{svg}}\"\n                  px-svg-elem=\"{{pxSvgElem}}\">\n                    <px-vis-annotations\n                      slot=\"4\"\n                      svg=\"[[svg]]\"\n                      x=\"[[x]]\"\n                      y=\"[[y]]\"\n                      margin=\"[[margin]]\"\n                      domain-changed=\"[[domainChanged]]\"\n                      complete-series-config=\"[[completeSeriesConfig]]\"\n                      annotation-data=\"[[annotationData]]\"\n                      show-strong-icon=\"[[showStrongIcon]]\">\n                    </px-vis-annotations>\n                </px-vis-svg>\n              </div>\n            </div>\n          </div>\n\n          <px-vis-clip-path\n            svg=\"[[layer.2]]\"\n            width=\"[[width]]\"\n            height=\"[[height]]\"\n            margin=\"[[margin]]\"\n            clip-path=\"{{clipPath}}\"\n            series-clip-path=\"{{seriesClipPath}}\">\n          </px-vis-clip-path>\n\n          <px-vis-axis\n            id=\"xAxis\"\n            svg=\"[[layer.1]]\"\n            rebuild-on-draw\n            domain-changed=\"[[domainChanged]]\"\n            axis=\"[[x]]\"\n            axis-type=\"[[xAxisType]]\"\n            margin=\"[[margin]]\"\n            width=\"[[width]]\"\n            height=\"[[height]]\"\n            orientation=\"[[xAxisLocation]]\"\n            label-position=\"after\"\n            complete-series-config=\"[[completeSeriesConfig]]\"\n            prevent-series-bar>\n          </px-vis-axis>\n          <px-vis-axis\n            id=\"yAxis\"\n            svg=\"[[layer.1]]\"\n            rebuild-on-draw\n            domain-changed=\"[[domainChanged]]\"\n            axis=\"[[y]]\"\n            axis-type=\"[[yAxisType]]\"\n            margin=\"[[margin]]\"\n            width=\"[[width]]\"\n            height=\"[[height]]\"\n            orientation=\"[[yAxisLocation]]\"\n            complete-series-config=\"[[completeSeriesConfig]]\"\n            prevent-series-bar>\n          </px-vis-axis>\n\n          <template is=\"dom-if\" if=\"[[_showGridlines(hideGridlines, chartType, 'bar')]]\" restamp>\n            <px-vis-gridlines\n              svg=\"[[layer.0]]\"\n              axis=\"[[x]]\"\n              margin=\"[[margin]]\"\n              length=\"[[height]]\"\n              orientation=\"bottom\"\n              domain-changed=\"[[domainChanged]]\">\n            </px-vis-gridlines>\n          </template>\n          <template is=\"dom-if\" if=\"[[_showGridlines(hideGridlines, chartType, 'column')]]\" restamp>\n            <px-vis-gridlines\n              svg=\"[[layer.0]]\"\n              axis=\"[[y]]\"\n              margin=\"[[margin]]\"\n              length=\"[[width]]\"\n              orientation=\"left\"\n              domain-changed=\"[[domainChanged]]\">\n            </px-vis-gridlines>\n          </template>\n\n          <px-vis-interaction-space\n            id=\"interactionSpace\"\n            svg=\"[[layer.4]]\"\n            width=\"[[width]]\"\n            height=\"[[height]]\"\n            margin=\"[[margin]]\"\n            x-axis-type=\"[[xAxisType]]\"\n            y-axis-type=\"[[yAxisType]]\"\n            series-keys=\"[[_seriesKeys]]\"\n            complete-series-config=\"[[completeSeriesConfig]]\"\n            chart-data=\"[[chartData]]\"\n            chart-id=\"[[chartId]]\"\n            x=\"[[x]]\"\n            y=\"[[y]]\"\n            domain-changed=\"[[domainChanged]]\"\n            mouse-rect=\"{{mouseRect}}\"\n            tooltip-data=\"{{tooltipData}}\"\n            crosshair-data=\"{{crosshairData}}\"\n            default-empty-data=\"[[defaultEmptyData]]\"\n            generating-crosshair-data=\"{{generatingCrosshairData}}\"\n            interaction-svg=\"{{interactionSvg}}\"\n            extents-data=\"{{extentsData}}\"\n            action-config=\"[[actionConfig]]\"\n            selection-type=\"[[selectionType]]\"\n            extents-action=\"{{extentsAction}}\"\n            muted-series=\"[[mutedSeries]]\"\n            hard-mute=\"[[hardMute]]\"\n            is-bar\n            prevent-web-worker-synchronization=\"[[preventWebWorkerSynchronization]]\"\n            ww-data-sync-counter=\"[[wwDataSyncCounter]]\">\n          </px-vis-interaction-space>\n\n          <px-tooltip\n            id=\"centralTooltip\"\n            smart-orientation\n            ignore-target-events\n            orientation=\"[[tooltipOrientation]]\">\n            <px-vis-central-tooltip-content\n              resources=\"[[resources]]\"\n              use-key-if-missing=\"[[useKeyIfMissing]]\"\n              language=\"[[language]]\"\n              first-date-time-format=\"[[firstDateTimeFormat]]\"\n              second-date-time-format=\"[[secondDateTimeFormat]]\"\n              separator=\"[[separator]]\"\n              timezone=\"[[timezone]]\">\n            </px-vis-central-tooltip-content>\n          </px-tooltip>\n\n          ","\n\n          ","\n\n          ","\n\n          ","\n\n          ","\n\n          ","\n        "]);_templateObject_f7321ce0fc0611e8a9421f0e98e87389=function _templateObject_f7321ce0fc0611e8a9421f0e98e87389(){return data};return data}(function(){var behaviours=[PxVisBehavior.observerCheck,PxVisBehavior.baseSize,PxVisBehavior.margins,PxVisBehavior.dataset,PxVisBehavior.completeSeriesConfig,PxVisBehavior.muteUnmuteSeries,PxVisBehavior.tooltipData,PxVisBehavior.extentsData,PxVisBehavior.commonMethods,PxVisBehavior.zoomSelection,PxVisBehavior.chartExtents,PxVisBehavior.dataExtents,PxVisBehaviorD3.svg,PxVisBehaviorD3.axes,PxVisBehaviorD3.clipPath,PxVisBehaviorChart.chartCommon,PxVisBehaviorChart.saveImage,PxVisBehaviorD3.domainUpdate,PxVisBehaviorChart.subConfiguration,PxVisBehaviorChart.registerConfigs,PxVisBehaviorChart.axisConfigs,PxVisBehaviorChart.registerPositioning,PxVisBehaviorChart.chartAutoResize,PxVisBehavior.thresholds,PxVisBehaviorChart.layers,PxVisBehavior.dynamicMenuConfig,PxColorsBehavior.dataVisColorTheming,PxVisBehavior.axisTypes,PxVisBehaviorScale.scale,PxVisBehavior.actionConfig,PxVisBehaviorChart.zooming,PxVisBehaviorChart.actionRequest,PxVisBehaviorChart.toolbarSubConfig,PxVisBehaviorChart.noDebounceOnPanning,PxVisBehaviorChart.chartToolbarConfig,PxVisBehaviorChart.showTooltip,PxVisBehaviorChart.sizeVerticalRegister,PxVisBehaviorChart.thresholdConfig,PxVisBehavior.selectionType,PxVisBehaviorChart.webWorkerSynchronization,Polymer.AppLocalizeBehavior,PxVisBehavior.updateStylesOverride,PxVisBehavior.annotationData,PxVisBehaviorChart.tooltipSizing,PxVisBehavior.referenceCurveProps,PxVisBehaviorChart.centralTooltip],PxVisBarChart=function(_Polymer$mixinBehavio){var _Mathmax=Math.max;babelHelpers.inherits(PxVisBarChart,_Polymer$mixinBehavio);babelHelpers.createClass(PxVisBarChart,null,[{key:"is",get:function get(){return"px-vis-bar-chart"}},{key:"template",get:function get(){return Polymer.html(_templateObject_f7321ce0fc0611e8a9421f0e98e87389(),this.stackedBarTemplate,this.groupedBarTemplate,this.lineTemplate,this.thresholdsTemplate,this.referenceCurveTemplate,this.tooltipTemplate)}},{key:"stackedBarTemplate",get:function get(){return Polymer.html(_templateObject2_f7321ce0fc0611e8a9421f0e98e87389())}},{key:"groupedBarTemplate",get:function get(){return Polymer.html(_templateObject3_f7321ce0fc0611e8a9421f0e98e87389())}},{key:"lineTemplate",get:function get(){return Polymer.html(_templateObject4_f7321ce0fc0611e8a9421f0e98e87389())}},{key:"thresholdsTemplate",get:function get(){return Polymer.html(_templateObject5_f7321ce0fc0611e8a9421f0e98e87389())}},{key:"referenceCurveTemplate",get:function get(){return Polymer.html(_templateObject6_f7321ce0fc0611e8a9421f0e98e87389())}},{key:"tooltipTemplate",get:function get(){return Polymer.html(_templateObject7_f7321ce0fc0611e8a9421f0e98e87389())}},{key:"properties",get:function get(){return{preventWebWorkerSynchronization:{type:Boolean,value:!0,readOnly:!0},_defaultSeriesConfig:{type:Object,value:function value(){return{x:"x",y:"y",type:"bar"}}},chartType:{type:String,value:"column"},_stackedChartData:{type:Array},xAxisLocation:{type:String,value:"bottom"},yAxisLocation:{type:String,value:"left"},startFromZero:{type:Boolean,value:!0},_ordinalKey:{type:String,computed:"_getOrdKey(completeSeriesConfig.*)"},_stackedDataExtentsTrigger:{type:Number,value:0},grouped:{type:Boolean,value:!1},colorByGroup:{type:Boolean,value:!1},groupColors:Object,_groupColors:Object,_registerIconColor:String,_lineG:Object,_baseline:Object,_groupKeys:Object,_lineSeriesConfig:Object,_hasLines:{type:Boolean,value:!1},_hasThresholds:{type:Boolean,value:!1},_hasReferenceCurve:{type:Boolean,value:!1},_supressStacked:{type:Boolean,value:!1}}}},{key:"observers",get:function get(){return["_returnStack(chartData.*, completeSeriesConfig.*)","_setAxisTypes(chartType)","_groupChanged(grouped)","_setGroupColors(grouped,colorByGroup,domainChanged)","_setXScale(width, margin, xAxisType)","_setYScale(height, margin, yAxisType)","_setDomain(_chartDataHasChanged, x, y, completeSeriesConfig, _stackedDataExtentsTrigger)","_setDomain(chartExtents, _stackedDataExtentsTrigger)","_updatePadding(scalePadding)","_chartDataChanged(chartData.*)","_calcTooltipPos(tooltipData.*)","_getRegisterIconColor(tooltipData.*)","_calcStackedDataExt(_stackedChartData, completeSeriesConfig, grouped)","_createGroupScale(x,y, domainChanged, completeSeriesConfig, _seriesKeys, grouped)","_createLineGroup(layers, domainChanged)","_drawBaseline(domainChanged)","_xAxisConfigChanged(xAxisConfig.*)","_yAxisConfigChanged(yAxisConfig.*)","_registerConfigChanged(registerConfig.*)","_tooltipConfigChanged(tooltipConfig.*)"]}}]);function PxVisBarChart(){var _this;babelHelpers.classCallCheck(this,PxVisBarChart);_this=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(PxVisBarChart).call(this));_this.__debouncers={};return _this}babelHelpers.createClass(PxVisBarChart,[{key:"connectedCallback",value:function connectedCallback(){babelHelpers.get(babelHelpers.getPrototypeOf(PxVisBarChart.prototype),"connectedCallback",this).call(this);this.set("numberOfLayers",5);this.set("_verticalRegisterDrawingCanvasId","svg");this.set("_verticalRegisterHeightDeductions",["toolbar"])}},{key:"ready",value:function ready(){babelHelpers.get(babelHelpers.getPrototypeOf(PxVisBarChart.prototype),"ready",this).call(this)}},{key:"_debounce",value:function _debounce(name,cb,time){this.__debouncers[name]=Polymer.Debouncer.debounce(this.__debouncers[name],Polymer.Async.timeOut.after(time),cb.bind(this))}},{key:"_resizeCalculations",value:function _resizeCalculations(){var wrapperRect=this.$.wrapper.getBoundingClientRect(),register=this.shadowRoot.querySelector("#register"),registerRect=register.getBoundingClientRect(),toolbarRect=this.$.toolbar.getBoundingClientRect(),heightDeduct=0,widthDeduct=0;if("horizontal"===register.type){heightDeduct+=registerRect.height}else{widthDeduct+=registerRect.width}heightDeduct+=toolbarRect.height;this.set("width",_Mathmax(wrapperRect.width-widthDeduct,0));this.set("height",_Mathmax(wrapperRect.height-heightDeduct,0));this._computeVerticalRegisterHeight([toolbarRect.height])}},{key:"_returnStack",value:function _returnStack(){if(this.grouped||this._supressStacked){this.set("_stackedChartData",[]);return}if(!this.chartData||!this.completeSeriesConfig){return}var axis="scaleBand"===this.xAxisType?"y":"x",stack=Px.d3.stack(),barKeys=[],hasLines=!1,lineSeries={};Object.entries(this.completeSeriesConfig).forEach(function(_ref){var _ref2=babelHelpers.slicedToArray(_ref,2),k=_ref2[0],val=_ref2[1];if("bar"===val.type){barKeys.push(val[axis])}else if("line"===val.type){hasLines=!0;lineSeries[k]=val}});stack.offset(Px.d3.stackOffsetDiverging);stack.keys(barKeys);this.set("_stackedChartData",stack(this.chartData));this.set("_hasLines",hasLines);this.set("_lineSeriesConfig",lineSeries)}},{key:"_setAxisTypes",value:function _setAxisTypes(chartType){if(this.domainChanged){this.setProperties({domainChanged:0,x:null,y:null,dataExtents:null})}if("bar"===chartType){this.setProperties({xAxisType:"linear",yAxisType:"scaleBand"})}else{this.setProperties({xAxisType:"scaleBand",yAxisType:"linear"})}this._setCompleteSeriesConfig()}},{key:"_groupChanged",value:function _groupChanged(){this._setCompleteSeriesConfig()}},{key:"_setGroupColors",value:function _setGroupColors(){var _this2=this;if(this.grouped&&this.colorByGroup){this._dontCalcColors=!0;if(this.groupColors){this.set("_groupColors",this.groupColors);return}if(this.domainChanged){var groups=this.x.domain(),colors={};groups.forEach(function(group,i){colors[group]=_this2.seriesColorList[i]});this.set("_groupColors",colors)}}else{this._dontCalcColors=!1}}},{key:"_getOrdKey",value:function _getOrdKey(){if(this.hasUndefinedArguments(arguments)){return}if(this._seriesKeys&&this._seriesKeys.length){var k="scaleBand"===this.xAxisType?"x":"y";return this.completeSeriesConfig[this._seriesKeys[0]][k]}else{return""}}},{key:"_getRegisterDisplay",value:function _getRegisterDisplay(axisType){return"scaleBand"===axisType}},{key:"_showGridlines",value:function _showGridlines(hideGridlines,chartType,type){if(chartType===type&&!hideGridlines){return!0}return!1}},{key:"_calcTooltipPos",value:function _calcTooltipPos(){if(this.showTooltip&&this.tooltipData&&this.tooltipData.series&&this.tooltipData.series.length&&this.tooltipData.series[0].coord){if(!this._svgClientRect){this._getImmediateSizing()}var screenX=this._svgClientRect.left+this._winX+this.margin.left,screenY=this.margin.top+this._svgClientRect.top+this._winY;if("scaleBand"===this.xAxisType){screenX+=this.x.bandwidth()/2+this.tooltipData.series[0].coord[0];screenY+=this.grouped?this._getLargestCoord(1,"min"):this.y(this._getSummedVal.bind(this)("x"))}else{screenY+=this.y.bandwidth()/2+this.tooltipData.series[0].coord[1];screenX+=this.grouped?this._getLargestCoord(0,"max"):this.x(this._getSummedVal.bind(this)("y"))}this.set("mousePosition",[screenX,screenY])}}},{key:"_getRegisterIconColor",value:function _getRegisterIconColor(){if(this.grouped&&this.colorByGroup){var set=this._getOrdSet();if(set){this.set("_registerIconColor",this._groupColors[set])}else{this.set("_registerIconColor",void 0)}}}},{key:"_getLargestCoord",value:function _getLargestCoord(index,type){return Px.d3[type](this.tooltipData.series,function(d){return d.coord[index]})}},{key:"_getSummedVal",value:function _getSummedVal(axis){var index=Px.d3.bisectLeft(this[axis].domain(),this.tooltipData.ordinalSet);if(index===this[axis].domain().length){index-=1}return Px.d3.max(this._stackedChartData,function(d){return _Mathmax(d[index][0],d[index][1])})}},{key:"_getOrdSet",value:function _getOrdSet(){if(this.tooltipData&&this.tooltipData.ordinalSet){return this.tooltipData.ordinalSet}return""}},{key:"_calcStackedDataExt",value:function _calcStackedDataExt(){var _Mathmin=Math.min,_this3=this;if(this.grouped){this.set("_stackedDataExtentsTrigger",this._stackedDataExtentsTrigger+=1);return}if(this.completeSeriesConfig&&this._doesObjHaveValues(this._stackedChartData)){var min=Px.d3.min(this._stackedChartData,function(dataset){return Px.d3.min(dataset,function(d){return _Mathmin(d[0],d[1])})}),max=Px.d3.max(this._stackedChartData,function(dataset){return Px.d3.max(dataset,function(d){return d[1]})}),exts=[min,max],valScale=this._getValueKey();Object.entries(this.completeSeriesConfig).forEach(function(_ref3){var _ref4=babelHelpers.slicedToArray(_ref3,2),k=_ref4[0],val=_ref4[1];if("line"===val.type){var ext=Px.d3.extent(_this3.chartData,function(d){return d[val[valScale]]});exts[0]=_Mathmin(ext[0],exts[0]);exts[1]=_Mathmax(ext[1],exts[1])}});if("scaleBand"===this.xAxisType){this.dataExtents={x:this.dataExtents.x,y:exts}}else{this.dataExtents={x:exts,y:this.dataExtents.y}}this.set("_stackedDataExtentsTrigger",this._stackedDataExtentsTrigger+=1)}}},{key:"_createGroupScale",value:function _createGroupScale(){if(!this.grouped||!this.x||!this.y||!this.completeSeriesConfig||0===this._seriesKeys.length||!this.domainChanged){return}var ordScale="scaleBand"===this.xAxisType?"x":"y",valScale=this._getValueKey(),domain=[],keys=[],hasLines=!1,lineSeries={};Object.entries(this.completeSeriesConfig).forEach(function(_ref5){var _ref6=babelHelpers.slicedToArray(_ref5,2),k=_ref6[0],val=_ref6[1];if("bar"===val.type){domain.push(val[valScale]);keys.push(k)}else if("line"===val.type){hasLines=!0;lineSeries[k]=val}});var scale=Px.d3.scaleBand().padding(.05).rangeRound([0,this[ordScale].bandwidth()]).domain(domain);this.set("_groupKeys",keys);this.set("_groupScale",scale);this.set("_hasLines",hasLines);this.set("_lineSeriesConfig",lineSeries)}},{key:"_createLineGroup",value:function _createLineGroup(){if(!this.layer||this._isD3Empty(this.layer[3])||!this.domainChanged){return}if(this._isD3Empty(this._lineG)){var g=this.layer[3].append("g").attr("class","lines");this.set("_lineG",g)}if(this._isOrdinalType(this.x._scaleType)){this._lineG.attr("transform","translate(".concat(this.x.bandwidth()/2,",0)"))}else if(this._isOrdinalType(this.y._scaleType)){this._lineG.attr("transform","translate(0,".concat(this.y.bandwidth()/2,")"))}}},{key:"_drawBaseline",value:function _drawBaseline(){if(!this.domainChanged){return}var valScale=this._getValueKey();if(0>this[valScale].domain()[0]){var x1,x2,y1,y2;if("scaleBand"===this.xAxisType){x1=this.x.range()[0];x2=this.x.range()[1];y1=this.y(0);y2=this.y(0)}else{x1=this.x(0);x2=this.x(0);y1=this.y.range()[0];y2=this.y.range()[1]}if(!this._baseline){this._baseline=this.layer[3].append("line")}this._baseline.attr("x1",x1).attr("x2",x2).attr("y1",y1).attr("y2",y2).attr("stroke",this._checkThemeVariable("--px-vis-axis-color","black"))}else{if(this._baseline){if(this._baseline.remove){this._baseline.remove()}this._baseline=null}}}},{key:"_getValueKey",value:function _getValueKey(){return"scaleBand"===this.xAxisType?"y":"x"}},{key:"_xAxisConfigChanged",value:function _xAxisConfigChanged(conf){if(this.hasUndefinedArguments(arguments)){return}this._applyConfigToElement(this.xAxisConfig,this.$.xAxis)}},{key:"_yAxisConfigChanged",value:function _yAxisConfigChanged(conf){if(this.hasUndefinedArguments(arguments)){return}this._applyConfigToElement(this.yAxisConfig,this.$.yAxis)}},{key:"_registerConfigChanged",value:function _registerConfigChanged(conf){if(this.hasUndefinedArguments(arguments)){return}var register=this.shadowRoot.querySelector("#register");this._applyConfigToElement(this.registerConfig,register)}},{key:"_tooltipConfigChanged",value:function _tooltipConfigChanged(conf){if(this.hasUndefinedArguments(arguments)){return}if(!this.showTooltip){return}var tooltip=this.shadowRoot.querySelector("#tooltip");this._applyConfigToElement(this.tooltipConfig,tooltip)}},{key:"_getTooltipOrientation",value:function _getTooltipOrientation(xAxisType){return"scaleBand"===xAxisType?"top":"right"}},{key:"_checkReference",value:function _checkReference(evt){var _this4=this,target=evt.target;this._debounce("_checkReference",function(){if(!_this4.referenceData||!target||!target._referenceConfig){return}Object.entries(target._referenceConfig).forEach(function(_ref7){var _ref8=babelHelpers.slicedToArray(_ref7,2),k=_ref8[0],val=_ref8[1],search=!0,i=0;while(search){var xInvalid=!0,yInvalid=!0;if(_this4._isValidData(_this4.referenceData[i][val.x])&&_this4._isValidData(_this4.x(_this4.referenceData[i][val.x]))){xInvalid=!1}if(_this4._isValidData(_this4.referenceData[i][val.y])&&_this4._isValidData(_this4.y(_this4.referenceData[i][val.y]))){yInvalid=!1}search=xInvalid||yInvalid;i+=1;if(i===_this4.referenceData.length){console.warn("Something is wrong with your referenceConfig / referenceData. Did you flip the x and y?");search=!1}}})},100)}},{key:"_returnLineSeriesKeys",value:function _returnLineSeriesKeys(){return Object.keys(this._lineSeriesConfig)}},{key:"_showThresholds",value:function _showThresholds(){return this.thresholdData&&this.thresholdData.length?!0:!1}},{key:"_showRef",value:function _showRef(){return this.referenceData&&this.referenceData.length?!0:!1}}]);return PxVisBarChart}(Polymer.mixinBehaviors(behaviours,Polymer.Element));window.customElements.define(PxVisBarChart.is,PxVisBarChart);window.PxVisBarChart=PxVisBarChart})();</script>
</dom-module>
</body></html>