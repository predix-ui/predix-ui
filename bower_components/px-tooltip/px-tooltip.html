<!--
Copyright (c) 2018, General Electric

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
--><html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="css/px-tooltip-styles.html">

<!--
Tooltips can be positioned above, below, to the left, or to the right of the target.
A Smart Orientation option is included that will attempt to automatically choose a placement based on the real estate available â€“ this attempts to prevent the tooltip from going off the screen.

***Note:** tooltips are not recommended for mobile or tablet applications since the hover affordance is inconsistent across devices and platforms (3D touch, tap-and-hold, proximity sensors, etc). See [px-popover](https://www.predix-ui.com/#/components/px-popover/), which is invoked on tap/click instead.

### Usage
Basic:

    <div id="hoverDivTop" class="hover-tooltip">Hover for tooltip</div>
    <px-tooltip
        for="hoverDivTop"
        orientation="top"
        tooltip-message="Top tooltip">
    </px-tooltip>

Custom HTML content using the default slot:

    <button id="hoverButton">Hover</button>
    <px-tooltip for="hoverButton">
      <span><strong>My Custom Content</strong></span>
    </px-tooltip>

### Styling
The following custom properties are available for styling.

Custom property | Description
:----------------|:-------------
`--px-tooltip-text-color` | Text color for the tooltip
`--px-tooltip-background-color` | Background color for the tooltip
`--px-tooltip-border-color` | Border color for the tooltip
`--px-tooltip-shadow-color` | Box shadow color for the tooltip
`--px-tooltip-max-width` | Max width of the tooltip
`--px-tooltip-z-index` | z-index for the tooltip

@element px-tooltip
@blurb Tooltip element that provides additional information to users once hovered over the target element for a specified amount of time.
@homepage index.html
@demo index.html
-->
</head><body><dom-module id="px-tooltip">
  <template>
    <style include="px-tooltip-styles"></style>

    <div id="tooltip" class$="[[_getClass(visible, _tooltipPos)]]">
      <div id="message">
        <span>{{ tooltipMessage }}</span>
        <slot></slot>
      </div>
    </div>
  </template>
</dom-module>

<script>Polymer({is:"px-tooltip",behaviors:[Polymer.IronResizableBehavior],_values:{TYPE:{top:"top",bottom:"bottom",left:"left",right:"right"}},properties:{for:{type:HTMLElement,observer:"_onFor",notify:!0,value:""},delay:{type:Number,reflect:!0,value:500},orientation:{type:String,value:"auto"},tooltipMessage:{type:String,value:""},opened:{type:Boolean,value:!1,notify:!0},visible:{type:Boolean,value:!1,readOnly:!0,notify:!0},ignoreTargetEvents:{type:Boolean,value:!1},openRequested:{type:Boolean,value:!1,readOnly:!0,notify:!0},smartOrientation:{type:Boolean,value:!1},_cancel:{type:Boolean,value:!1},_tooltipParent:{type:Object,value:function value(){return{}}},followMouse:{type:Boolean,value:!1},mouseCoords:{type:Array,value:[-9999,-9999]},_watchDogEnabled:{type:Boolean,value:!1},_firstAttached:{type:Boolean,value:!0},watchDogTimeout:{type:Number,value:250},_currTarget:{type:Object},_internalDetaching:{type:Boolean,value:!1},_margin:{type:Object,value:function value(){return{top:10,bottom:10,left:10,right:10}}},_tooltipPos:{type:String,value:"right"}},observers:["_onMouseMove(mouseCoords.*)","_openedChanged(opened)","_ignoreTargetEventsChanged(ignoreTargetEvents)"],listeners:{"iron-resize":"_onIronResize"},attached:function attached(){if(this._firstAttached){this.setAttribute("role","tooltip");this.set("_tooltipParent",this.parentNode);if(this._target){this.listenEvents()}else{this._onFor()}this.set("_firstAttached",!1)}},detached:function detached(){if(!this._internalDetaching){this.set("opened",!1);this.unlistenEvents();this._target=null;this._firstAttached=!0}else{this._internalDetaching=!1;if(!this.openRequested){this.fire("px-tooltip-hide",{target:this})}}},listenEvents:function listenEvents(){if(this._target&&!this.ignoreTargetEvents){if(Array.isArray(this._target)){for(var i=0;i<this._target.length;i++){this.listen(this._target[i],"mouseenter","_setOpenedTrue");this.listen(this._target[i],"mouseup","_setOpenedTrue");this.listen(this._target[i],"mouseleave","_setOpenedFalse");this.listen(this._target[i],"mousedown","_setOpenedFalse")}}else{this.listen(this._target,"mouseenter","_setOpenedTrue");this.listen(this._target,"mouseup","_setOpenedTrue");this.listen(this._target,"mouseleave","_setOpenedFalse");this.listen(this._target,"mousedown","_setOpenedFalse")}}},unlistenEvents:function unlistenEvents(){if(this._target){if(Array.isArray(this._target)){for(var i=0;i<this._target.length;i++){this.unlisten(this._target[i],"mouseenter","_setOpenedTrue");this.unlisten(this._target[i],"mouseup","_setOpenedTrue");this.unlisten(this._target[i],"mouseleave","_setOpenedFalse");this.unlisten(this._target[i],"mousedown","_setOpenedFalse")}}else{this.unlisten(this._target,"mouseenter","_setOpenedTrue");this.unlisten(this._target,"mouseup","_setOpenedTrue");this.unlisten(this._target,"mouseleave","_setOpenedFalse");this.unlisten(this._target,"mousedown","_setOpenedFalse")}}},_setOpenedTrue:function _setOpenedTrue(){this.set("opened",!0)},_setOpenedFalse:function _setOpenedFalse(){this.set("opened",!1)},_openedChanged:function _openedChanged(){if(this.opened&&(!this.visible||!this.openRequested)){this._show()}if(!this.opened&&(this.visible||this.openRequested)){this._hide()}},_onMouseMove:function _onMouseMove(){if(this.followMouse&&this.thisRect&&this.visible){if("auto"===this.orientation){this._autoPosition()}else if(this.smartOrientation){this._doPosition(this._findValidSmartOrientation(this.orientation))}else{this._doPosition(this.orientation)}}},_onFor:function _onFor(){this.unlistenEvents();this.target=this._getTarget();this._target=this.target;this.listenEvents()},_onIronResize:function _onIronResize(){if(this._watchDogEnabled){this.debounce("tooltip-resize",function(){if(this.openRequested){this._processShow()}else if(this.visible){this.setPosition()}},50)}},_getTarget:function _getTarget(){var ownerRoot=Polymer.dom(this).getOwnerRoot(),parentNode=Polymer.dom(this).parentNode,target;if(this.for&&"string"===typeof this.for){target=Polymer.dom(parentNode).querySelector("#"+this.for)}else if(this.for&&Array.isArray(this.for)&&"string"===typeof this.for[0]){target=[];for(var i=0;i<this.for.length;i++){target.push(Polymer.dom(parentNode).querySelector("#"+this.for[i]))}}else if(this.for&&"object"===babelHelpers.typeof(this.for)){target=this.for}else if(!parentNode||11===parentNode.nodeType){target=ownerRoot?ownerRoot.host:null}else{target=parentNode}return target},_show:function _show(evt){var _this=this,currTarget=Polymer.dom(evt).rootTarget;this.set("_cancel",!1);this._setOpenRequested(!0);setTimeout(function(){if(!0===this._cancel){return!1}currTarget=currTarget?currTarget:this.target.length?this.target[0]:this.target;this.set("_currTarget",currTarget);this._watchDogEnabled=!0;if(this._watchDog()){this._internalDetaching=!0;this.fire("px-tooltip-request-show",{target:this});document.body.appendChild(this)}}.bind(this),this.delay)},_processShow:function _processShow(){if(this._cancel){return}this._setVisible(!0);this.setPosition();this.fire("px-tooltip-show",{target:this});this._setOpenRequested(!1)},_hide:function _hide(){this.set("_cancel",!0);if(this.visible||this.openRequested){this._watchDogEnabled=!1;this._setOpenRequested(!1);this._setVisible(!1);this.fire("px-tooltip-request-hide",{target:this});if(this._tooltipParent&&this._tooltipParent.appendChild){this._internalDetaching=!0;this._tooltipParent.appendChild(this)}else{if(this.remove){this.remove()}else{this._setVisible("visible")}}}},setPosition:function setPosition(){if(!this._target){return}this.targetRect=this.followMouse?this.getBoundingClientRect():this._target.getBoundingClientRect();this.thisRect=this.followMouse?this.targetRect:this.getBoundingClientRect();if("auto"===this.orientation){this._autoPosition()}else if(this.smartOrientation){this._doPosition(this._findValidSmartOrientation(this.orientation))}else{this._doPosition(this.orientation)}},_autoPosition:function _autoPosition(){this._doPosition(this._findValidSmartOrientation(this._values.TYPE.right))},_fitOnLeft:function _fitOnLeft(){var mostLeft,mostTop,mostLow,startX=this.followMouse?this.mouseCoords[0]-window.pageXOffset:this.targetRect.left,startY=this.followMouse?this.mouseCoords[1]-window.pageYOffset:this.targetRect.top+this.targetRect.height/2;mostLeft=startX-this.thisRect.width-5;mostTop=startY-this.thisRect.height/2;mostLow=startY+this.thisRect.height/2;return 0<mostLeft&&0<mostTop&&mostLow<window.innerHeight},_fitOnRight:function _fitOnRight(){var mostLeft,mostTop,mostLow,startX=this.followMouse?this.mouseCoords[0]-window.pageXOffset:this.targetRect.right,startY=this.followMouse?this.mouseCoords[1]-window.pageYOffset:this.targetRect.top+this.targetRect.height/2,mostRight=startX+this.thisRect.width+5,mostTop=startY-this.thisRect.height/2,mostLow=startY+this.thisRect.height/2;return mostRight<window.innerWidth&&0<mostTop&&mostLow<window.innerHeight},_fitOnTop:function _fitOnTop(){var mostHigh,mostRight,mostLeft,startX=this.followMouse?this.mouseCoords[0]-window.pageXOffset:this.targetRect.left+this.targetRect.width/2,startY=this.followMouse?this.mouseCoords[1]-window.pageYOffset:this.targetRect.top,mostHigh=startY-this.thisRect.height-5,mostRight=startX+this.thisRect.width/2,mostLeft=startX-this.thisRect.width/2;return 0<mostHigh&&mostRight<window.innerWidth&&0<mostLeft},_fitBelow:function _fitBelow(){var mostHigh,mostRight,mostLeft,startX=this.followMouse?this.mouseCoords[0]-window.pageXOffset:this.targetRect.left+this.targetRect.width/2,startY=this.followMouse?this.mouseCoords[1]-window.pageYOffset:this.targetRect.bottom,mostLow=startY+this.thisRect.height+5,mostRight=startX+this.thisRect.width/2,mostLeft=startX-this.thisRect.width/2;return mostLow<window.innerHeight&&mostRight<window.innerWidth&&0<mostLeft},_findValidSmartOrientation:function _findValidSmartOrientation(startingOrientation){var orientationList=[this._values.TYPE.left,this._values.TYPE.top,this._values.TYPE.right,this._values.TYPE.bottom],i=0,index;switch(startingOrientation){case this._values.TYPE.left:index=0;break;case this._values.TYPE.top:index=1;break;case this._values.TYPE.right:index=2;break;case this._values.TYPE.bottom:index=3;break;}for(i=0;4>i;i++){if(this._orientationFit(orientationList[index])){return orientationList[index]}index=(index+1)%4}return startingOrientation},_orientationFit:function _orientationFit(orientation){switch(orientation){case this._values.TYPE.right:return this._fitOnRight();break;case this._values.TYPE.left:return this._fitOnLeft();break;case this._values.TYPE.top:return this._fitOnTop();break;case this._values.TYPE.bottom:return this._fitBelow();break;}},_doPosition:function _doPosition(orientation){switch(orientation){case this._values.TYPE.right:this._positionRight();break;case this._values.TYPE.left:this._positionLeft();break;case this._values.TYPE.top:this._positionTop();break;case this._values.TYPE.bottom:this._positionBottom();break;}},_positionTop:function _positionTop(){this.set("_tooltipPos","top");if(this.followMouse){this.style.left=this.mouseCoords[0]-this.thisRect.width/2+"px";this.style.top=this.mouseCoords[1]-this.thisRect.height-this._margin.top+"px"}else{this.style.left=this._getTargetPositionCenterOfLeftRight()-this.thisRect.width/2+"px";this.style.top=this._getTargetPositionTop()-this.thisRect.height-this._margin.top+"px"}},_positionBottom:function _positionBottom(){this.set("_tooltipPos","bottom");if(this.followMouse){this.style.left=this.mouseCoords[0]-this.thisRect.width/2+"px";this.style.top=this.mouseCoords[1]+this._margin.bottom+"px"}else{this.style.left=this._getTargetPositionCenterOfLeftRight()-this.thisRect.width/2+"px";this.style.top=this._getTargetPositionBottom()+this._margin.bottom+"px"}},_positionLeft:function _positionLeft(){var top;this.set("_tooltipPos","left");if(this.followMouse){this.style.left=this.mouseCoords[0]-this.thisRect.width-this._margin.top+"px";this.style.top=this.mouseCoords[1]-this.thisRect.height/2+"px"}else{top=Math.round(this._getTargetPositionCenterOfTopBottom()-this.thisRect.height/2)+"px";this.style.left=this._getTargetPositionLeft()-this.thisRect.width-this._margin.left+"px";this.style.top=top}},_positionRight:function _positionRight(){var top;this.set("_tooltipPos","right");if(this.followMouse){this.style.left=this.mouseCoords[0]+10+"px";this.style.top=this.mouseCoords[1]-this.thisRect.height/2+"px"}else{top=Math.round(this._getTargetPositionCenterOfTopBottom()-this.thisRect.height/2)+"px";this.style.left=this._getTargetPositionRight()+this._margin.left+"px";this.style.top=top}},_getTargetPositionTop:function _getTargetPositionTop(){return this._getTargetPosition("top","pageYOffset")},_getTargetPositionBottom:function _getTargetPositionBottom(){return this._getTargetPositionTop()+this.targetRect.height},_getTargetPositionLeft:function _getTargetPositionLeft(smartOrientation){return this._getTargetPosition("left","pageXOffset")},_getTargetPositionRight:function _getTargetPositionRight(){return this._getTargetPositionLeft()+this.targetRect.width},_getTargetPositionCenterOfTopBottom:function _getTargetPositionCenterOfTopBottom(){return this._getTargetPositionTop()+this.targetRect.height/2},_getTargetPositionCenterOfLeftRight:function _getTargetPositionCenterOfLeftRight(smartOrientation){return this._getTargetPositionLeft()+this.targetRect.width/2},_getTargetPosition:function _getTargetPosition(topOrLeft,pageXOrYOffset){var position=this.targetRect[topOrLeft];position+=window[pageXOrYOffset];return position},_isWithinDom:function _isWithinDom(node){var current=node,search=!0;while(current&&"BODY"!==current.nodeName){if(11===current.nodeType){current=current.host}else{current=current.parentNode}}return!!current},_watchDog:function _watchDog(){if(!this._isWithinDom(this._currTarget)){this._watchDogEnabled=!1;if(this.remove){this.remove()}else{this.set("opened",!1)}if(this.target.length){this.target.remove(this._currTarget)}return!1}else if(this._watchDogEnabled){setTimeout(function(){this._watchDog()}.bind(this),this.watchDogTimeout)}return!0},_getClass:function _getClass(){var res="tooltip-container ";if(!this.visible){res+=" hidden "}res+=this._tooltipPos;return res},_ignoreTargetEventsChanged:function _ignoreTargetEventsChanged(){if(this.ignoreTargetEvents){this.unlistenEvents()}else{this.listenEvents()}}});</script>
</body></html>