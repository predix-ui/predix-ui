<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../px-d3-imports/px-d3-imports.html">
<link rel="import" href="../px-number-formatter/px-number-formatter-behavior.html">
<link rel="import" href="../px-number-formatter/px-number-formatter-no-display.html">
<link rel="import" href="../px-component-helpers/px-common-behaviors.html">
<link rel="import" href="../iron-a11y-keys/iron-a11y-keys.html">
<link rel="import" href="css/px-slider-styles.html">
<link rel="import" href="css/px-handle-styles.html">
<!--
### Usage

    <px-slider value="50" min="1" max="100"></px-slider>

### Styling
The following custom properties are available for styling:

Custom property | Description
:---------------|:-------------
`--px-slider-border-color` | Border color for the unselected portion of the slider
`--px-slider-border-color--selected` | Border color for the selected portion of the slider
`--px-slider-border-color--disabled` | Border color for the unselected portion of the slider when disabled
`--px-slider-progress-border-color--disabled` | Border color for the selected portion of the slider when disabled
|
`--px-slider-background-color` | Background color for the unselected portion of the slider
`--px-slider-background-color--selected` | Background color for the selected portion of the slider
`--px-slider-background-color--hover` | Background color for the selected portion of the slider when hovered
`--px-slider-background-color--pressed` | Background color for the selected portion of the slider when pressed
`--px-slider-background-color--disabled` | Background color for the unselected portion of the slider when disabled
`--px-slider-progress-background-color--disabled` | Background color for the selected portion of the slider when disabled
|
`--px-handle-stroke-color` | Border color for the handle
`--px-handle-stroke-color--hover` | Border color for the handle when hovered
`--px-handle-stroke-color--active` | Border color for the handle when pressed
`--px-handle-color--disabled` | Border color for the handle when disabled
|
`--px-handle-background-color` | Background color for the handle
`--px-handle-background-color--hover` | Background color for the handle when hovered
`--px-handle-background-color--active` | Background color for the handle when pressed
`--px-handle-background-color--disabled` | Background color for the handle when disabled
|
`--px-slider-label-color` | Text color for the min/max labels

@element px-slider
@blurb Allow the user to select a value or range of values within a specified min and max.
@homepage index.html
@demo index.html
-->
</head><body><dom-module id="px-slider">
  <template>
    <style include="px-slider-styles"></style>
    <style include="px-handle-styles"></style>

    <div id="wrapper" class="flex">
      <template is="dom-if" if="[[_showStartInput]]">
        <label for="inputStart" class="visuallyhidden">Value or Start Value</label>
        <input id="inputStart" type="text" class="text-input" value="[[formattedStartValue]]" on-change="_inputChangedStart" tabindex="0" disabled="{{disabled}}">
      </template>
      <px-number-formatter-no-display id="formatterStart" value="[[value]]" formatted-value="{{formattedStartValue}}" format="[[_format]]" currency="[[currency]]" culture="[[culture]]" zero-format="[[zeroFormat]]">
      </px-number-formatter-no-display>
      <iron-a11y-keys id="a11yStart" target="[[_inputStart]]" keys="esc" on-keys-pressed="_restoreStartInputValue">
      </iron-a11y-keys>

      <svg xmlns="http://www.w3.org/2000/svg" id="sliderSVG" class="flex__item u-mb" overflow="visible" width$="[[_getSvgWidth(_width, _margin.*)]]" height$="[[_getSvgHeight(_height, _margin.*)]]">
        <g id="sliderContainer" transform$="[[_calcTransform(_margin.*)]]">
          <g id="backgroundTrack">
            <rect class="backgroundTrack sliderTrack" x="0" y="0" width$="[[_width]]" height="5"></rect>
          </g>
          <g id="zoneBars"></g>
          <g id="progressBar">
            <rect class="progressBar sliderTrack" x$="[[_calcProgressStart(value, _scaleChanged, isRange)]]" y="0" width$="[[_calcProgressEnd(value, endValue, _scaleChanged, isRange)]]" height="5"></rect>
          </g>

          <g id="labelContainer">
            <text id="minLabel" class="minMaxLabel" text-anchor="start" dominant-baseline$="[[_returnLabelBaseline(minLabelPosition)]]" x="0" y$="[[_returnLabelPosition(minLabelPosition, isRange)]]">{{_returnLabel(min, showLabels)}}</text>
            <text id="maxLabel" class="minMaxLabel" text-anchor="end" dominant-baseline$="[[_returnLabelBaseline(maxLabelPosition)]]" x$="[[_width]]" y$="[[_returnLabelPosition(maxLabelPosition, isRange)]]">{{_returnLabel(max, showLabels)}}</text>
          </g>

          <g id="handleStart" class="handleGroup">
            <path class="handleBody"></path>
          </g>
          <g id="handleEnd" class="handleGroup">
            <path class="handleBody"></path>
          </g>
        </g>
      </svg>

      <template is="dom-if" if="[[_showEndInput]]">
        <label for="inputEnd" class="visuallyhidden">End Value</label>
        <input id="inputEnd" type="text" class="text-input input--tiny" value="[[formattedEndValue]]" on-change="_inputChangedEnd" tabindex="0" disabled="{{disabled}}">
      </template>
      <px-number-formatter-no-display id="formatterEnd" value="[[endValue]]" formatted-value="{{formattedEndValue}}" format="[[_format]]" currency="[[currency]]" culture="[[culture]]" zero-format="[[zeroFormat]]">
      </px-number-formatter-no-display>
      <iron-a11y-keys id="a11yEnd" target="[[_inputEnd]]" keys="esc" on-keys-pressed="_restoreEndInputValue">
      </iron-a11y-keys>
    </div>
  </template>
  <script>Polymer({is:"px-slider",properties:{_height:{type:Number,value:10},_width:{type:Number,value:52},_margin:{type:Object,notify:!0,value:function value(){return{left:15,right:15,top:15,bottom:10}}},value:{type:Number,notify:!0,value:0},endValue:{type:Number,notify:!0,value:null},formattedStartValue:{type:String},formattedEndValue:{type:String},min:{type:Number,value:1},max:{type:Number,value:100},_minMaxValid:{type:Number,value:0},step:{type:Number,value:1,observer:"_stepChanged"},disabled:{type:Boolean,value:!1,observer:"_setupListeners"},hideInputs:{type:Boolean,value:!1},_showStartInput:{type:Boolean,value:!0},_showEndInput:{type:Boolean,value:!1},isRange:{type:Boolean,value:!1},scale:{type:String,value:"linear",observer:"_createScale"},base:{type:Number,value:10},exponent:{type:Number,value:1},_scale:{type:Function},_scaleChanged:{type:Boolean},_startHandle:{type:Object},_endHandle:{type:Object},_progressBar:{type:Object},_backgroundTrack:{type:Object},_inputStart:{type:HTMLElement},_inputEnd:{type:HTMLElement},_minLabel:{type:Object},_maxLabel:{type:Object},_format:{type:String,value:"0"},showLabels:{type:Boolean,value:!1},minLabelPosition:{type:String,value:"bottom"},maxLabelPosition:{type:String,value:"bottom"},_handleDefinitions:{type:Object,value:function value(){return{circle:{bodyD:"m0,-7.5c5,0 10,5 10,10c0,5 -5,10 -10,10c-5,0 -10,-5 -10,-10c0,-5 5,-10 10,-10z"},down:{bodyD:"m7.5,-13l-15,0l7.5,12l7.5,-12z"},up:{bodyD:"m7.5,18l-15,0l7.5,-12l7.5,12z"}}}},_transformX:{type:Number,value:0},_searchForTransforms:{type:Boolean,value:!1},_transformEventName:{type:String,value:"search-for-transforms"}},behaviors:[Polymer.IronResizableBehavior,PxNumberFormatter.commonProperties,PxCommonBehavior.uniqueIds],listeners:{"iron-resize":"_onIronResize"},observers:["_minOrMaxChanged(min, max)","_setRange(_scale, _width, _height)","_setDomain(_scale, _minMaxValid)","_valueChanged(value, _scale, _scaleChanged)","_endValueChanged(endValue, _scale, _scaleChanged)","_updateFormat(step, _format)","_isRangeChanged(isRange)","_hideInputsChanged(hideInputs)"],ready:function ready(){window.requestAnimationFrame(this._animationFrame.bind(this))},attached:function attached(){this.setAttribute("role","slider")},detached:function detached(){if(this._searchForTransforms){this.removeID(this._transformEventName);window.removeEventListener(this._transformEventName,this._searchForTransformationsBound)}},_animationFrame:function _animationFrame(){var startHandle=Px.d3.select(this.$$("#handleStart")),endHandle=Px.d3.select(this.$$("#handleEnd")),progressBar=Px.d3.select(this.$$("#progressBar")),backgroundTrack=Px.d3.select(this.$$("#backgroundTrack")),minLabel=Px.d3.select(this.$$("#minLabel")),maxLabel=Px.d3.select(this.$$("#maxLabel"));this.set("_startHandle",startHandle);this.set("_endHandle",endHandle);this.set("_progressBar",progressBar);this.set("_backgroundTrack",backgroundTrack);this.set("_minLabel",minLabel);this.set("_maxLabel",maxLabel);this._buildHandles();this._setupListeners();if(!!navigator.userAgent.match(/Firefox/)){this._searchForTransforms=!0;this._transformEventName+=this.generateRandomID(this._transformEventName);this._searchForTransformationsBound=this._searchForTransformations.bind(this);window.addEventListener(this._transformEventName,this._searchForTransformationsBound)}},_searchForTransformations:function _searchForTransformations(evt){var _this2=this,ne=Polymer.dom(evt),transform=0;window.requestAnimationFrame(function(){for(var i=0;i<ne.path.length;i++){if(babelHelpers.instanceof(ne.path[i],HTMLElement)){var styles=window.getComputedStyle(ne.path[i]);if(styles.transform&&"none"!==styles.transform){transform+=+styles.transform.split(",")[4]}}}_this2._transformX=Math.abs(transform)})},_setupListeners:function _setupListeners(){if(this._startHandle&&this._endHandle){if(this.disabled){this._removeHandleListeners();this._removeTrackListeners()}else{this._createHandleListeners(this._startHandle,"value");this._createHandleListeners(this._endHandle,"endValue");this._createTrackListeners()}this._toggleDisabledClass()}},_createHandleListeners:function _createHandleListeners(handle,valueVar){var handleBody=handle.select(".handleBody"),progressBar=Px.d3.select(this.$$(".progressBar"));handle.call(Px.d3.drag().on("start.interrupt",function(){handle.interrupt()}).on("start drag",function(){handleBody.classed("handleBodyPressed",!0);progressBar.classed("progressBarPressed",!0);this._calcSliderValue(Px.d3.event.x+this._transformX,valueVar)}.bind(this)).on("end",function(){handleBody.classed("handleBodyPressed",!1);progressBar.classed("progressBarPressed",!1)})).on("mouseenter",function(){handleBody.classed("handleBodyHover",!0);progressBar.classed("progressBarHover",!0)}).on("mouseleave",function(){handleBody.classed("handleBodyHover",!1);progressBar.classed("progressBarHover",!1)})},_createTrackListeners:function _createTrackListeners(){var _this=this,interactionRects=Px.d3.selectAll(Polymer.dom(this.$$("#sliderSVG")).querySelectorAll(".sliderTrack"));interactionRects.on("click",function(){_this._trackOnClick(this)})},_trackOnClick:function _trackOnClick(elem){var val=Px.d3.mouse(elem)[0]+this._transformX,prop="value";if(this.isRange){var scaled=this._scale.invert(val),half=(this.endValue-this.value)/2+this.value;prop=scaled>this.endValue||scaled>half?"endValue":"value"}this._calcSliderValue(val,prop)},_removeHandleListeners:function _removeHandleListeners(){this._startHandle.on(".drag",null);this._endHandle.on(".drag",null)},_removeTrackListeners:function _removeTrackListeners(){var interactionRects=Px.d3.selectAll(Polymer.dom(this.$$("#sliderSVG")).querySelectorAll(".sliderTrack"));interactionRects.on("click",null)},_buildHandles:function _buildHandles(){if(this._handleDefinitions&&this._startHandle&&this._endHandle){if(this.isRange){this._startHandle.select(".handleBody").attr("d",this._handleDefinitions.down.bodyD);this._endHandle.select(".handleBody").attr("d",this._handleDefinitions.up.bodyD)}else{this._startHandle.select(".handleBody").attr("d",this._handleDefinitions.circle.bodyD);this._endHandle.select(".handleBody").attr("d",null)}}},_assignInputElems:function _assignInputElems(){Polymer.dom.flush();this.set("_inputStart",this.$$("#inputStart"));this.set("_inputEnd",this.$$("#inputEnd"))},_onIronResize:function _onIronResize(){this.debounce("ironresize",function(){var wrapperRect=this.$.wrapper.getBoundingClientRect(),startInputSize=this._inputStart?this._inputStart.getBoundingClientRect().width:0,startInputMargin=this._inputStart?+window.getComputedStyle(this._inputStart).marginRight.split("px")[0]:0,endInputSize=this._inputEnd?this._inputEnd.getBoundingClientRect().width:0,endInputMargin=this._inputEnd?+window.getComputedStyle(this._inputEnd).marginLeft.split("px")[0]:0,w=wrapperRect.width-startInputSize-endInputSize-startInputMargin-endInputMargin-this._margin.left-this._margin.right;this.set("_width",Math.max(w,0));if(this._searchForTransforms){var event=new CustomEvent(this._transformEventName,{bubbles:!0,composed:!0,cancelable:!0});this.dispatchEvent(event)}},10)},_hideInputsChanged:function _hideInputsChanged(hideInputs){if(this.hideInputs){this.set("_showStartInput",!1);this.set("_showEndInput",!1)}else{this.set("_showStartInput",!0);this.set("_showEndInput",this.isRange)}this._assignInputElems();this.notifyResize()},_getSvgWidth:function _getSvgWidth(_width,_margin){if(!(_width===void 0||_margin===void 0)){return this._width+this._margin.left+this._margin.right}},_getSvgHeight:function _getSvgHeight(_height,_margin){if(!(_height===void 0||_margin===void 0)){return this._height+this._margin.top+this._margin.bottom}},_calcTransform:function _calcTransform(){return"translate("+this._margin.left+","+this._margin.top+")"},_stepChanged:function _stepChanged(){if(this.step!==void 0){if(0>this.step){console.warn("Improper configuration: step cannot be negative. Falling back to absolute value");this.set("step",Math.abs(this.step));return}if(0===this.step){console.warn("Improper configuration: step cannot be negative. Falling back to 1");this.set("step",1);return}}},_minOrMaxChanged:function _minOrMaxChanged(min,max){if(!(min===void 0||max===void 0)){if(this.min===this.max){this.set("_minMaxValid",0);console.warn("Improper configuration: min and max are the same. Increasing max by step size.");this.set("max",this.min+this.step);return}if(this.min>this.max){this.set("_minMaxValid",0);console.warn("Improper configuration: min and max are reversed. Swapping them.");var temp=this.min;this.set("min",this.max);this.set("max",temp);return}this.setAttribute("aria-valuemin",this.min);this.setAttribute("aria-valuemax",this.max);this.set("_minMaxValid",(this._minMaxValid||0)+1)}},_createScale:function _createScale(){this.debounce("_createScale",function(){this._createScaleDebounced()},10)},_createScaleDebounced:function _createScaleDebounced(){var scale;if("linear"===this.scale){scale=Px.d3.scaleLinear().clamp(!0)}else if("logarithmic"===this.scale){scale=Px.d3.scaleLog().base(this.base).clamp(!0)}else if("exponential"===this.scale){scale=Px.d3.scalePow().exponent(this.exponent).clamp(!0)}this.set("_scale",scale)},_setRange:function _setRange(_scale,_width,_height){if(!(_scale===void 0||_width===void 0||_height===void 0)){this.debounce("_setRange",function(){if(this._scale&&this._width&&this._height){this._setRangeDebouced()}},10)}},_setRangeDebouced:function _setRangeDebouced(){var _Mathmax=Math.max,range;if("vertical"===this.orientation){var h=_Mathmax(this._height,0);range=[h,0]}else{var w=_Mathmax(this._width,0);range=[0,w]}this._scale.range(range);this._scaleChanged=!this._scaleChanged},_setDomain:function _setDomain(_scale,_minMaxValid){if(!(_scale===void 0||_minMaxValid===void 0)){this.debounce("_setDomain",function(){if(this._scale&&this._minMaxValid){this._setDomainDebounced()}},10)}},_setDomainDebounced:function _setDomainDebounced(){this._scale.domain([this.min,this.max]);this._scaleChanged=!this._scaleChanged},_calcSliderValue:function _calcSliderValue(mouseVal,valueVar){this.debounce("_calcSliderValue",function(){this._calcSliderValueDebounced(mouseVal,valueVar)},10)},_calcSliderValueDebounced:function _calcSliderValueDebounced(mouseVal,valueVar){var val=this._scale.invert(mouseVal),stepped=this._calcStepRounded(val),inputElem="value"===valueVar?this._inputStart:this._inputEnd;if(this.isRange){stepped="value"===valueVar&&stepped>this.endValue?this.endValue:stepped;stepped="endValue"===valueVar&&stepped<this.value?this.value:stepped}this.toggleClass("validation-error",!1,inputElem);this.set(valueVar,stepped)},_calcStepRounded:function _calcStepRounded(value){var s=Math.round(value/this.step)*this.step;s=s<this.min?s+this.step:s;s=s>this.max?s-this.step:s;return s},_validateValue:function _validateValue(v,thisVal){var valid=!0;if(this.isRange&&"value"===thisVal&&v>this.endValue){v=this.endValue;valid=!1;this.set(thisVal,v)}else if(this.isRange&&"endValue"===thisVal&&v<this.value){v=this.value;valid=!1;this.set(thisVal,v)}if(v<this.min){v=this._calcStepRounded(this.min);valid=!1;this.set(thisVal,v)}else if(v>this.max){v=this._calcStepRounded(this.max);valid=!1;this.set(thisVal,v)}return valid},_valueChanged:function _valueChanged(value,_scale,_scaleChanged){if(!(value===void 0||_scale===void 0||_scaleChanged===void 0)){if(this._startHandle){var valid=this._validateValue(value,"value");if(valid){this._moveHandle(this._startHandle,value);this.setAttribute("aria-valuenow",value)}}}},_endValueChanged:function _endValueChanged(endValue,_scale,_scaleChanged){if(!(endValue===void 0||_scale===void 0||_scaleChanged===void 0)){if(null!==endValue&&this._endHandle){var valid=this._validateValue(endValue,"endValue");if(valid){this._moveHandle(this._endHandle,endValue)}}}},_moveHandle:function _moveHandle(handle,v){handle.attr("transform","translate("+this._scale(v)+",0)")},_calcProgressStart:function _calcProgressStart(value,_scaleChanged,isRange){if(this._scale!==void 0){if(this.isRange){return this._scale(this.value)}return 0}},_calcProgressEnd:function _calcProgressEnd(value,endValue,_scaleChanged,isRange){if(!(value===void 0||endValue===void 0||_scaleChanged===void 0||isRange===void 0)){if(this.isRange){return Math.max(this._scale(this.endValue)-this._scale(this.value),1)}return this._scale(this.value)}},_updateFormat:function _updateFormat(step,format){if(step!==void 0){if(this.format){this.set("_format",this.format);return}for(var s=this.step.toString().split("."),l=2===s.length?s[1].length:0,f="0.",i=0;i<l;i++){f+="0"}this.set("_format",f)}},_inputChangedStart:function _inputChangedStart(evt){var text=this._inputStart.value;this._inputChanged(text,this._inputStart,"#formatterStart","value")},_inputChangedEnd:function _inputChangedEnd(evt){var text=this._inputEnd.value;this._inputChanged(text,this._inputEnd,"#formatterEnd","endValue")},_inputChanged:function _inputChanged(text,inputElem,formatterId,valueVar){var formatter=this.$$(formatterId),newVal;formatter.set("unformat",text);newVal=formatter.unformattedValue;if(!newVal&&0!==newVal){this.toggleClass("validation-error",!0,inputElem);return}newVal=Math.max(newVal,this.min);newVal=Math.min(newVal,this.max);newVal=this._calcStepRounded(newVal);if(this.isRange){if("value"===valueVar&&newVal>this.endValue||"endValue"===valueVar&&newVal<this.value){this.toggleClass("validation-error",!0,inputElem);return}}this.toggleClass("validation-error",!1,inputElem);this[valueVar]=null;this.set(valueVar,newVal)},_restoreStartInputValue:function _restoreStartInputValue(evt){this._restoreInputValue(this._inputStart,this.formattedStartValue)},_restoreEndInputValue:function _restoreEndInputValue(evt){this._restoreInputValue(this._inputEnd,this.formattedEndValue)},_restoreInputValue:function _restoreInputValue(input,formattedVal){input.blur();input.value=formattedVal;this.toggleClass("validation-error",!1,input)},_checkEndValue:function _checkEndValue(){var v=this._calcStepRounded(this.endValue);if(v>=this.value&&v<=this.max){this.set("endValue",v)}else{var m=this._calcStepRounded(this.max);this.set("endValue",m)}},_isRangeChanged:function _isRangeChanged(isRange){if(isRange!==void 0){this._checkEndValue();this._hideInputsChanged();this._buildHandles()}},_toggleDisabledClass:function _toggleDisabledClass(){this._startHandle.classed("disabled",this.disabled);this._endHandle.classed("disabled",this.disabled);this._progressBar.classed("disabled",this.disabled);this._backgroundTrack.classed("disabled",this.disabled);this._minLabel.classed("disabled",this.disabled);this._maxLabel.classed("disabled",this.disabled)},_returnLabel:function _returnLabel(label,showLabels){return showLabels?label:""},_returnLabelPosition:function _returnLabelPosition(labelPosition,isRange){if(isRange){return"top"===labelPosition?-20:24}else{return"top"===labelPosition?-15:19}},_returnLabelBaseline:function _returnLabelBaseline(labelPosition){return"top"===labelPosition?"baseline":"hanging"}});</script>
</dom-module>
</body></html>