<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-dropdown/iron-dropdown.html">
<link rel="import" href="../neon-animation/neon-animations.html">
<link rel="import" href="../neon-animation/neon-animation-behavior.html">
<link rel="import" href="../neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../web-animations-js/web-animations-next-lite.min.html">

<link rel="import" href="px-app-nav-item.html">


<link rel="import" href="css/px-app-nav-group-styles.html">

</head><body><dom-module id="px-app-nav-group">
  <template>
    <style include="px-app-nav-group-styles"></style>
    <px-app-nav-item id="itemButton" cancel-select="" icon="{{icon}}" label="{{label}}" dropdown="{{!hideDropdownIcon}}" selected$="{{_isGroupSelected(selected, noHighlight)}}" overflowed$="{{overflowed}}" empty-icon="{{emptyIcon}}" empty-label="{{emptyLabel}}" collapsed$="{{collapsed}}">
    </px-app-nav-item>

    <div class="app-nav-group__target" id="grouptarget"></div>

    <iron-dropdown id="group" horizontal-align="left" vertical-align="top" dynamic-align="" vertical-offset="{{_offsetHeight}}" opened="{{_opened}}" position-target="[[_getPositionTarget()]]" fit-into="[[fitInto]]" on-iron-overlay-canceled="_handleGroupCanceled" open-animation-config="{{_openAnimation}}" close-animation-config="{{_closeAnimation}}">
      <div slot="dropdown-content" class="dropdown-content app-nav-group__dropdown" id="groupcontainer">
        <div class="app-nav-group__dropdown__content" id="groupcontent">
          <slot></slot>
        </div>
      </div>
    </iron-dropdown>
  </template>
</dom-module>

<script>(function(){Polymer({is:"px-app-nav-group",behaviors:[Polymer.NeonAnimationRunnerBehavior],properties:{selected:{type:Boolean,value:!1,notify:!0,reflectToAttribute:!0,observer:"_handleSelectedChanged"},item:{type:Object},label:{type:String},icon:{type:String},opened:{type:Boolean,notify:!0,observer:"_openedChangedFromOutside"},_opened:{type:Boolean,observer:"_openedChangedFromInside"},fixedWidth:{type:Number},hideDropdownIcon:{type:Boolean,value:!1},overflowed:{type:Boolean,value:!1},noHighlight:{type:Boolean,value:!1},emptyIcon:{type:Boolean,value:!1},emptyLabel:{type:Boolean,value:!1},cancelSelect:{type:Boolean,value:!1},fitInto:{type:HTMLElement},collapsed:{type:Boolean,value:!1},_openAnimation:{type:Object},_closeAnimation:{type:Object},_offsetHeight:{type:Number}},attached:function attached(){this.listen(this.$.itemButton,"tap","_handleSelfTapped");this.listen(this.$.groupcontainer,"tap","_handleGroupContainerTapped");this.listen(this.$.group,"iron-overlay-opened","_handleDropdownOpened");this.listen(this.$.group,"iron-overlay-closed","_handleDropdownClosed");this.listen(this,"px-app-nav-item-tapped","_handleItemSelected");this.set("_offsetHeight",this._getVerticalOffset());if(!this._openAnimation){this._openAnimation={name:"expand-animation",timing:{easing:"ease-in"},endHeightNode:this.$.groupcontent}}if(!this._closeAnimation){this._closeAnimation={name:"contract-animation",timing:{easing:"ease-out"},startHeightNode:this.$.groupcontent}}},detached:function detached(){this.unlisten(this.$.itemButton,"tap","_handleSelfTapped");this.unlisten(this.$.groupcontainer,"tap","_handleGroupContainerTapped");this.unlisten(this.$.group,"iron-overlay-opened","_handleDropdownOpened");this.unlisten(this.$.group,"iron-overlay-closed","_handleDropdownClosed");this.unlisten(this,"px-app-nav-item-tapped","_handleItemSelected")},_openedChangedFromOutside:function _openedChangedFromOutside(newVal){if(!0===newVal&&!0!==this._opened){this.openGroup()}if(!1===newVal&&!1!==this._opened){this.closeGroup()}},_openedChangedFromInside:function _openedChangedFromInside(newVal){if(!0===newVal&&!0!==this.opened){this.set("opened",!0)}if(!1===newVal&&!1!==this.opened){this.set("opened",!1)}},_handleDropdownOpened:function _handleDropdownOpened(evt){evt.preventDefault();evt.stopPropagation();this.fire("px-app-nav-group-opened",{item:this.item})},_handleDropdownClosed:function _handleDropdownClosed(evt){evt.preventDefault();evt.stopPropagation();this.fire("px-app-nav-group-closed",{item:this.item})},_toggleGroup:function _toggleGroup(){if(this.opened){this.async(function(){this.closeGroup()})}if(!this.opened){this.openGroup()}},openGroup:function openGroup(){var group=this.$.group;if(!group)return;var button=this.$.itemButton,container=this.$.groupcontainer,content=this.$.groupcontent,minWidth=button.getBoundingClientRect().width+"px";if(content.style.minWidth!==minWidth&&!("number"===typeof this.fixedWidth)){container.style.minWidth=minWidth}if("number"===typeof this.fixedWidth){content.style.width=this.fixedWidth+"px"}group.open()},closeGroup:function closeGroup(){var group=this.$.group;if(!group)return;group.close()},refitGroup:function refitGroup(){if(!this.__group){var group=this.$.group;if(!group)return;this.__group=group}window.requestAnimationFrame(function(){this.__group.refit()}.bind(this))},_handleSelfTapped:function _handleSelfTapped(evt){this._toggleGroup()},_handleGroupContainerTapped:function _handleGroupContainerTapped(evt){var path=Polymer.dom(evt).path,content=Polymer.dom(this.root).querySelector("#groupcontent");if(-1===path.indexOf(content)){this.closeGroup()}},_handleGroupCanceled:function _handleGroupCanceled(evt){var uiEvt=evt.detail,target=Polymer.dom(uiEvt).rootTarget,trigger=this,path=Polymer.dom(uiEvt).path;if(-1<path.indexOf(trigger)){evt.preventDefault()}},_handleSelectedChanged:function _handleSelectedChanged(nextState,lastState){if(nextState!==lastState&&this.opened){this.closeGroup()}},_handleItemSelected:function _handleItemSelected(evt){if(this.opened){this.closeGroup()}},_getPositionTarget:function _getPositionTarget(){return this.$.itemButton},_getVerticalOffset:function _getVerticalOffset(){return this.getBoundingClientRect().height},_isGroupSelected:function _isGroupSelected(isSelected,noHighlight){if(isSelected&&!noHighlight){return!0}return!1}});Polymer({is:"expand-animation",behaviors:[Polymer.NeonAnimationBehavior],configure:function configure(config){var node=config.node,endHeightNode=config.endHeightNode,height=endHeightNode.getBoundingClientRect().height,timing=Object.assign({},this.timingFromConfig(config),{duration:calculateAnimationDuration(height)});this._effect=new KeyframeEffect(node,[{height:"0px"},{height:height+"px"}],timing);return this._effect}});Polymer({is:"contract-animation",behaviors:[Polymer.NeonAnimationBehavior],configure:function configure(config){var node=config.node,startHeightNode=config.startHeightNode,height=startHeightNode.getBoundingClientRect().height,timing=Object.assign({},this.timingFromConfig(config),{duration:calculateAnimationDuration(height)});this._effect=new KeyframeEffect(node,[{height:height+"px"},{height:"0px"}],timing);return this._effect}});function calculateAnimationDuration(height){return 1e3*height/800}})();</script>
</body></html>