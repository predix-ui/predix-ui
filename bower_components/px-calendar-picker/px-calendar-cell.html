<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../px-datetime-common/px-datetime-range-behavior.html">
<link rel="import" href="css/px-calendar-picker-styles.html">

<!--
Element that renders a calendar cell for a given date (and for non-date cells in the calendar).

### Usage

    <px-calendar-cell
      display-date="{{...}}"
      first-range-date="{{...}}"
      second-range-date="{{...}}">
    </px-calendar-cell>


@element px-calendar-cell
@homepage index.html
@demo index.html
-->
</head><body><dom-module id="px-calendar-cell">
  <template>
    <style include="px-calendar-picker-styles"></style>

    <div class$="{{cellStyles}}">
      <button class$="{{btnStyles}} btn--calendar-cell" type="button" value="{{displayedValue}}" on-tap="_selectDate" disabled="{{isDisabled}}" hidden$="{{!isValidDate}}">{{displayedValue}}</button>
    </div>
  </template>
</dom-module>

<script>Polymer({is:"px-calendar-cell",behaviors:[PxDatetimeBehavior.BlockDates,PxDatetimeBehavior.RangeMoments],properties:{displayDate:{type:Object,value:function value(){return{}},observer:"_updateDate"},displayMode:{type:String,value:"day"},blockDatesAfter:{type:Object,value:function value(){return{}}},blockDatesBefore:{type:Object,value:function value(){return{}}}},observers:["_updateNeeded(displayDate, fromMoment, toMoment, displayMode, blockDatesAfter, blockDatesBefore, blockFutureDates, blockPastDates)"],ready:function ready(){this._updateDate()},_updateNeeded:function _updateNeeded(){this._updateDate()},_updateDate:function _updateDate(){if(this.displayDate===void 0||this.fromMoment===void 0||this.toMoment===void 0||this.displayMode===void 0||this.blockDatesAfter===void 0||this.blockDatesBefore===void 0||this.blockFutureDates===void 0||this.blockPastDates===void 0||this.displayDate===void 0)return;var _this=this;this.debounce("updateDate",function(){var cellStyles="calendar-cell",btnStyles="btn btn--bare",isDisabled=!1;_this.set("isValidDate",_this.displayDate.isValid());if(!_this.isValidDate){_this.set("displayedValue","")}else{switch(_this.displayMode){case"day":_this.set("displayedValue",_this.displayDate.format("D"));break;case"month":_this.set("displayedValue",_this.displayDate.format("MMM"));break;case"year":_this.set("displayedValue",_this.displayDate.format("YYYY"));break;}if(_this.blockFutureDates&&_this._isPastTodaysDate()||_this.blockPastDates&&_this._isBeforeTodaysDate()||0<Object.keys(_this.blockDatesAfter).length&&_this.displayDate.isAfter(_this.blockDatesAfter,"day")||0<Object.keys(_this.blockDatesBefore).length&&_this.displayDate.isBefore(_this.blockDatesBefore,"day")){btnStyles+=" btn--disabled";isDisabled=!0}else{if(_this._isStartOfRange()||_this._isEndOfRange()){cellStyles+=" is-selected"}if(_this._isSingleSelected()){cellStyles+=" is-selected-only"}if(_this._isStartOfWeekOrMonth()||_this._isStartOfRange()){cellStyles+=" is-start"}if(_this._isEndOfWeekOrMonth()||_this._isEndOfRange()){cellStyles+=" is-end"}if(_this._isWithinRange()){cellStyles+=" is-between"}if(_this._isTodaysDate()){cellStyles+=" is-today"}}}_this.set("btnStyles",btnStyles);_this.set("isDisabled",isDisabled);_this.set("cellStyles",cellStyles)})},_selectDate:function _selectDate(e){this.fire("px-cell-date-selected",this.displayDate)},_isStartOfRange:function _isStartOfRange(){return this.fromMoment&&this.displayDate.isSame(this._getStartDate(),this.displayMode)},_isEndOfRange:function _isEndOfRange(){return this.toMoment&&this.displayDate.isSame(this._getEndDate(),this.displayMode)},_isWithinRange:function _isWithinRange(){return this.fromMoment&&this.toMoment&&this.displayDate.isBetween(this._getStartDate(),this._getEndDate(),this.displayMode)},_getStartDate:function _getStartDate(){var startDate=this.fromMoment;if(this.toMoment&&this.fromMoment.isAfter(this.toMoment,this.displayMode)){startDate=this.toMoment}return startDate},_getEndDate:function _getEndDate(){var endDate=this.toMoment;if(this.fromMoment&&this.fromMoment.isAfter(this.toMoment,this.displayMode)){endDate=this.fromMoment}return endDate},_isSingleSelected:function _isSingleSelected(){var singleFrom=this.fromMoment&&(!this.toMoment||!this.toMoment.isValid())&&this.displayDate.isSame(this.fromMoment,this.displayMode),singleTo=this.toMoment&&(!this.fromMoment||!this.fromMoment.isValid())&&this.displayDate.isSame(this.toMoment,this.displayMode);return singleFrom||singleTo},_isStartOfWeekOrMonth:function _isStartOfWeekOrMonth(){switch(this.displayMode){case"day":return 1===this.displayDate.date()||0===this.displayDate.weekday();case"month":return 0===this.displayDate.month()||4===this.displayDate.month()||8===this.displayDate.month();case"year":return 1===this.displayDate.year()%10||6===this.displayDate.year()%10;}},_isEndOfWeekOrMonth:function _isEndOfWeekOrMonth(){switch(this.displayMode){case"day":return this.displayDate.date()===this.displayDate.daysInMonth()||6===this.displayDate.weekday();case"month":return 3===this.displayDate.month()||7===this.displayDate.month()||11===this.displayDate.month();case"year":return 5===this.displayDate.year()%10||0===this.displayDate.year()%10;}},_isPastTodaysDate:function _isPastTodaysDate(){var todaysDate=Px.moment().tz(this.timeZone);return this.displayDate.isAfter(todaysDate,"day")},_isBeforeTodaysDate:function _isBeforeTodaysDate(){var todaysDate=Px.moment().tz(this.timeZone);return this.displayDate.isBefore(todaysDate,"day")},_isTodaysDate:function _isTodaysDate(){var todaysDate=Px.moment().tz(this.timeZone);return this.displayDate.isSame(todaysDate,"day")}});</script>
</body></html>