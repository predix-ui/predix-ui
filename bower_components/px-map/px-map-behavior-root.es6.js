(function(){"use strict";window.PxMapBehavior=window.PxMapBehavior||{};PxMapBehavior.TrackMarkersImpl={properties:{fitToMarkers:{type:Boolean,value:!1,observer:"_fitMapToMarkersIfSet"},fitToMarkersPadding:{type:Number,value:.15},fitToMarkersZoom:{type:String,value:"max"}},addInst:function addInst(parent){this.listen(this,"px-map-marker-added","_handleMarkerAdded");this.listen(this,"px-map-marker-group-features-changed","_handleMarkerGroupUpdated");this._knownMarkers=this._knownMarkers||new Map;PxMapBehavior.LeafletRootImpl.addInst.call(this)},removeInst:function removeInst(parent){this.unlisten(this,"px-map-marker-added","_handleMarkerAdded");this.unlisten(this,"px-map-marker-group-features-changed","_handleMarkerGroupUpdated");if(this._knownMarkers&&babelHelpers.instanceof(this._knownMarkers,Map)){this._knownMarkers.clear()}this._knownMarkers=null;PxMapBehavior.LeafletRootImpl.removeInst.call(this)},_handleMarkerAdded:function _handleMarkerAdded(evt){if(!this._knownMarkers)return;var localEvt=Polymer.dom(evt);if(localEvt.rootTarget&&localEvt.rootTarget.elementInst&&localEvt.event.detail.latLng){this._knownMarkers.set(localEvt.rootTarget.elementInst,localEvt.event.detail.latLng);this.listen(localEvt.rootTarget,"px-map-marker-removed","_handleMarkerRemoved");this._fitMapToMarkersIfSet()}},_handleMarkerRemoved:function _handleMarkerRemoved(evt){if(!this._knownMarkers)return;var localEvt=Polymer.dom(evt),knownMarker=this._knownMarkers.has(localEvt.rootTarget.elementInst||null);if(knownMarker){this.unlisten(localEvt.rootTarget,"px-map-marker-removed","_handleMarkerRemoved");this._knownMarkers.delete(localEvt.rootTarget.elementInst)}},_handleMarkerGroupUpdated:function _handleMarkerGroupUpdated(evt){if(!this._knownMarkers)return;var localEvt=Polymer.dom(evt),knownMarker=this._knownMarkers.has(localEvt.rootTarget.elementInst||null);if(localEvt.rootTarget&&localEvt.rootTarget.elementInst){if(!knownMarker){this.listen(localEvt.rootTarget,"px-map-marker-group-removed","_handleMarkerGroupRemoved")}this._knownMarkers.set(localEvt.rootTarget.elementInst,localEvt.event.detail.bounds);this._fitMapToMarkersIfSet()}},_handleMarkerGroupRemoved:function _handleMarkerGroupRemoved(evt){if(!this._knownMarkers)return;var localEvt=Polymer.dom(evt),knownMarker=this._knownMarkers.has(localEvt.rootTarget.elementInst||null);if(knownMarker){this.unlisten(localEvt.rootTarget,"px-map-marker-group-removed","_handleMarkerGroupRemoved");this._knownMarkers.delete(localEvt.rootTarget.elementInst)}},_fitMapToMarkers:function _fitMapToMarkers(){this.debounce("fit-map-to-bounds",function(){if(!this._knownMarkers||!this._knownMarkers.size)return;var bounds=this._markersToBoundsWithPadding(this._knownMarkers,this.fitToMarkersPadding);if(bounds&&bounds.isValid()){var latLng=bounds.getCenter(),zoom=this._getZoomLevelForFit(bounds,this.fitToMarkersZoom,this.elementInst);this.elementInst.setView(latLng,zoom)}},10)},_markersToBoundsWithPadding:function _markersToBoundsWithPadding(markersMap,padding){if(!markersMap||!markersMap.size)return;var bounds=L.latLngBounds();markersMap.forEach(function(value){if(babelHelpers.instanceof(value,L.LatLng)||babelHelpers.instanceof(value,L.LatLngBounds)){bounds.extend(value)}});if(bounds.isValid()&&"number"===typeof padding){bounds=bounds.pad(padding)}return bounds},_getZoomLevelForFit:function _getZoomLevelForFit(bounds,fitSetting,map){if("min"===fitSetting){var zoom=map.getMinZoom()||0;return zoom}if("max"===fitSetting){var _zoom=map.getBoundsZoom(bounds,!0)-1;return _zoom}},_fitMapToMarkersIfSet:function _fitMapToMarkersIfSet(){if(!this.elementInst||!this.fitToMarkers)return;this._fitMapToMarkers()},fitMapToMarkers:function fitMapToMarkers(){if(!this.elementInst||!this._knownMarkers||!this._knownMarkers.size){return!1}this._fitMapToMarkers();return!0}};PxMapBehavior.LeafletRootImpl={properties:{crs:{type:Object},lat:{type:Number,value:37.7672375,notify:!0,observer:"shouldUpdateInst"},lng:{type:Number,value:-121.9584131,notify:!0,observer:"shouldUpdateInst"},zoom:{type:Number,value:10,notify:!0,observer:"shouldUpdateInst"},maxZoom:{type:Number,observer:"shouldUpdateInst"},minZoom:{type:Number,observer:"shouldUpdateInst"},maxBounds:{type:Array,observer:"shouldUpdateInst"},disableDragging:{type:Boolean,value:!1,observer:"shouldUpdateInst"},disableScrollZoom:{type:Boolean,value:!1,observer:"shouldUpdateInst"},disableTouchZoom:{type:Boolean,value:!1,observer:"shouldUpdateInst"},disableDoubleClickZoom:{type:Boolean,value:!1,observer:"shouldUpdateInst"},disableAttribution:{type:Boolean,value:!1},attributionPrefix:{type:String,value:"<a href=\"http://leafletjs.com\" title=\"A JS library for interactive maps\">Leaflet</a>",observer:"shouldUpdateInst"},flexToSize:{type:Boolean,reflectToAttribute:!0,value:!1}},attached:function attached(){var _this=this;this.listen(this,"px-map-element-ready-to-add","shouldAddInst");if(Polymer.Element){this._afterFirstRender=!1;Polymer.RenderStatus.afterNextRender(this,function(){_this._afterFirstRender=!0;if(_this.canAddInst()){_this.fire("px-map-element-ready-to-add")}})}else{this._afterFirstRender=!0}if(this.canAddInst()){this.fire("px-map-element-ready-to-add")}},detached:function detached(){this.unlisten(this,"px-map-element-ready-to-add","shouldAddInst");this.shouldRemoveInst();this.removeInst()},shouldAddInst:function shouldAddInst(evt){if(Polymer.dom(evt).rootTarget!==this)return;PxMapBehavior.ElementImpl.shouldAddInst.call(this);this.addInst()},canAddInst:function canAddInst(){if("undefined"!==typeof this.zoom&&this._canBeNum(this.zoom)&&this._afterFirstRender){return this.latLngIsValid(this.lat,this.lng,!0)}},createInst:function createInst(options){var mapEl=Polymer.dom(this.root).querySelector("#map"),mapInst=L.map(mapEl,options);mapInst.attributionControl.setPrefix(options.attributionPrefix);if(this.isShadyScoped()){mapInst.__addShadyScope=this.scopeSubtree.bind(this)}return mapInst},addInst:function addInst(){if(this.isShadyScoped()){this.scopeSubtree(this.$.map,!0)}var mapMoveFn=this._handleMapMove.bind(this),zoomStartFn=this._handleZoomStart.bind(this),zoomEndFn=this._handleZoomEnd.bind(this);this.bindEvents({moveend:mapMoveFn,zoomstart:zoomStartFn,zoomend:zoomEndFn})},removeInst:function removeInst(){if(this.isShadyScoped()){this.scopeSubtree(this.$.map,!1)}},getInstOptions:function getInstOptions(){var options={zoomControl:!1,crs:this.crs||L.CRS.EPSG3857,center:[this.lat,this.lng],zoom:this.zoom,minZoom:this.minZoom||0,maxZoom:this.maxZoom||18,maxBounds:this.maxBounds||void 0,dragging:!this.disableDragging,scrollWheelZoom:!this.disableScrollZoom,touchZoom:!this.disableTouchZoom,doubleClickZoom:!this.disableDoubleClickZoom,attributionControl:!this.disableAttribution,attributionPrefix:this.attributionPrefix};return options},updateInst:function updateInst(lastOptions,nextOptions){if(this.latLngIsValid(nextOptions.center[0],nextOptions.center[1])&&(lastOptions.center[0]!==nextOptions.center[0]||lastOptions.center[1]!==nextOptions.center[1]||lastOptions.zoom!==nextOptions.zoom)){this._updateMapView()}if(lastOptions.maxZoom!==nextOptions.maxZoom&&!isNaN(nextOptions.maxZoom)){this.setMaxZoom(nextOptions.maxZoom)}if(lastOptions.minZoom!==nextOptions.minZoom&&!isNaN(nextOptions.minZoom)){this.setMinZoom(nextOptions.minZoom)}if(lastOptions.maxBounds!==nextOptions.maxBounds&&!isNaN(nextOptions.maxBounds)){this.setMaxBounds(nextOptions.maxBounds)}if(!lastOptions.dragging&&nextOptions.dragging){this.elementInst.dragging.enable()}if(lastOptions.dragging&&!nextOptions.dragging){this.elementInst.dragging.disable()}if(!lastOptions.scrollWheelZoom&&nextOptions.scrollWheelZoom){this.elementInst.scrollWheelZoom.enable()}if(lastOptions.scrollWheelZoom&&!nextOptions.scrollWheelZoom){this.elementInst.scrollWheelZoom.disable()}if(!lastOptions.touchZoom&&nextOptions.touchZoom){this.elementInst.touchZoom.enable()}if(lastOptions.touchZoom&&!nextOptions.touchZoom){this.elementInst.touchZoom.disable()}if(!lastOptions.doubleClickZoom&&nextOptions.doubleClickZoom){this.elementInst.doubleClickZoom.enable()}if(lastOptions.doubleClickZoom&&!nextOptions.doubleClickZoom){this.elementInst.doubleClickZoom.disable()}if(lastOptions.attributionPrefix!==nextOptions.attributionPrefix){this.elementInst.attributionControl.setPrefix(nextOptions.attributionPrefix)}},invalidateSize:function invalidateSize(){if(!this.elementInst)return;this.elementInst.invalidateSize()},_updateMapView:function _updateMapView(){if(!this.elementInst)return;this.debounce("update-map-view",function(){var _this$elementInst$get=this.elementInst.getCenter(),lat=_this$elementInst$get.lat,lng=_this$elementInst$get.lng,zoom=this.elementInst.getZoom();if(this.lat!==lat||this.lng!==lng||this.zoom!==zoom){this.elementInst.setView([this.lat,this.lng],this.zoom)}})},_canBeNum:function _canBeNum(val){return!isNaN(val)&&""!==val},latLngIsValid:function latLngIsValid(lat,lng,hideError){var isValid="undefined"!==typeof lat&&this._canBeNum(lat)&&"undefined"!==typeof lng&&this._canBeNum(lng);if(isValid)return!0;if(!hideError){console.log("PX-MAP CONFIGURATION ERROR:\n          You entered an invalid `lat` or `lng` attribute for ".concat(this.is,". You must pass a valid number."))}return!1},_handleMapMove:function _handleMapMove(){if(this.__isZooming){this.__onZoomEnd=this._handleMapMove.bind(this);return}this.debounce("handle-map-move",function(){var latLng=this.elementInst.getCenter(),zoom=this.elementInst.getZoom(),bounds=this.elementInst.getBounds();if(this.lat!==latLng.lat||this.lng!==latLng.lng){this.set("lat",latLng.lat);this.set("lng",latLng.lng)}if(this.zoom!==zoom){this.set("zoom",zoom)}this.fire("px-map-moved",{lat:latLng.lat,lng:latLng.lng,zoom:zoom,bounds:bounds})})},_handleZoomStart:function _handleZoomStart(){this.__isZooming=!0},_handleZoomEnd:function _handleZoomEnd(){this.__isZooming=!1;if("function"===typeof this.__onZoomEnd){this.__onZoomEnd();this.__onZoomEnd=null}},getVisibleMarkers:function getVisibleMarkers(){var mapBounds=this.elementInst.getBounds(),markers=[];this.elementInst.eachLayer(function(layer){if(layer.isMarker&&layer.getLatLng){if(mapBounds.contains(layer.getLatLng())&&-1===markers.indexOf(layer)){markers.push(layer)}}if(layer._markerCluster){layer.eachLayer(function(marker){var parentCluster=layer.getVisibleParent(marker);if(parentCluster&&mapBounds.contains(parentCluster.getLatLng())&&marker&&-1===markers.indexOf(marker)){markers.push(marker)}})}});return markers}};PxMapBehavior.LeafletRoot=[PxMapBehavior.Element,PxMapBehavior.ParentLayer,PxMapBehavior.LeafletRootImpl,PxMapBehavior.TrackMarkersImpl]})();