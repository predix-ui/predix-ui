(function(){"use strict";window.PxMapBehavior=window.PxMapBehavior||{};PxMapBehavior.LayerImpl={attached:function attached(){this.notifyInstReady(this.canAddInst())},detached:function detached(){this.shouldRemoveInst()},shouldAddInst:function shouldAddInst(parentInst,parentEl){PxMapBehavior.ElementImpl.shouldAddInst.call(this,parentInst);if(this.elementInst&&parentInst){this.__parentEl=parentEl;this.addInst(parentInst)};},shouldRemoveInst:function shouldRemoveInst(parent){PxMapBehavior.ElementImpl.shouldRemoveInst.call(this,parent);if(this.elementInst){this.removeInst(parent)};if(this.__parentEl&&this.__parentEl._dereferenceChild){this.__parentEl._dereferenceChild.call(this.__parentEl,this)}this.__parentEl=null},addInst:function addInst(parent){parent.addLayer(this.elementInst)},removeInst:function removeInst(parent){this.elementInst.remove()},canAddInst:function canAddInst(){return!0}};PxMapBehavior.Layer=[PxMapBehavior.Element,PxMapBehavior.LayerImpl];PxMapBehavior.ParentLayerImpl={listeners:{"px-map-element-instance-created":"_tryToAddAllChildren","px-map-element-ready-to-add":"_tryToAddOneChild"},created:function created(){this._attachedChildren=this._attachedChildren||new WeakMap},detached:function detached(){this._detachLayerChildren()},_tryToAddAllChildren:function _tryToAddAllChildren(evt){var localEvt=Polymer.dom(evt);if(!this.elementInst||localEvt.rootTarget!==this)return;this._attachLayerChildren()},_tryToAddOneChild:function _tryToAddOneChild(evt){var localEvt=Polymer.dom(evt);if(localEvt.rootTarget===this)return;evt.stopPropagation();if(!this.elementInst)return;this._attachLayerChild(localEvt.rootTarget)},_attachLayerChildren:function _attachLayerChildren(){var _this=this,children=this.getEffectiveChildren();if(!children||!children.length)return;children.forEach(function(child){_this._attachLayerChild(child)})},_attachLayerChild:function _attachLayerChild(childEl){var _this2=this;if(this._attachedChildren.has(childEl)||!childEl.shouldAddInst||!childEl.canAddInst||!childEl.canAddInst())return;this._attachedChildren.set(childEl,!0);this.async(function(){childEl.shouldAddInst(_this2.elementInst,_this2)})},_detachLayerChildren:function _detachLayerChildren(){var _this3=this,children=this.getEffectiveChildren();if(!children||!children.length)return;children.forEach(function(child){_this3._detachLayerChild(child)})},_detachLayerChild:function _detachLayerChild(childEl){var _this4=this;if(!this._attachedChildren.has(childEl)||!childEl.shouldRemoveInst)return;this._attachedChildren.delete(childEl);this.async(function(){childEl.shouldRemoveInst(_this4.elementInst,_this4)})},_dereferenceChild:function _dereferenceChild(childEl){if(!this._attachedChildren||!this._attachedChildren.has(childEl))return;this._attachedChildren.delete(childEl)}};PxMapBehavior.ParentLayer=[PxMapBehavior.ParentLayerImpl]})();