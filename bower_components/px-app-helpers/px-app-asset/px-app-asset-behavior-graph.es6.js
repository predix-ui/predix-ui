(function(){"use strict";var PxAppBehavior=window.PxAppBehavior=window.PxAppBehavior||{},AssetGraphBehavior={properties:{items:{type:Array},keys:{type:Object,value:function value(){return{id:"id",label:"label",children:"children",icon:"icon"}}},_assetGraph:{type:Object,value:null},__rootItems:{type:Array}},observers:["__handleAssetReferenceChanged(items, keys)","__handleKeyUpdated(keys.*)"],created:function created(){this._createAssetGraph=PxApp.assetGraph.bind(this)},__handleAssetReferenceChanged:function __handleAssetReferenceChanged(items,keys){if("object"===babelHelpers.typeof(items)&&Array.isArray(items)){if(null!==this._assetGraph){if("function"===typeof this.activate){this.activate(null)}if("function"===typeof this.select){this.select(null)}if("function"===typeof this.favorite){this.favorite(null)}}this._assetGraph=this._createAssetGraph();this._assetGraph.addChildren(null,items,{recursive:!0,childrenKey:keys.children});this.__rootItems=items.slice(0);this.fire("px-app-asset-graph-created",{graph:this._assetGraph});return this._assetGraph}},__handleKeyUpdated:function __handleKeyUpdated(record){if(!this._assetGraph){return}if("keys.children"===record.path){this.__handleAssetReferenceChanged(this.items,this.keys)}if("keys.id"===record.path){if("function"===typeof this.activate){this.activate(null)}if("function"===typeof this.select){this.select(null)}if("function"===typeof this.favorite){this.favorite(null)}}},addChildren:function addChildren(node,children,options){if(null!==this._assetGraph){this._assetGraph.addChildren(node,children,Object.assign({},{recursive:!0,childrenKey:this.keys.children},options||{}));if(null===node){var childrenArray=Array.isArray(children)?children:[children];this.__rootItems=this.__rootItems.concat(childrenArray)}this.fire("px-app-asset-children-updated",null===node?{item:null,added:children,children:this.__rootItems}:Object.assign({},this._assetGraph.getInfo(node),{added:children}))}},removeChildren:function removeChildren(node,children,options){if(null!==this._assetGraph){var childrenArray=Array.isArray(children)?children:[children];if("function"===typeof this.activate||"function"===typeof this.select){for(var deactivated,deselected,i=0;i<childrenArray.length;i++){if(!deactivated&&"function"===typeof this.activate&&this.activeMeta&&(this.activeMeta.item===childrenArray[i]||this.activeMeta.path&&-1<this.activeMeta.path.indexOf(childrenArray[i]))){this.activate(null);deactivated=!0}if(!deselected&&"function"===typeof this.select&&this.selectedMeta&&(this.selectedMeta.item===childrenArray[i]||this.selectedMeta.path&&-1<this.selectedMeta.path.indexOf(childrenArray[i]))){this.select(null);deactivated=!0}}}this._assetGraph.removeChildren(node,children,options);if(null===node){this.__rootItems=this.__rootItems.filter(function(item){return-1===childrenArray.indexOf(item)})}this.fire("px-app-asset-children-updated",null===node?{item:null,removed:children,children:this.__rootItems}:Object.assign({},this._assetGraph.getInfo(node),{removed:children}))}}};PxAppBehavior.AssetGraph=AssetGraphBehavior;var AssetGraph=function(){function AssetGraph(options){babelHelpers.classCallCheck(this,AssetGraph);this._options={};this._defaultKeys={id:"id",children:"children"};this._tree=new SymbolTree;this._rootNode={ROOT:!0};this._symbol=Symbol("AssetGraph data")}babelHelpers.createClass(AssetGraph,[{key:"_node",value:function _node(object){var node=object[this._symbol];if(node){return node}else{return object[this._symbol]={isExhausted:null,isTerminal:null,isSelectable:null}}}},{key:"_getKey",value:function _getKey(key,val){return val&&"string"===typeof val&&val.length?val:this._defaultKeys[key]}},{key:"hasNode",value:function hasNode(node){if(-1<this._tree.index(node)){return!0}return!1}},{key:"getInfo",value:function getInfo(node,routeKey){if(-1<this._tree.index(node)){var _routeKey=this._getKey("id",routeKey),path=this.getPath(node),route=path?AssetGraph.pathToRoute(path,_routeKey):null,parent=this.getParent(node),siblings=this.getSiblings(node),children=this.getChildren(node),hasChildren="object"===babelHelpers.typeof(children)&&Array.isArray(children)&&0<children.length,isTerminal=this.isTerminal(node),isExhausted=this.isExhausted(node),isSelectable=this.isSelectable(node);return{item:node,path:path,route:route,parent:parent,siblings:siblings,children:children,hasChildren:hasChildren,isTerminal:isTerminal,isExhausted:isExhausted,isSelectable:isSelectable}}return null}},{key:"getParent",value:function getParent(node){if(node&&-1<this._tree.index(node)){var parent=this._tree.parent(node);return parent!==this._rootNode?parent:null}return null}},{key:"hasSiblings",value:function hasSiblings(node){var siblings=this.getSiblings(node);return siblings&&1<siblings.length}},{key:"getSiblings",value:function getSiblings(node){if(node&&-1<this._tree.index(node)){return this._tree.childrenToArray(this._tree.parent(node))}return null}},{key:"getPath",value:function getPath(node){if(node&&-1<this._tree.index(node)){return this._tree.ancestorsToArray(node).reverse().slice(1)}return null}},{key:"getRoute",value:function getRoute(node,routeKey){if(node&&-1<this._tree.index(node)){var _routeKey="string"===typeof routeKey&&routeKey.length?routeKey:this._defaultKeys.id,ancestors=this.getPath(node);return ancestors?AssetGraph.pathToRoute(ancestors,_routeKey):null}return null}},{key:"getNodeAtRoute",value:function getNodeAtRoute(route,routeKey){if("object"!==babelHelpers.typeof(route)||!Array.isArray(route)||!route.length){throw new Error("An array of route strings is required.")}var _routeKey="string"===typeof routeKey&&routeKey.length?routeKey:this._defaultKeys.id,searchRoute=route.slice(0),items=this._tree.childrenToArray(this._rootNode).slice(0),foundItem=null;while(!foundItem&&0<items.length&&0<searchRoute.length){var item=items.shift();if(item[_routeKey]===searchRoute[0]&&0<this._tree.childrenCount(item)&&1!==searchRoute.length){searchRoute.shift();items=this._tree.childrenToArray(item).slice(0);continue}if(item[_routeKey]===searchRoute[0]&&1===searchRoute.length){foundItem=item;break}}return foundItem}},{key:"getChildren",value:function getChildren(node){var _node=null===node?this._rootNode:node;if(_node&&(_node.ROOT||-1<this._tree.index(_node))){return this._tree.childrenToArray(_node)}return null}},{key:"getRootChildren",value:function getRootChildren(){var _node=this._rootNode;if(_node){return this._tree.childrenToArray(_node)}return null}},{key:"hasChildren",value:function hasChildren(node){var _node=null===node?this._rootNode:node;if(_node&&(_node.ROOT||-1<this._tree.index(_node))){return 0<this._tree.childrenCount(_node)}return null}},{key:"addChildren",value:function addChildren(node,children,options){if("object"!==babelHelpers.typeof(children)||Array.isArray(children)&&!children.length){throw new Error("A child object or array of child objects is required.")}if(null!==node&&"object"===babelHelpers.typeof(node)&&!this.hasNode(node)){throw new Error("The parent node must be a node in the graph or null.")}for(var parent=null!==node?node:this._rootNode,childArray=Array.isArray(children)?children:[children],childKey="object"===babelHelpers.typeof(options)&&"string"===typeof options.childrenKey&&options.childrenKey.length?options.childrenKey:this._defaultKeys.children,isRecursive="object"===babelHelpers.typeof(options)&&"boolean"===typeof options.recursive?options.recursive:!1,i=0,info;i<childArray.length;i++){info=this._node(childArray[i]);info.isTerminal=childArray[i].hasOwnProperty("isTerminal")?childArray[i].isTerminal:null;info.isExhausted=childArray[i].hasOwnProperty("isExhausted")?childArray[i].isExhausted:null;info.isSelectable=childArray[i].hasOwnProperty("isSelectable")?childArray[i].isSelectable:null;this._tree.appendChild(parent,childArray[i]);if(isRecursive&&"object"===babelHelpers.typeof(childArray[i][childKey])&&Array.isArray(childArray[i][childKey])&&childArray[i][childKey].length){this.addChildren(childArray[i],childArray[i][childKey],{recursive:!0,childrenKey:childKey})}}if("object"===babelHelpers.typeof(options)&&"boolean"===typeof options.isExhausted){var isExhausted=options.isExhausted,_info=this._node(parent);_info.isExhausted=isExhausted}if("object"===babelHelpers.typeof(options)&&"boolean"===typeof options.isSelectable){var isSelectable=options.isSelectable,_info2=this._node(parent);_info2.isSelectable=isSelectable}return this.getChildren(parent)}},{key:"removeChildren",value:function removeChildren(node,children,options){if("object"!==babelHelpers.typeof(children)||Array.isArray(children)&&!children.length){throw new Error("A child object or array of child objects is required.")}if(null!==node&&"object"===babelHelpers.typeof(node)&&!this.hasNode(node)){throw new Error("The parent node must be a node in the graph or null.")}var parent=null!==node?node:this._rootNode,childArray;if(null===children){childArray=this.getChildren(parent)}else if(Array.isArray(children)){childArray=children}else{childArray=[children]}if(!childArray){return}for(var i=0;i<childArray.length;i++){if(!this.hasNode(childArray[i])){throw new Error("Child node(s) cannot be removed from the graph if it they were never added")}if(null!==node&&this.getParent(childArray[i])!==parent||null==node&&null!==this.getParent(childArray[i])){throw new Error("Child node(s) passed to \"removeChildren\" method must be children of the given parent")}this._tree.remove(childArray[i])}}},{key:"isExhausted",value:function isExhausted(node){var _node=null===node?this._rootNode:node;if(_node&&(_node.ROOT||-1<this._tree.index(_node))){var info=this._node(_node);return info&&!0===info.isExhausted?!0:!1}return null}},{key:"setExhausted",value:function setExhausted(node,isExhausted){var _node=null===node?this._rootNode:node;if(_node&&(_node.ROOT||-1<this._tree.index(_node))){var info=this._node(_node);info.isExhausted=isExhausted;return isExhausted}return null}},{key:"isTerminal",value:function isTerminal(node){if(null===node){return!1}if(-1<this._tree.index(node)){var info=this._node(node);return info&&!0===info.isTerminal?!0:!1}return null}},{key:"setTerminal",value:function setTerminal(node,isTerminal){if(null===node){throw new Error("The root node can never be terminal, it must have children.")}if(-1<this._tree.index(node)){var info=this._node(node);info.isTerminal=isTerminal;return isTerminal}return null}},{key:"isSelectable",value:function isSelectable(node){var _node=null===node?this._rootNode:node;if(_node&&(_node.ROOT||-1<this._tree.index(_node))){var info=this._node(_node);if(info&&!1===info.isSelectable){return!1}else{return!0}}return null}},{key:"setSelectable",value:function setSelectable(node,isSelectable){var _node=null===node?this._rootNode:node;if(_node&&(_node.ROOT||-1<this._tree.index(_node))){var info=this._node(_node);info.isSelectable=isSelectable;return isSelectable}return null}}],[{key:"pathToRoute",value:function pathToRoute(path,routeKey){return path.map(function(p){return"string"===typeof p[routeKey]&&p[routeKey].length?p[routeKey]:null})}}]);return AssetGraph}();;function assetGraph(options){return new AssetGraph(options)};var PxApp=window.PxApp=window.PxApp||{};PxApp.AssetGraph=AssetGraph;PxApp.assetGraph=assetGraph})();