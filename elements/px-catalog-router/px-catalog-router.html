<!--
Copyright (c) 2016 GE Global Research. All rights reserved.

The copyright to the computer software herein is the property of
GE Global Research. The software may be used and/or copied only
with the written permission of GE Global Research or in accordance
with the terms and conditions stipulated in the agreement/contract
under which the software has been supplied.
--><!-- Import Polymer --><html><head><link defer="" rel="import" href="../../bower_components/polymer/polymer.html">
<!-- Import Promise polyfill from PolymerLabs team. We need to use this one
     because we also use `iron-ajax` which uses with polyfill at the window
     level. Placing this here in case `iron-ajax` is removed as a dependency
     in the future to ensure we don't lose Promise definition. -->
<link async="" rel="import" href="../../bower_components/promise-polyfill/promise-polyfill-lite.html">

<!--
`px-catalog-router` is a bespoke router that handles URLs for the Predix UI
catalog by setting the appropriate state on the page (i.e. iFrame/sidebar)
or handles necessary redirects.

# Redirect cases currently handled

1. Redirect `/#/modules/:name` to the correct type

When a URL like `/#/modules/px-context-browser` is received, redirects it to
the correct path with the module's type. In this case, the browser would be
redirected to `/#/components/px-context-browser`, because px-context-browser is
a component.

@element px-catalog-router
-->

<script>(function(){"use strict";Polymer({is:"px-catalog-router",properties:{rawRoute:{type:Object,value:function value(){return{}}},rawPath:{type:String,notify:!0,observer:"_cleanRawPath"},appPath:{type:Object,value:function value(){return{}},notify:!0},appTail:{type:String,value:"",notify:!0},queryParams:{type:Object,notify:!0,value:function value(){return{}}},activeName:{type:String,value:"",notify:!0},activeType:{type:String,value:"",notify:!0},frameUrl:{type:String,notify:!0},navJson:{type:Object,value:function value(){return{}}},darkTheme:{type:Boolean}},observers:["_redirectOldQueryURLs(queryParams, queryParams.*)","_redirectModulePathURLs(appPath, appPath.*)","_handleActiveChange(activeName)","_updateFrameUrl(appPath, queryParams, appPath.*, queryParams.*, darkTheme)","_syncPathToActiveAttrs(appPath, appPath.*)"],attached:function attached(){this.async(function(){var rawPath=this.rawPath||"";if(!rawPath.length){this.set("rawPath","/home/")}},10)},_syncPathToActiveAttrs:function _syncPathToActiveAttrs(newAppPath){if(newAppPath&&"object"===babelHelpers.typeof(newAppPath)&&Object.keys(newAppPath).length){this.debounce("sync-path-to-active-attrs",function(){var activeName=this.activeName||"",activeType=this.activeType||"";if(newAppPath.name&&newAppPath.name!==activeName||newAppPath.type&&newAppPath.type!==activeType){this.set("activeName",newAppPath.name);this.set("activeType",newAppPath.type)}},10)}},_handleActiveChange:function _handleActiveChange(){if(this.activeName&&this.activeName.length){this.async(function(){var name=this.activeName,type=this.activeType,appPathName=this.appPath.name||"",appPathType=this.appPath.type||"";if(name!==appPathName||type!==appPathType){this.set("appPath",{type:type,name:name})}},10)}},_findUrlByNameAndType:function _findUrlByNameAndType(type,name,tail,useDarkTheme){var knownTypes;if(type&&""!==type){knownTypes={elements:function elements(name){return"bower_components/"+name+"/demo/"+name+"-demo.html"},css:function css(name){return"bower_components/"+name+"/demo/"+name+"-demo.html"},about:function about(name){return"pages/about/"+name+".html"},guides:function guides(name){return"pages/guides/"+name+".html"},migration:function migration(name){return"pages/migration/"+name+".html"},tools:function tools(name){return"pages/tools/"+name+".html"},guidelines:function guidelines(name){return"pages/guidelines/"+name+".html"},home:function home(){return"pages/home.html"},external:function external(name){return"https://github.com/predixdev/"+name}};var knownTypesKeys=Object.keys(knownTypes);if(-1!==knownTypesKeys.indexOf(type)){var url=knownTypes[type](name);if(useDarkTheme&&"components"===type&&"px-vis"===name.slice(0,7)){url=url.slice(0,-5)+"-dark-theme.html"}return url}}return knownTypes.home()},_updateFrameUrl:function _updateFrameUrl(){this.debounce("update-frame-url",function(){var appPath=this.appPath||{},appTail=this.appTail||"",queryParams=this.queryParams||{},type=appPath.type,name=appPath.name,frameUrl,tail="/"===appTail.substring(0,1)?appTail.substring(1):appTail,isDarkTheme=this.darkTheme;if(type||name){frameUrl=this._findUrlByNameAndType(type,name,tail,isDarkTheme);this.set("frameUrl",frameUrl)}},10)},_extractQueryParamsFromHash:function _extractQueryParamsFromHash(rawPath){return new Promise(function(resolve,reject){for(var parts=rawPath.split("/").filter(function(part){return part.length}),newParts=[],foundQueries=[],i=0,queryStart;i<parts.length;i++){queryStart=parts[i].indexOf("?");if(-1<queryStart){var query=parts[i].substring(queryStart+1),part=parts[i].substring(0,queryStart);if(part.length){newParts.push(part)}if(query.length){foundQueries.push(query)}}else{newParts.push(parts[i])}}return resolve({path:newParts.join("/"),query:foundQueries.join("&")})}.bind(this))},_ensureHasSlashes:function _ensureHasSlashes(rawPath){rawPath="/"!==rawPath.substring(0,1)?"/"+rawPath:rawPath;rawPath="/"!==rawPath.slice(-1)&&".html"!==rawPath.slice(-5)?rawPath+"/":rawPath;return rawPath},_parseQueryString:function _parseQueryString(paramString){var params={};paramString=(paramString||"").replace(/\+/g,"%20");for(var paramList=paramString.split("&"),i=0,param;i<paramList.length;i++){param=paramList[i].split("=");if(param[0]){params[decodeURIComponent(param[0])]=decodeURIComponent(param[1]||"")}}return params},_cleanRawPath:function _cleanRawPath(){this.debounce("clean-raw-path",function(){var rawPath=this.rawPath||"",cleaning=this._cleaningRawPath||!1;if(rawPath.length&&!this.cleaning){this.set("_cleaningRawPath",!0);this._extractQueryParamsFromHash(rawPath).then(function(pathAndQuery){var newRawPath=this._ensureHasSlashes(pathAndQuery.path);this.set("rawPath",newRawPath);var newQuery=pathAndQuery.query.length?this._parseQueryString(pathAndQuery.query):{},existingQuery=this.queryParams||{},query=Object.assign({},newQuery,existingQuery);if(Object.keys(query).length){this.set("queryParams",query)}this.set("_cleaningRawPath",!1)}.bind(this))}},100)},_redirectModulePathURLs:function _redirectModulePathURLs(newAppPath){if(newAppPath&&"object"===babelHelpers.typeof(newAppPath)&&Object.keys(newAppPath).length){this.debounce("redirect-module-path-URLs",function(){var type=newAppPath.type||"",name=newAppPath.name||"";if("modules"===type){var foundType=this._searchNavForTypeByName(name);if(!foundType){}else{this.set("appPath",{type:foundType,name:name})}}else if("components"===type){this.set("appPath",{type:"elements",name:name})}},1e3)}},_redirectOldQueryURLs:function _redirectOldQueryURLs(queryParams){if(queryParams&&"object"===babelHelpers.typeof(queryParams)&&Object.keys(queryParams).length){this.debounce("redirect-old-query-URLs",function(){var type,name;if(queryParams.type&&queryParams.type.length){type=queryParams.type}if(queryParams.show&&queryParams.show.length){name=queryParams.show}if(type&&name&&("home"===type||"landing_page"===name)){type="home";name=""}if(type&&name&&"local"===type){name=name.replace(/_/g,"-")}var newTypeByName={"what-is-predix-ui":"about","getting-started":"guides","use-css":"guides","use-seed":"guides","use-component-generator":"guides"},newTypeKeys=Object.keys(newTypeByName);if(type&&name&&-1!==newTypeKeys.indexOf(name)){type=newTypeByName[name]}if(type&&"component"===type){type="components"}if(type||name){this.set("queryParams",{});this.set("appPath",{});this.set("rawPath","/"+type+"/"+name)}},100)}},_searchNavForTypeByName:function _searchNavForTypeByName(name){if(this.navJson&&"object"===babelHelpers.typeof(this.navJson)&&Object.keys(this.navJson).length){var navJson=this.navJson,found,recurse=function recurse(obj){for(var keys=Object.keys(obj),i=0;i<keys.length;i++){if(obj[keys[i]].repoName===name){found=obj[keys[i]]}if(obj[keys[i]].links&&obj[keys[i]].links.length){recurse(obj[keys[i]].links)}}};recurse(navJson);return found?found.dataType:null}}})})();</script>
</head><body></body></html>