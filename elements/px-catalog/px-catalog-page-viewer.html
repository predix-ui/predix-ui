<html><head><link defer="" rel="import" href="../../bower_components/polymer/polymer.html">
<link async="" rel="import" href="../px-demo-theme-switcher/px-demo-theme-util.html">
<link async="" rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link async="" rel="import" href="../../bower_components/px-spinner/px-spinner.html">
<link defer="" rel="import" href="../../bower_components/promise-polyfill/promise-polyfill-lite.html">

</head><body><dom-module id="px-catalog-page-viewer">
  <template>
    <style>:host{position:relative;background-color:var(--px-catalog-page-background-color, white);}:host([dark-theme]){background-color:var(--px-catalog-page-background-color, black);}#pages{flex:1 1 auto;margin:0;padding:0;}.spinner{position:absolute;top:0;left:0;bottom:0;right:0;display:flex;align-items:center;justify-content:center;}</style>
    <!-- Pages will be distributed here -->
    <iron-pages id="pages" attr-for-selected="module-name" selected="[[activeModule]]" selected-item="{{_activeModuleEl}}">
    </iron-pages>
    <template is="dom-if" if="[[spinnerActive]]" restamp="">
      <div class="spinner">
        <px-spinner size="150"></px-spinner>
      </div>
    </template>
  </template>
  <script>Polymer({is:"px-catalog-page-viewer",properties:{activeModule:{type:String,observer:"_activeModuleChanged"},activeAnchor:{type:String,observer:"_handleActiveAnchorChanged"},visibleAnchor:{type:String,observer:"_handleVisibleAnchorChanged"},darkTheme:{type:Boolean,value:!1,reflectToAttribute:!0},spinnerActive:{type:Boolean,value:!1},_activeModuleEl:{type:HTMLElement},_scrollTop:{type:Number,value:null},_isRICScheduled:{type:Boolean,value:!1},_scrollCausedByAnchorClick:{type:Boolean,value:!1}},observers:["_applyTheme(_activeModuleEl, darkTheme)","_watchVisibleAnchor(activeModule, _activeModuleEl, _scrollTop)"],listeners:{"px-catalog-page-anchor-tapped":"_handleAnchorTapped"},created:function created(){this._modules={};var passiveScrollSupported=!1;try{var options=Object.defineProperty({},"passive",{get:function get(){passiveScrollSupported=!0}});window.addEventListener("test",null,options)}catch(err){}this._passiveScrollSupported=passiveScrollSupported},attached:function attached(){if(this._passiveScrollSupported){this._scrollHandler=this._handleScroll.bind(this);this.addEventListener("scroll",this._scrollHandler,{passive:!0})}this._scrollToAnchorPath(this._activeModuleEl,this.activeAnchor)},detached:function detached(){if(this._passiveScrollSupported&&this._scrollHandler){this.removeEventListener("scroll",this._scrollHandler,{passive:!0})}},_handleScroll:function _handleScroll(evt){if(this._scrollCausedByAnchorClick){this._scrollCausedByAnchorClick=!1;return}if(this._isRICScheduled){return}this._isRICScheduled=!0;if("requestIdleCallback"in window){requestIdleCallback(this._rAFScroll.bind(this),{timeout:100})}else{this.debounce("handle-scroll",this._rAFScroll,100)}},_rAFScroll:function _rAFScroll(){requestAnimationFrame(function(){this._scrollTop=this.scrollTop;this._isRICScheduled=!1}.bind(this))},_watchVisibleAnchor:function _watchVisibleAnchor(viewName,viewEl,scroll){if(!(viewName===void 0||viewEl===void 0||scroll===void 0)){if("view-"!==viewName.slice(0,5)||"number"!==typeof scroll||!babelHelpers.instanceof(viewEl,HTMLElement)||!viewEl.hasAttribute("has-anchors")){return}var anchors=viewEl.anchors,offsetPadding=75,firstAnchorOffset=anchors[0].offsetTop-offsetPadding,anchorsLength=anchors.length;if(0===scroll||scroll<firstAnchorOffset){this.visibleAnchor=""}for(var i=0;i<anchors.length;i++){var topRange=anchors[i].offsetTop-offsetPadding,bottomRange;if(i<anchors.length-1){bottomRange=anchors[i+1].offsetTop-offsetPadding}else if(scroll>firstAnchorOffset){bottomRange=this.scrollHeight}if(scroll>topRange&&scroll<bottomRange){this.visibleAnchor="#"+anchors[i].id;break}}}},_handleVisibleAnchorChanged:function _handleVisibleAnchorChanged(visibleAnchor){if(this.activeAnchor!==visibleAnchor){this.activeAnchor=visibleAnchor}},_handleActiveAnchorChanged:function _handleActiveAnchorChanged(activeAnchor){if(!this._activeModuleEl){return}if(activeAnchor!==this.visibleAnchor){this._scrollToAnchorPath(this._activeModuleEl,activeAnchor);this._scrollCausedByAnchorClick=!0}this._activeModuleEl.activeAnchor=activeAnchor},_handleAnchorTapped:function _handleAnchorTapped(evt){if(evt.detail.anchor){this.activeAnchor=evt.detail.anchor}},_scrollToAnchorPath:function _scrollToAnchorPath(el,activeAnchor,retries){var retries=retries||0;if(!el||!el.is){window.setTimeout(function(){retries++;if(10>retries){this._scrollToAnchorPath(this._activeModuleEl,this.activeAnchor,retries)}}.bind(this),500)}else if(el.hasAttribute("has-anchors")){var anchorEl=Polymer.dom(el.root).querySelector(activeAnchor),offset=anchorEl?anchorEl.offsetTop-30:0;this.scrollTop=offset}else if(/^px\-.+\-demo$/.test(el.is)){var demoApiViewer=Polymer.dom(el.root).querySelector("px-demo-api-viewer");if(!demoApiViewer)return;var apiViewer=Polymer.dom(demoApiViewer.root).querySelector("px-api-viewer");if(!apiViewer)return;var doc=apiViewer.$.doc;if(!doc)return;doc.scrollToAnchor(activeAnchor)}},_activeModuleChanged:function _activeModuleChanged(newModuleName,oldModuleName){if(newModuleName&&!this._modules[newModuleName]){var el=document.createElement(newModuleName);el.setAttribute("module-name",newModuleName);Polymer.dom(this.$.pages).appendChild(el);this._modules[newModuleName]=el}},_loadThemeFile:function _loadThemeFile(url){var _this=this;return new Promise(function(resolve){_this.importHref(_this.resolveUrl(url),function(res){return resolve("resolved")},null,!1)})},_applyTheme:function _applyTheme(el,darkTheme,retry){var _this2=this,deb=function deb(){el=_this2._activeModuleEl;retry=retry||1;if(!el){return}if((!el.is||"function"!==typeof el.updateStyles)&&100>retry){var retries=retry+1,timeout=10>retries?10:1e3;_this2.async(_this2._applyTheme.bind(_this2,el,darkTheme,retries),timeout);return}var componentDemoRe=/px\-[a-zA-Z0-9-]+-demo/,isComponentDemo=componentDemoRe.test(el.nodeName.toLowerCase()),needDyanmicTheme=isComponentDemo||el.hasAttribute("dynamic-theme");if(_this2.darkTheme){_this2._loadThemeFile("../../bower_components/px-dark-theme/px-dark-theme-styles.html").then(_this2._loadThemeFile("../../bower_components/px-dark-demo-theme/px-dark-demo-theme-styles.html")).then(function(){if(needDyanmicTheme){el.setAttribute("dark-theme","");var darkTheme=PxDemo.ThemeUtil.getDarkThemeProperties();el.updateStyles(darkTheme)}else if(!needDyanmicTheme){el.setAttribute("dark-theme","");el.updateStyles()}})}if(!_this2.darkTheme&&needDyanmicTheme){el.removeAttribute("dark-theme");var defaultTheme=PxDemo.ThemeUtil.getDefaultThemeProperties();el.updateStyles(defaultTheme)}else if(!_this2.darkTheme&&!needDyanmicTheme){el.removeAttribute("dark-theme");el.updateStyles()}};this.debounce("applyTheme",deb,250)}});</script>
</dom-module>
</body></html>